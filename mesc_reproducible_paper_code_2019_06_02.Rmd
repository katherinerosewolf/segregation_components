---
title: "Segregation Components Paper Code"
author: "Katherine Rose Wolf"
date: "June 12, 2019"
output: html_document
---

# CODE SETUP

```{r load packages}

library(rmarkdown)
library(knitr)
library(plyr)
library(data.table)
library(Hmisc)
library(extrafontdb)
library(extrafont)
library(NADA)
library(grid)
library(gridExtra)
library(lattice)
library(tmap)
library(sf)
library(tidycensus)
library(tigris)
library(rgeos)
library(sjPlot)
library(stargazer)
library(readxl)
library(tidyverse)

```


```{r rmarkdown options, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```


```{r census api key and options for tidycensus}

# install the census api key
census_api_key("eae31d12c8d9c2c9ee288e096e0c03830744aaef", 
               install = TRUE, 
               overwrite = TRUE)

readRenviron("~/.Renviron")

# have tidycensus store old shapefiles for future use
options(tigris_use_cache = TRUE)

```

# CREATE SUBDIRECTORIES

```{r create subdirectories}
if(!dir.exists("raw_data"))
  dir.create("raw_data")

if(!dir.exists("intermediate_data"))
  dir.create("intermediate_data")
```


# LOAD NECESSARY FILES

```{r create file download function}

# create function that downloads files
file_downloader <-
  function(desired_filename_as_string, 
           folder_as_string,
           web_address_as_string) {
    
    path <-  # specify the file path
      file.path(
        folder_as_string,
        desired_filename_as_string) 
    
    if(!file.exists(path))  # checks if file exists already
      download.file(url = web_address_as_string,  # if not, downloads/saves file
                    destfile = path, 
                    mode = "wb")
  }

```


```{r census data}

# last updated by census bureau 	19-Jul-2012 07:01	391M

# download zip file of census dp1 shapefiles
file_downloader(
  desired_filename_as_string = "tract_2010_census_dp1.zip", 
  folder_as_string = "raw_data", 
  web_address_as_string = 
    "http://www2.census.gov/geo/tiger/TIGER2010DP1/Tract_2010Census_DP1.zip"
  )

# unzip it to the intermediate file directory
unzip(
  file.path(
    "raw_data", 
    "tract_2010_census_dp1.zip"), 
  exdir = "intermediate_data")

# read the shapefile
census_data_shapefile <- 
  read_sf(
    file.path(
      "intermediate_data", 
      "Tract_2010Census_DP1.shp"))

```

```{r ruca data}

# last tested 2019-06-05 1:17 a.m. PT

file_downloader(
  desired_filename_as_string = "ruca_2010_raw.xlsx", 
  folder_as_string = "raw_data", 
  web_address_as_string = 
    "https://www.ers.usda.gov/webdocs/DataFiles/53241/ruca2010.xlsx?v=0"
  )

ruca_2010_raw <- 
  read_xlsx(
    file.path(
      "raw_data", 
      "ruca_2010_raw.xlsx"
      )
    )

```

```{r speciation parameter codes}

```

```{r speciation data files}

```

