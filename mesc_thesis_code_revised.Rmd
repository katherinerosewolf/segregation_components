---
title: "MESc Thesis Code"
author: "Katherine Rose Wolf"
date: "April 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages}

#### load packages ####
library(dtplyr)
library(plyr)
library(data.table)
library(dplyr)
library(rlist)
library(graphics)
library(ggplot2)

library(MASS)
library(biotools)
library(DiscriMiner)
library(klaR)

library(contrast)
library(sandwich)
library(car)
library(Hmisc)
library(stringr)
library(userfriendlyscience)
library(extrafontdb)
library(extrafont)
library(NADA)

library(tidyverse)

```


```{r write functions}

#### load statistical functions ####

# games howell test
games.howell <- 
  function(grp, obs) {
  
  #Create combinations
  combs <- combn(unique(grp), 2)
  
  # Statistics that will be used throughout the calculations:
  # n = sample size of each group
  # groups = number of groups in data
  # Mean = means of each group sample
  # std = variance of each group sample
  n <- tapply(obs, grp, length)
  groups <- length(tapply(obs, grp, length))
  Mean <- tapply(obs, grp, mean)
  std <- tapply(obs, grp, var)
  
  statistics <- lapply(1:ncol(combs), function(x) {
    
    mean.diff <- Mean[combs[2,x]] - Mean[combs[1,x]]
    
    #t-values
    t <- abs(Mean[combs[1,x]] - Mean[combs[2,x]]) / sqrt((std[combs[1,x]] / n[combs[1,x]]) + (std[combs[2,x]] / n[combs[2,x]]))
    
    # Degrees of Freedom
    df <- (std[combs[1,x]] / n[combs[1,x]] + std[combs[2,x]] / n[combs[2,x]])^2 / # Numerator Degrees of Freedom
      ((std[combs[1,x]] / n[combs[1,x]])^2 / (n[combs[1,x]] - 1) + # Part 1 of Denominator Degrees of Freedom 
         (std[combs[2,x]] / n[combs[2,x]])^2 / (n[combs[2,x]] - 1)) # Part 2 of Denominator Degrees of Freedom
    
    #p-values
    p <- ptukey(t * sqrt(2), groups, df, lower.tail = FALSE)
    
    # Sigma standard error
    se <- sqrt(0.5 * (std[combs[1,x]] / n[combs[1,x]] + std[combs[2,x]] / n[combs[2,x]]))
    
    # Upper Confidence Limit
    upper.conf <- lapply(1:ncol(combs), function(x) {
      mean.diff + qtukey(p = 0.95, nmeans = groups, df = df) * se
    })[[1]]
    
    # Lower Confidence Limit
    lower.conf <- lapply(1:ncol(combs), function(x) {
      mean.diff - qtukey(p = 0.95, nmeans = groups, df = df) * se
    })[[1]]
    
    # Group Combinations
    grp.comb <- paste(combs[1,x], ':', combs[2,x])
    
    # Collect all statistics into list
    stats <- list(grp.comb, mean.diff, se, t, df, p, upper.conf, lower.conf)
  })
  
  # Unlist statistics collected earlier
  stats.unlisted <- lapply(statistics, function(x) {
    unlist(x)
  })
  
  # Create dataframe from flattened list
  results <- data.frame(matrix(unlist(stats.unlisted), nrow = length(stats.unlisted), byrow=TRUE))
  
  # Select columns set as factors that should be numeric and change with as.numeric
  results[c(2, 3:ncol(results))] <- round(as.numeric(as.matrix(results[c(2, 3:ncol(results))])), digits = 3)
  
  # Rename data frame columns
  colnames(results) <- c('groups', 'Mean Difference', 'Standard Error', 't', 'df', 'p', 'upper limit', 'lower limit')
  
  return(results)
}

# another version of games-howell
posthoc.tgh <- function(y, x, method=c("games-howell", "tukey"), digits=2) {
  ### Based on http://www.psych.yorku.ca/cribbie/6130/games_howell.R
  method <- tolower(method);
  tryCatch(method <- match.arg(method), error=function(err) {
    stop("Argument for 'method' not valid!");
  });
  
  res <- list(input = list(x=x, y=y, method=method, digits=digits));
  
  res$intermediate <- list(x = factor(x[complete.cases(x,y)]),
                           y = y[complete.cases(x,y)]);
  res$intermediate$n <- tapply(y, x, length);
  res$intermediate$groups <- length(res$intermediate$n);
  res$intermediate$df <- sum(res$intermediate$n) - res$intermediate$groups;
  res$intermediate$means <- tapply(y, x, mean);
  res$intermediate$variances <- tapply(y, x, var);
  
  res$intermediate$pairNames <- combn(levels(res$intermediate$x),
                                      2, paste0, collapse=":");
  
  res$intermediate$descriptives <- cbind(res$intermediate$n,
                                         res$intermediate$means,
                                         res$intermediate$variances);
  rownames(res$intermediate$descriptives) <- levels(res$intermediate$x);
  colnames(res$intermediate$descriptives) <- c('n', 'means', 'variances');
  
  ### Start on Tukey
  res$intermediate$errorVariance <-
    sum((res$intermediate$n-1) * res$intermediate$variances) /
    res$intermediate$df;
  res$intermediate$t <- combn(res$intermediate$groups, 2, function(ij) {
    abs(diff(res$intermediate$means[ij]))/
      sqrt(res$intermediate$errorVariance*sum(1/res$intermediate$n[ij]));
  } );
  res$intermediate$p.tukey <- ptukey(res$intermediate$t*sqrt(2),
                                     res$intermediate$groups,
                                     res$intermediate$df,
                                     lower.tail=FALSE);
  res$output <- list();
  res$output$tukey <- cbind(res$intermediate$t,
                            res$intermediate$df,
                            res$intermediate$p.tukey)                                     
  rownames(res$output$tukey) <- res$intermediate$pairNames;
  colnames(res$output$tukey) <- c('t', 'df', 'p');
  
  ### Start on Games-Howell
  res$intermediate$df.corrected <- combn(res$intermediate$groups, 2, function(ij) {               
    sum(res$intermediate$variances[ij] /
          res$intermediate$n[ij])^2 / 
      sum((res$intermediate$variances[ij] /
             res$intermediate$n[ij])^2 / 
            (res$intermediate$n[ij]-1));
  } );
  res$intermediate$t.corrected <- combn(res$intermediate$groups, 2, function(ij) {               
    abs(diff(res$intermediate$means[ij]))/
      sqrt(sum(res$intermediate$variances[ij] /
                 res$intermediate$n[ij]));
  } );    
  res$intermediate$p.gameshowell <- ptukey(res$intermediate$t.corrected*sqrt(2),
                                           res$intermediate$groups,
                                           res$intermediate$df.corrected,
                                           lower.tail=FALSE)  
  res$output$games.howell <- cbind(res$intermediate$t.corrected,
                                   res$intermediate$df.corrected,
                                   res$intermediate$p.gameshowell);
  rownames(res$output$games.howell) <- res$intermediate$pairNames;
  colnames(res$output$games.howell) <- c('t', 'df', 'p');
  
  ### Set class and return object
  class(res) <- 'posthocTukeyGamesHowell';
  return(res);
  
}

print.posthocTukeyGamesHowell <- function(x, digits=x$input$digits, ...) {
  print(x$intermediate$descriptives, digits=digits);
  cat('\n');
  if (x$input$method == 'tukey') {
    print(x$output$tukey);
  }
  else if (x$input$method == 'games-howell') {
    print(x$output$games.howell, digits=digits);
  }
}

# function that summarize data for graphing
## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
                      conf.interval=.95, .drop=TRUE) {
  library(plyr)
  
  # New version of length which can handle NA's: if na.rm==T, don't count them
  length2 <- function (x, na.rm=FALSE) {
    if (na.rm) sum(!is.na(x))
    else       length(x)
  }
  
  # This does the summary. For each group's data frame, return a vector with
  # N, mean, and sd
  datac <- ddply(data, groupvars, .drop=.drop,
                 .fun = function(xx, col) {
                   c(N    = length2(xx[[col]], na.rm=na.rm),
                     mean = mean   (xx[[col]], na.rm=na.rm),
                     sd   = sd     (xx[[col]], na.rm=na.rm)
                   )
                 },
                 measurevar
  )
  
  # Rename the "mean" column    
  datac <- rename(datac, c("mean" = measurevar))
  
  datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean
  
  # Confidence interval multiplier for standard error
  # Calculate t-statistic for confidence interval: 
  # e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
  ciMult <- qt(conf.interval/2 + .5, datac$N-1)
  datac$ci <- datac$se * ciMult
  
  return(datac)
}

```

## data creation

```{r read necessary files, eval=FALSE, include=FALSE}

#### load raw data ####
# census
# fullcensus <- 
#   read_csv("fullcensus.csv") # load data
# fullcensus$GEOID10 <- 
#   as.character(fullcensus$GEOID10) # make ID into character
# save(fullcensus, 
#      file = "fullcensus.rdata")
load(file = "fullcensus.rdata")

# RUCA
load(file = 
       "onlyruca.rdata")
load(file = 
       "onlyurbanruca.rdata")

# get speciation parameter codes
# species_parameter_codes <- 
#   read.csv("speciation_parameter_codes.csv", 
#            header = TRUE)
# save(species_parameter_codes, 
#      file = "speciation_parameter_codes.rdata")
load(file = "speciation_parameter_codes.rdata")
```

# air pollution data creation

```{r air pollution data file import, eval=FALSE, include=FALSE}

# import air pollution data files #

# import chemical speciation data
SPEC_filenames <- 
  list.files(pattern = "daily_SPEC_.*\\.csv")
SPEC_file_list <- 
  lapply(SPEC_filenames,function(i){
    read.csv(file=i, header=TRUE)
})

names(SPEC_file_list) <- 
  gsub("\\.csv$", "", 
       SPEC_filenames)

# import total PM25 88101 files
PM_25_88101_filenames <- 
  list.files(pattern = "daily_88101_.*\\.csv")
PM_25_88101_file_list <- 
  lapply(PM_25_88101_filenames,function(i){
  read.csv(file=i, header=TRUE)
})
names(PM_25_88101_file_list) <- gsub("\\.csv$", "", PM_25_88101_filenames)

# import total PM25 88502 files
PM_25_88502_filenames <- 
  list.files(pattern = "daily_88502_.*\\.csv")
PM_25_88502_file_list <- 
  lapply(PM_25_88502_filenames,function(i){
  read.csv(file=i, header=TRUE)
})
names(PM_25_88502_file_list) <- 
  gsub("\\.csv$", "", PM_25_88502_filenames)

# save original files to disk
list.save(SPEC_file_list, 
          file = "SPEC_file_list_unedited.rdata")  #save list to disk
list.save(PM_25_88101_file_list, 
          file = "PM_25_88101_file_list_unedited.rdata")  #save list to disk
list.save(PM_25_88502_file_list, 
          file = "PM_25_88502_file_list_unedited.rdata")  #save list to disk
```


```{r load raw air pollution data files, eval=FALSE, include=FALSE}
###START HERE TO AVOID RE-READING FILES
SPEC_file_list <- 
  list.load(file = "SPEC_file_list_unedited.rdata")
PM_25_88101_file_list <- 
  list.load(file = "PM_25_88101_file_list_unedited.rdata")
PM_25_88502_file_list <- 
  list.load(file = "PM_25_88502_file_list_unedited.rdata")
```


```{r fix state codes and format individual files, eval=FALSE, include=FALSE}

# fix state codes for speciation data from 2005 to 2007
# force state code and state name to be character vectors
SPEC_file_list <- 
  lapply(SPEC_file_list, 
         function(x) {
           x$State.Code <- 
             as.character(x$State.Code); x
           })
PM_25_88101_file_list <- 
  lapply(PM_25_88101_file_list, 
         function(x) {
           x$State.Code <- 
             as.character(x$State.Code); x
           })
PM_25_88502_file_list <- 
  lapply(PM_25_88502_file_list, 
         function(x) {
           x$State.Code <- 
             as.character(x$State.Code); x
           })
SPEC_file_list <- 
  lapply(SPEC_file_list, 
         function(x) {
           x$State.Name <- 
             as.character(x$State.Name); x
           })
PM_25_88101_file_list <- 
  lapply(PM_25_88101_file_list, 
         function(x) {
           x$State.Name <- 
             as.character(x$State.Name); x
           })
PM_25_88502_file_list <- 
  lapply(PM_25_88502_file_list, 
         function(x) {
           x$State.Name <- 
             as.character(x$State.Name); x
           })

# replace CC with 81 in state code for Canada
# FRM
PM_25_88101_file_list <- 
  lapply(PM_25_88101_file_list,  
         function(x){
           x$State.Code <- 
             replace(x$State.Code, 
                     x$State.Code == "CC", 
                     "81"); x
 }
 )
# non-FRM
# replace CC with 81 in state code for Canada
PM_25_88502_file_list <- 
  lapply(PM_25_88502_file_list, 
         function(x){
           x$State.Code <- 
             replace(x$State.Code, 
                     x$State.Code=="CC","81");x
  }
  )

# import list of states and state codes
states_and_counties <- 
  read.csv(file="states_and_counties.csv")
states_and_codes <- 
  unique(states_and_counties[c("State.Name","State.Code")])
states_and_codes$State.Code <- 
  as.character(states_and_codes$State.Code)
states_and_codes$State.Name <- 
  as.character(states_and_codes$State.Name)

# change state code for Canada to the number 81 in states_and_codes
states_and_codes$State.Code[states_and_codes$State.Code == "CC"] <- "81"
# View(states_and_codes)

# remove wrong state codes from 2005-2007 speciation data
SPEC_file_list$daily_SPEC_2005$State.Code <- NULL
SPEC_file_list$daily_SPEC_2006$State.Code <- NULL
SPEC_file_list$daily_SPEC_2007$State.Code <- NULL


SPEC_file_list$daily_SPEC_2005 <- left_join(SPEC_file_list$daily_SPEC_2005,states_and_codes,by = "State.Name")
SPEC_file_list$daily_SPEC_2006 <- left_join(SPEC_file_list$daily_SPEC_2006,states_and_codes,by = "State.Name")
SPEC_file_list$daily_SPEC_2007 <- left_join(SPEC_file_list$daily_SPEC_2007,states_and_codes,by = "State.Name")

# View(SPEC_file_list$daily_SPEC_2005)

# put columns in correct order
SPEC_file_list$daily_SPEC_2005 <- SPEC_file_list$daily_SPEC_2005[c(29,1:28)]
SPEC_file_list$daily_SPEC_2006 <- SPEC_file_list$daily_SPEC_2006[c(29,1:28)]
SPEC_file_list$daily_SPEC_2007 <- SPEC_file_list$daily_SPEC_2007[c(29,1:28)]
# View(SPEC_file_list$daily_SPEC_2005)


#### isolate rows with state code concordance problems (need massive_species_dataframe first, don't actually need this code)
# species_state_discord <- anti_join(massive_species_dataframe, states_and_counties, by = c("State.Code","State.Name"))

# check overall counts for species (won't work unless run the massive_species_dataframe first)
#counts <- massive_species_dataframe_states %>%
#  group_by(State.Code, State.Name) %>%
#  summarise (n = n())

#check state speciation assignments by year
#SPEC_state_counts <- lapply(SPEC_file_list, function(x) {
#  thing <- x %>%
#    group_by(State.Code, State.Name) %>%
#    summarise (n = n());thing
#  }
#)


# View(SPEC_state_counts$daily_SPEC_2005)
# View(SPEC_state_counts$daily_SPEC_2006)
# View(SPEC_state_counts$daily_SPEC_2007)
# View(SPEC_state_counts$daily_SPEC_2008)
# View(SPEC_state_counts$daily_SPEC_2009)
# View(SPEC_state_counts$daily_SPEC_2010)
# View(SPEC_state_counts$daily_SPEC_2011)
# View(SPEC_state_counts$daily_SPEC_2012)
# View(SPEC_state_counts$daily_SPEC_2013)
# View(SPEC_state_counts$daily_SPEC_2014)
# View(SPEC_state_counts$daily_SPEC_2015)


# check state FRM PM2.5 assignments by year
# FRM_state_counts <- lapply(PM_25_88101_file_list, function(x) {
#  thing <- x %>%
#    group_by(State.Code, State.Name) %>%
#    summarise (n = n());thing
#}
#)

# View(FRM_state_counts$daily_88101_2005)
# View(FRM_state_counts$daily_88101_2006)
# View(FRM_state_counts$daily_88101_2007)
# View(FRM_state_counts$daily_88101_2008)
# View(FRM_state_counts$daily_88101_2009)
# View(FRM_state_counts$daily_88101_2010)
# View(FRM_state_counts$daily_88101_2011)
# View(FRM_state_counts$daily_88101_2012)
# View(FRM_state_counts$daily_88101_2013)
# View(FRM_state_counts$daily_88101_2014)
# View(FRM_state_counts$daily_88101_2015)


# check state non-FRM PM2.5 assignments by year
# non_FRM_state_counts <- lapply(PM_25_88502_file_list, function(x) {
#  thing <- x %>%
#    group_by(State.Code, State.Name) %>%
#    summarise (n = n());thing
#}
#)

# View(non_FRM_state_counts$daily_88502_2005)
# View(non_FRM_state_counts$daily_88502_2006)
# View(non_FRM_state_counts$daily_88502_2007)
# View(non_FRM_state_counts$daily_88502_2008)
# View(non_FRM_state_counts$daily_88502_2009)
# View(non_FRM_state_counts$daily_88502_2010)
# View(non_FRM_state_counts$daily_88502_2011)
# View(non_FRM_state_counts$daily_88502_2012)
# View(non_FRM_state_counts$daily_88502_2013)
# View(non_FRM_state_counts$daily_88502_2014)
# View(non_FRM_state_counts$daily_88502_2015)

# # check state speciation assignments by year
# # SPEC_state_counts <- lapply(SPEC_file_list, function(x) {
# #  thing<-x %>%
# #    group_by(State.Code, State.Name) %>%
# #    summarise (n = n());thing
# #}
# #)
#
#
# # View(SPEC_state_counts$daily_SPEC_2005)
# # View(SPEC_state_counts$daily_SPEC_2006)
# # View(SPEC_state_counts$daily_SPEC_2007)
# # View(SPEC_state_counts$daily_SPEC_2008)
# # View(SPEC_state_counts$daily_SPEC_2009)
# # View(SPEC_state_counts$daily_SPEC_2010)
# # View(SPEC_state_counts$daily_SPEC_2011)
# # View(SPEC_state_counts$daily_SPEC_2012)
# # View(SPEC_state_counts$daily_SPEC_2013)
# # View(SPEC_state_counts$daily_SPEC_2014)
# # View(SPEC_state_counts$daily_SPEC_2015)


# force state to be numeric #
SPEC_file_list <- 
  lapply(SPEC_file_list, 
         function(x) {
           x$State.Code <- 
             as.numeric(x$State.Code); x
           })
PM_25_88101_file_list <- 
  lapply(PM_25_88101_file_list, 
         function(x) {
           x$State.Code <- 
             as.numeric(x$State.Code); x
           })
PM_25_88502_file_list <- 
  lapply(PM_25_88502_file_list, 
         function(x) {
           x$State.Code <- 
             as.numeric(x$State.Code); x
           })

# create site IDs to match census files #
SPEC_file_list <- 
  lapply(SPEC_file_list, 
         function(x) {
           x$ID <- 
             paste(formatC(x$State.Code, width=2, flag="0"),
                   formatC(x$County.Code, width=3, flag="0"),
                   formatC(x$Site.Num, width=4, flag="0"),
                   sep="-");x
           })

PM_25_88101_file_list <- 
  lapply(PM_25_88101_file_list, 
         function(x) {
           x$ID <- 
             paste(formatC(x$State.Code, width=2, flag="0"),
                   formatC(x$County.Code, width=3, flag="0"),
                   formatC(x$Site.Num, width=4, flag="0"), 
                   sep="-");x
           })

PM_25_88502_file_list <- 
  lapply(PM_25_88502_file_list, 
         function(x) {
           x$ID <- 
             paste(formatC(x$State.Code, width=2, flag="0"),
                   formatC(x$County.Code, width=3, flag="0"),
                   formatC(x$Site.Num, width=4, flag="0"), 
                   sep="-");x})

# make ID a factor (not sure why)
SPEC_file_list <- 
  lapply(SPEC_file_list, 
         function(x) {
           x$ID <- 
             as.factor(x$ID); x
         })
PM_25_88101_file_list <- 
  lapply(PM_25_88101_file_list, 
         function(x) {x$ID <- 
           as.factor(x$ID); x
         })
PM_25_88502_file_list <- 
  lapply(PM_25_88502_file_list, 
         function(x) {
           x$ID <- 
             as.factor(x$ID); x
         })

# make parameter code a factor
SPEC_file_list <- 
  lapply(SPEC_file_list, 
         function(x) {
           x$Parameter.Code <- 
             as.factor(x$Parameter.Code); x
           })

PM_25_88101_file_list <- 
  lapply(PM_25_88101_file_list, 
         function(x) {
           x$Parameter.Code <- 
             as.factor(x$Parameter.Code); x
           })
PM_25_88502_file_list <- 
  lapply(PM_25_88502_file_list, 
         function(x) {
           x$Parameter.Code <- 
             as.factor(x$Parameter.Code); x
           })

# save all lists to disk
list.save(SPEC_file_list, 
          file = "SPEC_file_list.rdata")  #save list to disk
list.save(PM_25_88101_file_list, 
          file = "PM_25_88101_file_list.rdata")  #save list to disk
list.save(PM_25_88502_file_list, 
          file = "PM_25_88502_file_list.rdata")  #save list to disk
```


```{r pull individual species, eval=FALSE, include=FALSE}
# load files if haven't run above chunks
SPEC_file_list <- 
  list.load(file = "SPEC_file_list.rdata")
PM_25_88101_file_list <-
  list.load(file = "PM_25_88101_file_list.rdata")
PM_25_88502_file_list <-
  list.load(file = "PM_25_88502_file_list.rdata")

# pull PM2.5
PM25FRM <- 
  do.call("rbind", 
          PM_25_88101_file_list)
PM25nonFRM <- 
  do.call("rbind", 
          PM_25_88502_file_list)
PM25all <- 
  rbind(PM25FRM,
        PM25nonFRM)

# pull species
speciesoptions <- 
  as.list(
    levels(
      SPEC_file_list$daily_SPEC_2005$Parameter.Name))

species_parameter_codes_only <- 
  species_parameter_codes[,c("Parameter","Parameter.Code")]

species_parameter_codes_only <- 
  unique(species_parameter_codes_only)

species_parameter_codes_only$Parameter.Code <- 
  as.factor(species_parameter_codes_only$Parameter.Code)

# pull individual species
aluminum_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88104)
ammonium_ion_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88301)
antimony_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88102)
arsenic_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88103)
barium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88107)
beryllium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88105)
carbon_black_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88313)
bromine_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88109)
cadmium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88110)
calcium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88111)
cerium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88117)
cesium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88118)
chloride_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88203)
chlorine_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88115)
chromium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88112)
cobalt_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88113)
copper_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88114)
carbon_EC_CSN_LC_TOT_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88307)
carbon_EC_LC_TOR_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88321)
carbon_EC_LC_TOT_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88381)
carbon_EC_OPTICAL_TOT_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88316)
europium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88121)
gallium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88124)
gold_by_year <- 
  lapply(SPEC_file_list, 
         subset,
         Parameter.Code == 88143)
hafnium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88127)
indium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88131)
iridium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88133)
iron_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88126)
lanthanum_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88146)
lead_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88128)
magnesium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88140)
manganese_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88132)
mercury_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88142)
molybdenum_by_year <- 
  lapply(SPEC_file_list,
         subset, 
         Parameter.Code == 88134)
nickel_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88136)
niobium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88147)
nitrate_non_volatile_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88310)
carbon_OC_TOR_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88320)
carbon_OC_TOT_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88382)
carbon_OCX_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88304)
PM_25_SPEC_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88101)
phosphorus_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88152)
potassium_ion_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88303)
potassium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88180)
rubidium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88176)
samarium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88162)
scandium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88163)
selenium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88154)
silicon_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88165)
silver_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88166)
sodium_ion_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88302)
sodium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88184)
strontium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88168)
sulfate_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88403)
sulfur_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88169)
tantalum_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88170)
terbium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88172)
tin_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88160)
titanium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88161)
carbon_TC_LC_TOT_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88312)
nitrate_total_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88306)
tungsten_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88186)
carbon_UV_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88314)
uranium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88179)
vanadium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88164)
nitrate_volatile_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88309)
yttrium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88183)
zinc_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88167)
zirconium_by_year <- 
  lapply(SPEC_file_list, 
         subset, 
         Parameter.Code == 88185)

# put them all in a list
species_list_by_year <- 
  mget(ls(pattern = "_by_year"))

# save above list to disk
list.save(species_list_by_year, 
          file = "species_list_by_year.rdata")

# combine each sub-list into one dataframe
species_list <- 
  lapply(species_list_by_year, 
         function(i){
           rbindlist(i)
           })

# put all species in one dataframe for monitor extraction
species_list_dataframe <- 
  lapply(species_list,
         function(i){ # make each a dataframe
           as.data.frame(i)
           })

massive_species_dataframe <- 
  rbindlist(species_list_dataframe) # combine them!

# make tibble version of massive species dataframe
massive_species_tibble <-
  as_tibble(massive_species_dataframe)

# make dataframe with all air data in one place
complete_air_data <- 
  rbind(massive_species_dataframe,
        PM25all)
# View(complete_air_data)

# clarify monitor ID
complete_air_data$monitor_ID <- 
  as.character(complete_air_data$ID)
complete_air_data$ID <- NULL

# drop extra factor levels
droplevels(complete_air_data)

# save dataframes to disk before edits
save(complete_air_data,
     file = "complete_air_data.rdata")
list.save(species_list, 
          file="species_list.rdata")
save(massive_species_dataframe, 
     file = "massive_species_dataframe")
save(massive_species_tibble, 
     file = "massive_species_tibble.rdata")
save(PM25FRM, 
     file = "PM25FRM.rdata")
save(PM25nonFRM, 
     file = "PM25nonFRM.rdata")
save(PM25all, 
     file = "PM25all.rdata")

# remove files to save space
rm("SPEC_file_list", 
   "species_list_by_year", 
   "species_list_dataframe", 
   "massive_species_dataframe",
   "massive_species_tibble", 
   "PM25FRM",
   "PM25nonFRM",
   "PM25all", 
   "species_list",
   "PM_25_88101_file_list",
   "PM_25_88502_file_list"
   )
```


```{r monitor list creation, eval=FALSE, include=FALSE}

#####RUN LOAD LIBRARIES AT BEGINNING,THEN START HERE IF TRUST STATE REASSIGNMENTS

#OR IF RUNNING STRAIGHT THROUGH, SKIP THESE

#load instead of reading files

SPEC_file_list <- 
  list.load(file = "SPEC_file_list.rdata")
PM_25_88101_file_list <- 
  list.load(file = "PM_25_88101_file_list.rdata")
PM_25_88502_file_list <- 
  list.load(file = "PM_25_88502_file_list.rdata")
load(file = "massive_species_dataframe.rdata")
load(file = "massive_species_tibble.rdata")
load(file = "PM25FRM.rdata")
load(file = "PM25nonFRM.rdata")
load(file = "PM25all.rdata")

names(massive_species_tibble)
View(head(massive_species_tibble))

# dataframe of speciation monitors
speciation_monitor_preliminary_data <- 
  massive_species_dataframe[,c(
    "State.Code",
    "County.Code",
    "Site.Num",
    "Latitude",
    "Longitude",
    "Datum",
    "Local.Site.Name",
    "Address",
    "State.Name",
    "County.Name",
    "City.Name",
    "CBSA.Name",
    "ID")]
speciation_monitor_preliminary_data_dataframe <- 
  as_tibble(speciation_monitor_preliminary_data) #make it a tibble

speciation_monitors_no_exact_dups <- 
  unique(speciation_monitor_preliminary_data_dataframe) # take only unique monitors
# View(speciation_monitors_no_exact_dups)

# drop unused factor levels for all columns for speciation monitors
speciation_monitors_no_exact_dups <- 
  droplevels(speciation_monitors_no_exact_dups)
nlevels(speciation_monitors_no_exact_dups$ID)

# add column IDing as speciation monitors
speciation_monitors_no_exact_dups$Parameter.Code<-c("speciation")

# find duplicated rows for speciation monitors
speciation_only_dups <- 
  speciation_monitors_no_exact_dups[
    duplicated(
      speciation_monitors_no_exact_dups$ID)|
      duplicated(speciation_monitors_no_exact_dups$ID, 
                 fromLast=TRUE),]
# View(speciation_only_dups)

# determine levels of datum factor
levels(speciation_monitors_no_exact_dups$Datum)

# reorder datum in order of priority
speciation_monitors_no_exact_dups$Datum<-factor(speciation_monitors_no_exact_dups$Datum, levels = c("NAD83","WGS84","NAD27","UNKNOWN"))

# order all rows of no exact duplicates by datum
speciation_monitors_no_exact_dups <- speciation_monitors_no_exact_dups[order(speciation_monitors_no_exact_dups[,'Datum']),]
# View(speciation_monitors_no_exact_dups)

# delete duplicates :D
speciation_monitors_unique_site_IDs <- speciation_monitors_no_exact_dups[!duplicated(speciation_monitors_no_exact_dups$ID),]
# View(speciation_monitors_unique_site_IDs)

# save-non-duplicates to file
save(speciation_monitors_unique_site_IDs,file="speciation_monitors_unique_site_IDs.Rdata")

# generating unique site ID list for FRM PM2.5 monitors
varnames<-variable.names(PM25FRM)
varnames
PM_25_FRM_preliminary_data<-PM25FRM[,c("State.Code","County.Code","Site.Num","Parameter.Code","Latitude","Longitude","Datum","Local.Site.Name","Address","State.Name","County.Name","City.Name","CBSA.Name","ID")]
PM_25_FRM_preliminary_data<-as.data.frame(PM_25_FRM_preliminary_data)
PM_25_FRM_monitors_no_exact_duplicates<-unique(PM_25_FRM_preliminary_data)
# View(PM_25_FRM_monitors_no_exact_duplicates)

# drop unused factor levels for all columns for PM2.5 FRM monitors
PM_25_FRM_monitors_no_exact_duplicates<-droplevels(PM_25_FRM_monitors_no_exact_duplicates)

# look at duplicates
nlevels(PM_25_FRM_monitors_no_exact_duplicates$ID)

# view only the duplicates
PM_25_FRM_only_dups<-PM_25_FRM_monitors_no_exact_duplicates[duplicated(PM_25_FRM_monitors_no_exact_duplicates$ID)| duplicated(PM_25_FRM_monitors_no_exact_duplicates$ID, fromLast=TRUE),]

levels(PM_25_FRM_monitors_no_exact_duplicates$Datum)

# reorder datum in order of priority
PM_25_FRM_monitors_no_exact_duplicates$Datum<-factor(PM_25_FRM_monitors_no_exact_duplicates$Datum, levels = c("NAD83","WGS84","NAD27","UNKNOWN"))

# order all rows of no exact duplicates by datum
PM_25_FRM_monitors_no_exact_duplicates <- PM_25_FRM_monitors_no_exact_duplicates[order(PM_25_FRM_monitors_no_exact_duplicates[,'Datum']),]
# View(PM_25_FRM_monitors_no_exact_duplicates)

# delete duplicates :D
PM_25_FRM_monitors_unique_site_IDs <- PM_25_FRM_monitors_no_exact_duplicates[!duplicated(PM_25_FRM_monitors_no_exact_duplicates$ID),]
# View(PM_25_FRM_monitors_unique_site_IDs)

# save-non-duplicates to file
save(PM_25_FRM_monitors_unique_site_IDs,file="PM_25_FRM_monitors_unique_site_IDs.Rdata")

# non-FRM PM2.5 data!
# generating unique site ID list for FRM PM2.5 monitors
varnamesnonFRM<-variable.names(PM25nonFRM)
varnamesnonFRM
PM_25_non_FRM_preliminary_data<-PM25nonFRM[,c("State.Code","County.Code","Site.Num","Parameter.Code","Latitude","Longitude","Datum","Local.Site.Name","Address","State.Name","County.Name","City.Name","CBSA.Name","ID")]
PM_25_non_FRM_preliminary_data<-as.data.frame(PM_25_non_FRM_preliminary_data)
PM_25_non_FRM_monitors_no_exact_duplicates<-unique(PM_25_non_FRM_preliminary_data)
# View(PM_25_non_FRM_monitors_no_exact_duplicates)

# drop unused factor levels for all columns for PM2.5 non_FRM monitors
PM_25_non_FRM_monitors_no_exact_duplicates<-droplevels(PM_25_non_FRM_monitors_no_exact_duplicates)

# look at duplicates
nlevels(PM_25_non_FRM_monitors_no_exact_duplicates$ID)

# view only the duplicates
PM_25_non_FRM_only_dups<-PM_25_non_FRM_monitors_no_exact_duplicates[duplicated(PM_25_non_FRM_monitors_no_exact_duplicates$ID)| duplicated(PM_25_non_FRM_monitors_no_exact_duplicates$ID, fromLast=TRUE),]

levels(PM_25_non_FRM_monitors_no_exact_duplicates$Datum)

# reorder datum in order of priority
PM_25_non_FRM_monitors_no_exact_duplicates$Datum<-factor(PM_25_non_FRM_monitors_no_exact_duplicates$Datum, levels = c("NAD83","WGS84","NAD27","UNKNOWN"))

# order all rows of no exact duplicates by datum
PM_25_non_FRM_monitors_no_exact_duplicates <- PM_25_non_FRM_monitors_no_exact_duplicates[order(PM_25_non_FRM_monitors_no_exact_duplicates[,'Datum']),]
# View(PM_25_non_FRM_monitors_no_exact_duplicates)

# delete duplicates :D
PM_25_non_FRM_monitors_unique_site_IDs <- PM_25_non_FRM_monitors_no_exact_duplicates[!duplicated(PM_25_non_FRM_monitors_no_exact_duplicates$ID),]
# View(PM_25_non_FRM_monitors_unique_site_IDs)

# save-non-duplicates to file
save(PM_25_non_FRM_monitors_unique_site_IDs,file="PM_25_non_FRM_monitors_unique_site_IDs.Rdata")

### make master monitor file
all_monitors<-rbind(PM_25_FRM_monitors_unique_site_IDs,PM_25_non_FRM_monitors_unique_site_IDs,speciation_monitors_unique_site_IDs)
# View(all_monitors)
2
# view only the duplicates
all_monitors_only_dups<-all_monitors[duplicated(all_monitors$ID)| duplicated(all_monitors$ID, fromLast=TRUE),]
# View(all_monitors_only_dups)

# put all monitors in a modifiable dataframe
final_monitors<-all_monitors

# idea -- make five columns, each w/ Y or N for speciation
# then map

#make binary columns for each monitor type
final_monitors$PM25FRM<-ifelse(final_monitors$Parameter.Code=="88101",1,0)
final_monitors$PM25nonFRM<-ifelse(final_monitors$Parameter.Code=="88502",1,0)
final_monitors$speciation<-ifelse(final_monitors$Parameter.Code=="speciation",1,0)

# drop parameter code
final_monitors$Parameter.Code <- NULL

# assign monitor values to all rows
final_monitors[,c("PM25FRM","PM25nonFRM","speciation")] = sapply(final_monitors[,c("PM25FRM","PM25nonFRM","speciation")], function(a) ave(a, final_monitors$ID, FUN = max))

# drop duplicated rows
final_monitors<-unique(final_monitors)
final_monitors<-droplevels(final_monitors)

# save the final-ish monitor list
save(final_monitors,file="final_monitors_still_some_dups.rdata")
nlevels(final_monitors$ID)
final_monitors$ID<-as.character(final_monitors$ID)

# isolate remaining duplicates
final_monitors_only_dups<-final_monitors[duplicated(final_monitors$ID)| duplicated(final_monitors$ID, fromLast=TRUE),]
# View(final_monitors_only_dups)

# reorder datum in order of priority
final_monitors$Datum<-factor(final_monitors$Datum, levels = c("NAD83","WGS84","NAD27","UNKNOWN"))

# order all rows of no exact duplicates by datum
final_monitors <- final_monitors[order(final_monitors[,'Datum']),]
# View(final_monitors)

# delete duplicates :D
final_monitors <- final_monitors[!duplicated(final_monitors$ID),]
# View(final_monitors)
table(final_monitors$ID)

save(final_monitors,file="monitor.list.rdata")

# split monitors by datum for ArcGIS
monitors_split_by_datum<-split(final_monitors, final_monitors$Datum)
str(monitors_split_by_datum)
monitors_NAD83<-monitors_split_by_datum[[1]]
monitors_WGS84<-monitors_split_by_datum[[2]]
monitors_NAD27<-monitors_split_by_datum[[3]]
monitors_UNKNO<-monitors_split_by_datum[[4]]
# View(monitors_NAD83)
# View(monitors_WGS84)
# View(monitors_NAD27)
# View(monitors_UNKNO)

# save monitors split by datum
save(monitors_NAD83,file="monitors_NAD83.rdata")
save(monitors_WGS84,file="monitors_WGS84.rdata")
save(monitors_NAD27,file="monitors_NAD27.rdata")
save(monitors_UNKNO,file="monitors_UNKNO.rdata")

# write to CSV for ArcGIS
write.csv(monitors_NAD83, "monitors_NAD83.csv")
write.csv(monitors_WGS84, "monitors_WGS84.csv")
write.csv(monitors_NAD27, "monitors_NAD27.csv")
write.csv(monitors_UNKNO, "monitors_UNKNO.csv")

# write to CSV directly to ArcGIS folder
write.csv(monitors_NAD83, "arcgis/monitors_NAD83.csv")
write.csv(monitors_WGS84, "arcgis/monitors_WGS84.csv")
write.csv(monitors_NAD27, "arcgis/monitors_NAD27.csv")
write.csv(monitors_UNKNO, "arcgis/monitors_UNKNO.csv")

#### MUST STOP HERE AND ASSIGN THE MONTIORS TO TRACTS
```


```{r clean the air data a bit eval=FALSE, include=FALSE}

load(file = "complete_air_data.rdata")

# read in the table with monitors assigned to census tracts
monitors_assigned_to_tracts_raw <- 
  read.csv(file = "monitors_assigned_to_tracts.txt")
View(monitors_assigned_to_tracts_raw)

# make working file
monitors_assigned_to_tracts <- 
  monitors_assigned_to_tracts_raw

# rename GEOID10 to tract_ID and coerce to character
monitors_assigned_to_tracts$tract_ID <- 
  as.character(monitors_assigned_to_tracts$GEOID10)
monitors_assigned_to_tracts$GEOID10 <- NULL

# rename ID to monitor ID
monitors_assigned_to_tracts$monitor_ID <- 
  as.character(monitors_assigned_to_tracts$ID)
monitors_assigned_to_tracts$ID <- NULL

# count monitors
spec_monitor_count <- 
  table(monitors_assigned_to_tracts$speciation)
# View(spec_monitor_count)
PM_monitor_count <- 
  table(monitors_assigned_to_tracts$PM25FRM,monitors_assigned_to_tracts$PM25nonFRM)
# View(PM_monitor_count)

# view list of monitors occupying the same census tract
# find duplicated rows for speciation monitors
multiple_monitors_in_single_tracts <- 
  monitors_assigned_to_tracts[
    duplicated(monitors_assigned_to_tracts$GEOID10)| 
      duplicated(monitors_assigned_to_tracts$GEOID10, 
                 fromLast=TRUE),]
# View(multiple_monitors_in_single_tracts)

# just pull monitor IDs and census tracts
monitors_and_tracts <- 
  monitors_assigned_to_tracts[,c("tract_ID",
                                 "monitor_ID")]
# View(monitors_and_tracts)

# pull monitor IDs, census tracts, and monitor types
monitors_tracts_types <- 
  monitors_assigned_to_tracts[,c("tract_ID",
                                 "monitor_ID",
                                 "PM25FRM",
                                 "PM25nonFRM",
                                 "speciation")]
# View(monitors_tracts_types)

##### works to here

# join tracts to full data
complete_air_and_tracts <- 
  merge(complete_air_data,
        monitors_tracts_types,
        by = "monitor_ID",
        all = TRUE)
# View(complete_air_and_tracts)

# save to disk
save(complete_air_and_tracts,
     file = "complete_air_and_tracts.rdata")

# make it a little smaller
compact_air_and_tracts <- 
  subset(complete_air_and_tracts,
         select = -c(AQI,CBSA.Name))
object.size(compact_air_and_tracts)

# save to disk
save(compact_air_and_tracts,
     file = "compact_air_and_tracts.rdata")

# remove others to save working memory
rm(complete_air_data)

```


```{r make dataframe of species and PM for correction, eval=FALSE, include=FALSE}

# load air data files
load(file = "complete_air_and_tracts.rdata")

# make parameter code a character for subsetting
compact_air_and_tracts$Parameter.Code <- 
  as.character(compact_air_and_tracts$Parameter.Code)

# extract observations
component <- c(
  "aluminum",
  "ammonium_ion",
  "antimony",
  "arsenic",
  "barium",
  "beryllium",
  "carbon_black",
  "bromine",
  "cadmium",
  "calcium",
  "cerium",
  "cesium",
  "chloride",
  "chlorine",
  "chromium",
  "cobalt",
  "copper",
  "carbon_EC_CSN_LC_TOT",
  "carbon_EC_LC_TOR",
  "carbon_EC_LC_TOT",
  "carbon_EC_OPTICAL_TOT",
  "europium",
  "gallium",
  "gold",
  "hafnium",
  "indium",
  "iridium",
  "iron",
  "lanthanum",
  "lead",
  "magnesium",
  "manganese",
  "mercury",
  "molybdenum",
  "nickel",
  "niobium",
  "nitrate_non_volatile",
  "carbon_OC_TOR",
  "carbon_OC_TOT",
  "carbon_OCX",
  "PM_25_FRM",
  "phosphorus",
  "potassium_ion",
  "potassium",
  "rubidium",
  "samarium",
  "scandium",
  "selenium",
  "silicon",
  "silver",
  "sodium_ion",
  "sodium",
  "strontium",
  "sulfate",
  "sulfur",
  "tantalum",
  "terbium",
  "tin",
  "titanium",
  "carbon_TC_LC_TOT",
  "nitrate_total",
  "tungsten",
  "carbon_UV",
  "uranium",
  "vanadium",
  "nitrate_volatile",
  "yttrium",
  "zinc",
  "zirconium",
  "PM25_non_FRM")

parameter_code <- c(
  "88104",
  "88301",
  "88102",
  "88103",
  "88107",
  "88105",
  "88313",
  "88109",
  "88110",
  "88111",
  "88117",
  "88118",
  "88203",
  "88115",
  "88112",
  "88113",
  "88114",
  "88307",
  "88321",
  "88381",
  "88316",
  "88121",
  "88124",
  "88143",
  "88127",
  "88131",
  "88133",
  "88126",
  "88146",
  "88128",
  "88140",
  "88132",
  "88142",
  "88134",
  "88136",
  "88147",
  "88310",
  "88320",
  "88382",
  "88304",
  "88101",
  "88152",
  "88303",
  "88180",
  "88176",
  "88162",
  "88163",
  "88154",
  "88165",
  "88166",
  "88302",
  "88184",
  "88168",
  "88403",
  "88169",
  "88170",
  "88172",
  "88160",
  "88161",
  "88312",
  "88306",
  "88186",
  "88314",
  "88179",
  "88164",
  "88309",
  "88183",
  "88167",
  "88185",
  "88502")

elements_and_codes <- 
  tibble(component,
         parameter_code)
save(elements_and_codes, 
     file = "elements_and_codes.rdata")
write.csv(elements_and_codes,
          file = "elements_and_codes.csv")
elements_and_codes <- 
  read.csv(file = "elements_and_codes.csv")
View(elements_and_codes)

# break out individual parameter codes into lists
elements_and_codes$parameter_code <- 
  as.character(elements_and_codes$parameter_code)
complete_air_and_tracts$Parameter.Code <- 
  as.character(complete_air_and_tracts$Parameter.Code)
components <- 
  lapply(elements_and_codes$parameter_code,
         function(i){
           subset(complete_air_and_tracts,
                  Parameter.Code == i)
         })
names(components) <- 
  elements_and_codes$parameter_code

# save broken-out components
list.save(components,
          file = "components.rdata")
# View(components$`88381`)

# # load broken-out components if needed
# components <- list.load(file="components.rdata")

# put the components I want back into one big dataframe
onlytheonesIwant  <-  
  do.call("rbind", 
          components)
save(onlytheonesIwant,
     file="onlytheonesIwant.rdata")
# View(onlytheonesIwant)

# load limited list if needed
load(file="onlytheonesIwant.rdata")

# View(onlytheonesIwant)
#number of monitors
length(unique(onlytheonesIwant$monitor_ID))

# number of monitors by parameter code
aggregate(monitor_ID ~ Parameter.Name, 
          onlytheonesIwant, 
          function(x) length(unique(x)))

# remove everything from the workspace
rm(list = ls())
```


```{r deal with mdls, eval=FALSE, include=FALSE}

load(file = "onlytheonesIwant.rdata")

air_data_corrections <- 
  as_tibble(onlytheonesIwant)

# fix column types
air_data_corrections <-
  air_data_corrections %>% 
  mutate_if(is.factor, 
            as.character) %>% 
  mutate(method_code = as.character(method_code))

# fix column names
air_data_corrected_colnames <-
  air_data_corrections %>% 
  colnames() %>% 
  tolower() %>% 
  {gsub("\\.", "_", .)}

colnames(air_data_corrections) <- 
  air_data_corrected_colnames

# fix column types
air_data_corrections <- 
  air_data_corrections %>% 
  mutate(parameter_code = as.character(parameter_code),
         method_code = as.character(method_code))


methods_speciation <- 
  read_csv(file = "methods_speciation.csv",
           col_types = 
             cols(Parameter = col_character(),
                  `Parameter Code` = col_character(),
                  `Method Code` = col_double(),
                  `Recording Mode` = col_character(),
                  `Collection Description` = col_character(),
                  `Analysis Description` = col_character(),
                  `Method Type` = col_character(),
                  `Reference Method ID` = col_character(),
                  `Equivalent Method` = col_character(),
                  `Federal MDL` = col_double(),
                  `Min Value` = col_double(),
                  `Max Value` = col_double(),
                  Digits = col_double(),
                  `Round Truncate Indicator` = col_character(),
                  Units = col_character()))

# fix column names
methods_speciation_fixed_column_names <-
  methods_speciation %>%
  colnames() %>% 
  tolower() %>% 
  {gsub(" ", "_", .)}

colnames(methods_speciation) <- 
  methods_speciation_fixed_column_names

# add half detection limit column
methods_speciation <- 
  methods_speciation %>% 
  mutate(half_mdl = federal_mdl/2)

# merge speciation methods with detection limits
air_data_corrections_mdl <- 
  air_data_corrections %>% 
  left_join(methods_speciation, 
            by = c("parameter_code", 
                   "method_code"))

# figure out percent above mdl for each species
percent_below_mdl <- 
  air_data_corrections_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean,
                federal_mdl) %>% 
  count(arithmetic_mean < federal_mdl) %>% 
  mutate(observations = sum(n), 
         percent_of_total = n/sum(n))
  
final_percent_above_mdl <- 
  percent_below_mdl %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean < federal_mdl` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations,
                percent_above_mdl = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange(percent_above_mdl)

# figure out percent zero for each species
percent_zero <- 
  air_data_corrections %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean) %>% 
  count(arithmetic_mean == 0) %>% 
  mutate(observations = sum(n), 
    percent_of_total = n/sum(n))
  
final_percent_non_zero <- 
  percent_zero %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean == 0` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations,
                percent_non_zero = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange(percent_non_zero)

# percent_na <-   # there are no nas
#   air_data_corrections %>% 
#   group_by(parameter_code) %>% 
#    dplyr::select(parameter_code,
#                  arithmetic_mean) %>% 
#   count(is.na(arithmetic_mean)) %>% 
#   mutate(observations = sum(n), 
#      percent_of_total = n/sum(n))

save(air_data_corrections_mdl, 
     file = "air_data_corrections_mdl.rdata")
  
```


```{r correct carbon, eval=FALSE, include=FALSE}

load(file = "onlytheonesIwant.rdata")

datatobecorrected <- 
  onlytheonesIwant
rm(onlytheonesIwant)

# # for each row of TOT EC, make new row with TOR EC
# 
# change those coded as 88381 to 99381
all_air_data_correctedEC88381<-rbind(datatobecorrected,datatobecorrected[Parameter.Code==88381][,c('Arithmetic.Mean','Parameter.Code') := list(Arithmetic.Mean*1.3,"99381")])

# change those coded as 88307 to 99307 in output from prior step
all_air_data_correctedEC88307and88381 <- 
  rbind(all_air_data_correctedEC88381,
        all_air_data_correctedEC88381[
          Parameter.Code=="88307"][,c('Arithmetic.Mean',
                                    'Parameter.Code') :=
                                   list(Arithmetic.Mean*1.3,
                                        "99307")])
rm(all_air_data_correctedEC88381)
gc()

# change those coded as 88316 to 99316 in output from prior step
all_air_data_correctedEC88316and88307and88381 <- 
  rbind(all_air_data_correctedEC88307and88381,
        all_air_data_correctedEC88307and88381[
          Parameter.Code=="88316"][,c('Arithmetic.Mean',
                                    'Parameter.Code') :=
                                   list(Arithmetic.Mean*1.3,"99316")])

rm(all_air_data_correctedEC88307and88381)
gc()

# check the above for a sample date
# View(all_air_data_correctedEC88316and88307and88381[all_air_data_correctedEC88316and88307and88381$Parameter.Code %in% c(88316, 99316),])

# make one new EC code for all EC types called 99321
all_air_data_correctedEC <- 
  rbind(all_air_data_correctedEC88316and88307and88381,
        all_air_data_correctedEC88316and88307and88381[
          all_air_data_correctedEC88316and88307and88381$Parameter.Code %in% 
            c("88321",
              "99381",
              "99307",
              "99316"),][,c('Arithmetic.Mean',
                            'Parameter.Code') := list(Arithmetic.Mean,
                                                      "99321")])

# check the above for a sample date
# View(all_air_data_correctedEC[which(all_air_data_correctedEC$Parameter.Code %in% c("88321","88316","88381","88307","99321") & all_air_data_correctedEC$Date.Local == "2010-01-02")])

# # make a table of counts per parameter code
# table(all_air_data_correctedEC$Parameter.Code)

# remove interim files to save memory
rm(all_air_data_correctedEC88316and88307and88381)


# make one new PM2.5 code, 99101, for both FRM and non-FRM
all_air_data_corrected <- 
  rbind(all_air_data_correctedEC,
        all_air_data_correctedEC[
          all_air_data_correctedEC$Parameter.Code %in% 
            c("88101",
              "88502"),][,c('Arithmetic.Mean',
                            'Parameter.Code') := list(Arithmetic.Mean,
                                                      "99101")])
gc()

# check the above for a sample date
# View(all_air_data_corrected[which(all_air_data_corrected$parameter_code %in% c("88101","88502","99101") & all_air_data_corrected$Date.Local == "2010-01-02")])

# remove extraneous files to save memory
rm(all_air_data_correctedEC,
   datatobecorrected)

# save all_air_data_corrected to disk
save(all_air_data_corrected,
     file = "all_air_data_corrected.rdata")

#clear memory
gc()
```


```{r add rurality, eval=FALSE, include=FALSE}

#####
# rurality
# load all_air_data_corrected if not running straight
load(file = "all_air_data_corrected.rdata")

# read in data
rucacodes <- 
  read.csv(file = "ruca2010.csv")

# pull only tract_ID and ruca codes and name columns
onlyruca <- 
  rucacodes[,c(4,5,6)]
colnames(onlyruca) <- 
  c("tract_ID",
    "ruca_prime",
    "ruca_second")

# coerce tract_ID to character
onlyruca$tract_ID <- 
  as.character(onlyruca$tract_ID)

# set to urban or not urban based on RUCA codes
onlyruca$urban <- 'noturban'
onlyruca <- 
  within(onlyruca, 
         urban[ruca_second == 1.0 | 
                 ruca_second == 1.1 | 
                 ruca_second == 2.0 | 
                 ruca_second == 2.1 | 
                 ruca_second == 3.0 | 
                 ruca_second == 3.1 | 
                 ruca_second == 4.1 | 
                 ruca_second == 5.1 | 
                 ruca_second == 6.1 | 
                 ruca_second == 7.1 | 
                 ruca_second == 8.1 | 
                 ruca_second == 9.1 | 
                 ruca_second == 10.1] <- 
           'urban')

# add rurality to all_air_data_corrected (note: ones in non-US don't have RUCA codes)
allairdataandruca <- 
  merge(all_air_data_corrected,
        onlyruca,
        by = "tract_ID", 
        all.x = TRUE)
levels(allairdataandruca$urban)
whataretheseNAs <- 
  allairdataandruca[is.na(allairdataandruca$urban)]
unique(whataretheseNAs$State.Code)
onlyurbanruca <- 
  onlyruca[which(onlyruca$urban == 'urban'),]
save(onlyruca,
     file="onlyruca.rdata")
save(onlyurbanruca,
     file="onlyurbanruca.rdata")

# remove unneeded files
rm(all_air_data_corrected,
   whataretheseNAs,
   onlyruca,
   rucacodes)
gc()
```


```{r remove non-states and format dates, eval=FALSE, include=FALSE}

load(file = "allairdataandruca.rdata")

# remove non-states
allairdataandruca <- 
  allairdataandruca[!(is.na(allairdataandruca$urban))]

# format dates

# convert to date if not already
allairdataandruca$Date.Local <- 
  as.Date(allairdataandruca$Date.Local)
str(allairdataandruca$Date.Local)

#get months
allairdataandruca$month <- 
  format(allairdataandruca$Date.Local,
         format = "%m")

#get years
allairdataandruca$year <- 
  format(allairdataandruca$Date.Local,
         format = "%y")

# remove no-longer-needed files from memory
rm(all_air_data_corrected,
   whataretheseNAs,
   onlyruca,
   rucacodes)

# save allairdataandruca to disk
save(allairdataandruca,
     file = "allairdataandruca.rdata")
gc()
```


```{r create files for sensitivity analyses, eval=FALSE, include=FALSE}
# countthisdata and countthisdatasimple give the number of observations for that pollutant at each monitor to use later in sensitivity analysis
# this code drops those pollutants for each monitor which don't meet the conditions at least 5 years with 300 observations (300 observations over 365*5=1825 days)

load(file = "countthisdata.rdata")

# drop rows with <300 observations
atleast300obs <- 
  countthisdata[which(countthisdata$count >=300),]

# find first and last date for each pollutant for each tract
atleast300obs %>%
  group_by(Parameter.Code, 
           tract_ID) %>%
  mutate(FirstDate = min(Date.Local), 
         LastDate = max(Date.Local)) -> 
  atleast300obsfirstlastdate
rm(atleast300obs)
gc()

# subtract them
atleast300obsfirstlastdate$date_difference <- 
  atleast300obsfirstlastdate$LastDate - atleast300obsfirstlastdate$FirstDate
gc()

# delete rows where there aren't enough days
atleast5years300obs <- 
  atleast300obsfirstlastdate[which(atleast300obsfirstlastdate$date_difference >= 1825),]
rm(atleast300obsfirstlastdate)
gc()

# save final file to disk and then remove for later loading
save(atleast5years300obs,
     file = "atleast5years300obs.rdata")
rm(atleast5years300obs)


# this code drops those pollutants for each monitor which don't meet the conditions of 3 years or 180 observations (180 observations over 365*3=1095 days)

# drop rows with <180 observations
atleast180obs <- 
  countthisdata[which(countthisdata$count >=180),]

# find first and last date for each pollutant for each tract
atleast180obs %>%
  group_by(Parameter.Code, tract_ID) %>%
  mutate(FirstDate = min(Date.Local), 
         LastDate = max(Date.Local)) -> 
  atleast180obsfirstlastdate
rm(atleast180obs)
gc()

# subtract them
atleast180obsfirstlastdate$date_difference <- 
  atleast180obsfirstlastdate$LastDate - atleast180obsfirstlastdate$FirstDate
gc()

# delete rows where there aren't enough days
atleast3years180obs <- 
  atleast180obsfirstlastdate[which(atleast180obsfirstlastdate$date_difference >= 1095),]
rm(atleast180obsfirstlastdate)
gc()

# save final file to disk and then remove for later loading
save(atleast3years180obs,
     file = "atleast3years180obs.rdata")
rm(atleast3years180obs)
```


```{r create dataset to check minimum detection limits for sensitivity analyses, eval=FALSE, include=FALSE}

# get necessary datasets
load(file = "elements_and_codes.rdata")

methods_speciation <- 
  read_csv(file = "methods_speciation.csv",
           col_types = 
             cols(Parameter = col_character(),
                  `Parameter Code` = col_character(),
                  `Method Code` = col_character(),
                  `Recording Mode` = col_character(),
                  `Collection Description` = col_character(),
                  `Analysis Description` = col_character(),
                  `Method Type` = col_character(),
                  `Reference Method ID` = col_character(),
                  `Equivalent Method` = col_character(),
                  `Federal MDL` = col_double(),
                  `Min Value` = col_double(),
                  `Max Value` = col_double(),
                  Digits = col_double(),
                  `Round Truncate Indicator` = col_character(),
                  Units = col_character()))

# fix column names
methods_speciation_fixed_column_names <-
  methods_speciation %>%
  colnames() %>% 
  tolower() %>% 
  {gsub(" ", "_", .)}

colnames(methods_speciation) <- 
  methods_speciation_fixed_column_names

# add half detection limit column
methods_speciation <- 
  methods_speciation %>% 
  mutate(half_mdl = federal_mdl/2)


## all data work ####
load(file = "countthisdata.rdata")

# make working full dataset
air_data_all_obs <- 
  as_tibble(countthisdata)
rm(countthisdata)
gc()

# fix column types
air_data_all_obs <-
  air_data_all_obs %>% 
  mutate_if(is.factor, 
            as.character) %>% 
  mutate(method_code = 
           as.character(Method.Code),
         Method.Code = NULL)

# fix column names
air_data_all_obs_corrected_colnames <-
  air_data_all_obs %>% 
  colnames() %>% 
  tolower() %>% 
  {gsub("\\.", "_", .)}

colnames(air_data_all_obs) <- 
  air_data_all_obs_corrected_colnames

# fix column types
air_data_all_obs <- 
  air_data_all_obs %>% 
  mutate(parameter_code = as.character(parameter_code),
         method_code = as.character(method_code))

# merge speciation methods with detection limits
air_data_all_obs_mdl <- 
  air_data_all_obs %>% 
  left_join(methods_speciation, 
            by = c("parameter_code", 
                   "method_code"))
rm(air_data_all_obs)
gc()

# figure out percent above mdl for each species
air_all_obs_mdl_num <- 
  air_data_all_obs_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean,
                federal_mdl) %>% 
  count(arithmetic_mean < federal_mdl) %>% 
  mutate(observations = sum(n), 
         percent_of_total = n/sum(n))

# fix pm2.5
pm25_nas_below_mdl <- 
  air_data_all_obs_mdl %>% 
    filter(parameter_code == "88101", 
           is.na(method_code)) %>% 
    dplyr::select(parameter_code, 
           federal_mdl, 
           arithmetic_mean, 
           method_name, 
           method_code) %>% 
  filter(arithmetic_mean <= 0) %>% 
  tally()

pm25_nas_above_mdl <- 
  air_data_all_obs_mdl %>% 
    filter(parameter_code == "88101", 
           is.na(method_code)) %>% 
    dplyr::select(parameter_code, 
           federal_mdl, 
           arithmetic_mean, 
           method_name, 
           method_code) %>% 
  filter(arithmetic_mean > 0) %>% 
  tally()

pm25_non_nas_below_mdl <- 
  air_all_obs_mdl_num %>% 
  filter(parameter_code == "88101",
           `arithmetic_mean < federal_mdl` == TRUE) %>% 
  pull(n)

pm25_non_nas_above_mdl <- 
  air_all_obs_mdl_num %>% 
  filter(parameter_code == "88101",
           `arithmetic_mean < federal_mdl` == FALSE) %>% 
  pull(n)

air_all_obs_mdl_num <- 
  air_all_obs_mdl_num %>%
  mutate(n = 
           replace(n, 
                   parameter_code == "88101" & 
                     `arithmetic_mean < federal_mdl` == TRUE, 
                   pm25_non_nas_below_mdl + pm25_nas_below_mdl)) %>% 
   mutate(n = 
           replace(n, 
                   parameter_code == "88101" & 
                     `arithmetic_mean < federal_mdl` == FALSE, 
                   pm25_non_nas_above_mdl + pm25_nas_above_mdl)) %>% 
  mutate(n = as.numeric(n)) %>% 
  mutate(percent_of_total = n / observations)

  
air_all_obs_mdl_percent <- 
  air_all_obs_mdl_num %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean < federal_mdl` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations_all_year = observations,
                percent_above_mdl_all_year = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange()

# figure out percent zero for each species
air_all_obs_zero_num <- 
  air_data_all_obs_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean) %>% 
  count(arithmetic_mean == 0) %>% 
  mutate(observations = sum(n), 
    percent_of_total = n/sum(n))
  
air_all_obs_zero_percent <- 
  air_all_obs_zero_num %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean == 0` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations_all_year = observations,
                percent_non_zero_all_year = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange()

save(air_data_all_obs_mdl, 
     file = "air_data_all_obs_mdl.rdata")

save(air_all_obs_mdl_num, 
     file = "air_all_obs_mdl_num.rdata")
save(air_all_obs_mdl_percent, 
     file = "air_all_obs_mdl_percent.rdata")

save(air_all_obs_zero_num, 
     file = "air_all_obs_zero_num.rdata")
save(air_all_obs_zero_percent, 
     file = "air_all_obs_zero_percent.rdata")

rm(air_data_all_obs_mdl)
gc()



## 3-year data work ####

# get necessary datasets
load(file = "atleast3years180obs.rdata")

# make working 3-year dataset
air_data_3_year_180_obs <- 
  as_tibble(atleast3years180obs)
rm(atleast3years180obs)
gc()

# fix column types
air_data_3_year_180_obs <-
  air_data_3_year_180_obs %>% 
  mutate_if(is.factor, 
            as.character) %>% 
  mutate(method_code = 
           as.character(Method.Code),
         Method.Code = NULL)

# fix column names
air_data_3_year_180_obs_corrected_colnames <-
  air_data_3_year_180_obs %>% 
  colnames() %>% 
  tolower() %>% 
  {gsub("\\.", "_", .)}

colnames(air_data_3_year_180_obs) <- 
  air_data_3_year_180_obs_corrected_colnames

# fix column types
air_data_3_year_180_obs <- 
  air_data_3_year_180_obs %>% 
  mutate(parameter_code = as.character(parameter_code),
         method_code = as.character(method_code))

# merge speciation methods with detection limits
air_data_3_year_180_obs_mdl <- 
  air_data_3_year_180_obs %>% 
  left_join(methods_speciation, 
            by = c("parameter_code", 
                   "method_code"))
rm(air_data_3_year_180_obs)
gc()

# figure out percent above mdl for each species
air_3_year_180_obs_mdl_num <- 
  air_data_3_year_180_obs_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean,
                federal_mdl) %>% 
  count(arithmetic_mean < federal_mdl) %>% 
  mutate(observations = sum(n), 
         percent_of_total = n/sum(n))
  
air_3_year_180_obs_mdl_percent <- 
  air_3_year_180_obs_mdl_num %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean < federal_mdl` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations_3_year = observations,
                percent_above_mdl_3_year = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange()

# figure out percent zero for each species
air_3_year_180_obs_zero_num <- 
  air_data_3_year_180_obs_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean) %>% 
  count(arithmetic_mean == 0) %>% 
  mutate(observations = sum(n), 
    percent_of_total = n/sum(n))
  
air_3_year_180_obs_zero_percent <- 
  air_3_year_180_obs_zero_num %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean == 0` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations_3_year = observations,
                percent_non_zero_3_year = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange()

save(air_data_3_year_180_obs_mdl, 
     file = "air_data_3_year_180_obs_mdl.rdata")
save(air_3_year_180_obs_mdl_num, 
     file = "air_3_year_180_obs_mdl_num.rdata")
save(air_3_year_180_obs_mdl_percent, 
     file = "air_3_year_180_obs_mdl_percent.rdata")

save(air_3_year_180_obs_zero_num, 
     file = "air_3_year_180_obs_zero_num.rdata")
save(air_3_year_180_obs_zero_percent, 
     file = "air_3_year_180_obs_zero_percent.rdata")

rm(air_data_3_year_180_obs_mdl)
gc()


# 5-year data work ####
load(file = "atleast5years300obs.rdata")

# make working 5-year dataset
air_data_5_year_300_obs <- 
  as_tibble(atleast5years300obs)
rm(atleast5years300obs)
gc()

# fix column types
air_data_5_year_300_obs <-
  air_data_5_year_300_obs %>% 
  mutate_if(is.factor, 
            as.character) %>% 
  mutate(method_code = 
           as.character(Method.Code),
         Method.Code = NULL)

# fix column names
air_data_5_year_300_obs_corrected_colnames <-
  air_data_5_year_300_obs %>% 
  colnames() %>% 
  tolower() %>% 
  {gsub("\\.", "_", .)}

colnames(air_data_5_year_300_obs) <- 
  air_data_5_year_300_obs_corrected_colnames

# fix column types
air_data_5_year_300_obs <- 
  air_data_5_year_300_obs %>% 
  mutate(parameter_code = as.character(parameter_code),
         method_code = as.character(method_code))

# merge speciation methods with detection limits
air_data_5_year_300_obs_mdl <- 
  air_data_5_year_300_obs %>% 
  left_join(methods_speciation, 
            by = c("parameter_code", 
                   "method_code"))
rm(air_data_5_year_300_obs)
gc()

# figure out percent above mdl for each species
air_5_year_300_obs_mdl_num <- 
  air_data_5_year_300_obs_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean,
                federal_mdl) %>% 
  count(arithmetic_mean < federal_mdl) %>% 
  mutate(observations = sum(n), 
         percent_of_total = n/sum(n))
  
air_5_year_300_obs_mdl_percent <- 
  air_5_year_300_obs_mdl_num %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean < federal_mdl` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations_5_year = observations,
                percent_above_mdl_5_year = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange()

# figure out percent zero for each species
air_5_year_300_obs_zero_num <- 
  air_data_5_year_300_obs_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean) %>% 
  count(arithmetic_mean == 0) %>% 
  mutate(observations = sum(n), 
    percent_of_total = n/sum(n))
  
air_5_year_300_obs_zero_percent <- 
  air_5_year_300_obs_zero_num %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean == 0` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations_5_year = observations,
                percent_non_zero_5_year = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange()

save(air_data_5_year_300_obs_mdl, 
     file = "air_data_5_year_300_obs_mdl.rdata")

save(air_5_year_300_obs_mdl_num, 
     file = "air_5_year_300_obs_mdl_num.rdata")
save(air_5_year_300_obs_mdl_percent, 
     file = "air_5_year_300_obs_mdl_percent.rdata")

save(air_5_year_300_obs_zero_num, 
     file = "air_5_year_300_obs_zero_num.rdata")
save(air_5_year_300_obs_zero_percent, 
     file = "air_5_year_300_obs_zero_percent.rdata")

```


```{r counting monitors and tracts, eval=FALSE, include=FALSE}

# load countthisdata if not running straight
# observations and mdls
load(file = 
     "air_data_all_obs_mdl.rdata")
load(file = "fullcensus.rdata")

components_for_paper <- 
  c("88101",
    "88104",
    "88103",
    "88109",
    "88111",
    "88110",
    "88115",
    "88114",
    "88126",
    "88128",
    "88142",
    "88184",
    "88136",
    "88165",
    "88161",
    "88164",
    "88167",
    "88302",
    "88301",
    "88306",
    "88403",
    "88307",
    "88316", 
    "88321",
    "88381")

# make total population column
census_total_population <- 
  fullcensus[
    c("GEOID10", 
      "DP0010001")]
colnames(census_total_population) <- 
  c("tract_ID",
    "total_population_DP0010001")
census_total_population <- 
  as_tibble(census_total_population)

# add total population column to main dataset
full_data_for_exclusions <- 
  air_data_all_obs_mdl %>% 
  left_join(census_total_population, 
            by = c("tract_id" = "tract_ID"), 
            copy = TRUE)

rm(air_data_all_obs_mdl)
rm(fullcensus)
gc()

counting_data_all <- 
  full_data_for_exclusions %>% 
  filter(urban == urban) %>% 
  filter(total_population_DP0010001 > 100)

pollutants_and_monitors <- 
  counting_data_all[,c("Parameter.Code",
                                "monitor_ID")] %>% 
  unique()

# count monitors per pollutant
monitors_per_pollutant <- 
  pollutants_and_monitors %>% # make the counts
  group_by(Parameter.Code) %>%
  mutate(count = n())

# reduce to parameters and monitors
monitors_per_pollutant <- 
  unique(monitors_per_pollutant[,c(1,3)])

# make ordered list of monitors per pollutant
monitors_per_pollutant_ordered <- 
  monitors_per_pollutant[
    match(
      components_for_paper, 
      monitors_per_pollutant$Parameter.Code
      )
    ]

write.csv(monitors_per_pollutant_ordered,
          file = "results/monitors_per_pollutant_ordered.csv")


# count tracts per pollutant in raw data without exclusions
pollutants_and_tracts <- 
  counting_data_all[,c("Parameter.Code",
                                "tract_ID")] %>% 
  unique()

tracts_per_pollutant <- 
  pollutants_and_tracts %>%
  group_by(Parameter.Code) %>%
  mutate(count = n())

tracts_per_pollutant <- 
  unique(tractsperpollutant[,c(1,3)])

# make ordered list of tracts per pollutant
tracts_per_pollutant_ordered <- 
  tracts_per_pollutant[
    match(
      components_for_paper, 
      tracts_per_pollutant$Parameter.Code
      )
    ]

write.csv(tracts_per_pollutant_ordered,
          file = "results/tracts_per_pollutant_ordered.csv")

# save files to disk
save(monitors_per_pollutant_ordered,
     file = "monitors_per_pollutant_ordered.rdata")
save(tracts_per_pollutant_ordered,
     file = "tracts_per_pollutant_ordered.rdata")






#### three-year 180-day data
load(file = "air_data_3_year_180_obs_mdl.rdata")



# figure out percent above mdl for each species
air_3_year_180_obs_mdl_num <- 
  air_data_3_year_180_obs_mdl %>%   # this takes observations as the default
  group_by(parameter_code) %>% 
  dplyr::select(parameter_code,
                arithmetic_mean,
                federal_mdl) %>% 
  count(arithmetic_mean < federal_mdl) %>% 
  mutate(observations = sum(n), 
         percent_of_total = n/sum(n))
  
air_3_year_180_obs_mdl_percent <- 
  air_3_year_180_obs_mdl_num %>% 
  group_by(parameter_code) %>% 
  filter(`arithmetic_mean < federal_mdl` == FALSE) %>% 
  dplyr::select(parameter_code, 
                observations_3_year = observations,
                percent_above_mdl_3_year = percent_of_total) %>% 
  left_join(elements_and_codes, 
            by = "parameter_code") %>% 
  arrange()




``` 

```{r count data detritus}

# count monitors per pollutant in raw data without exclusions
pollutantsandmonitors <- 
  allairdataandruca[,c("Parameter.Code",
                       "monitor_ID")] # select only data points needed
# View(pollutantsandmonitors)
pollutantsandmonitors <- 
  unique(pollutantsandmonitors)
# View(pollutantsandmonitors)

monitorsperpollutant <- 
  pollutantsandmonitors %>% # make the counts
  group_by(Parameter.Code) %>%
  mutate(count = n())
monitorsperpollutant <- 
  unique(monitorsperpollutant[,c(1,3)])
# View(monitorsperpollutant)

# count tracts per pollutant in raw data without exclusions
pollutantsandtracts <- 
  allairdataandruca[,c("Parameter.Code",
                       "tract_ID")]
pollutantsandtracts <- 
  unique(pollutantsandtracts)
# View(pollutantsandtracts)
tractsperpollutant <- 
  pollutantsandtracts %>%
  group_by(Parameter.Code) %>%
  mutate(count = n())
# View(tractsperpollutant)
tractsperpollutant <- 
  unique(tractsperpollutant[,c(1,3)])
# View(tractsperpollutant)

# save files to disk
save(countthisdata,
     file = "countthisdata.rdata")
save(countthisdatasimple,
     file = "countthisdatasimple.rdata")
save(monitorsperpollutant,
     file = "monitorsperpollutant.rdata")
save(tractsperpollutant,
     file = "tractsperpollutant.rdata")

# save results into their own special folder
if(!dir.exists("results")) dir.create("results") # create special folder if it isn't already there
save(monitorsperpollutant,
     file = "results/monitorsperpollutant.rdata")
write.csv(monitorsperpollutant,
          file = "results/monitorsperpollutant.csv")
save(tractsperpollutant,
     file="results/tractsperpollutant.rdata")
write.csv(tractsperpollutant,
          file = "results/tractperpollutant.csv")

# remove unneeded files
rm(pollutantsandtracts,
   pollutantsandmonitors,
   countthisdatasimple,
   allairdataandruca)
gc()


load(file = "countthisdata.rdata")
load(file = "monitorsperpollutant.rdata")
load(file = "tractsperpollutant.rdata")

components_for_paper <- 
  c("88101",
    "88104",
    "88103",
    "88109",
    "88111",
    "88110",
    "88115",
    "88114",
    "88126",
    "88128",
    "88142",
    "88184",
    "88136",
    "88165",
    "88161",
    "88164",
    "88167",
    "88302",
    "88301",
    "88306",
    "88403",
    "88307",
    "88316", 
    "88321",
    "88381")

# make ordered list of monitors per pollutant
monitors_per_pollutant_ordered <- 
  monitorsperpollutant[
    match(
      components_for_paper, 
      monitorsperpollutant$Parameter.Code
      )
    ]

write.csv(monitors_per_pollutant_ordered,
          file = "results/monitors_per_pollutant_ordered.csv")

# make ordered list of tracts per pollutant
tracts_per_pollutant_ordered <- 
  tractsperpollutant[
    match(
      components_for_paper, 
      tractsperpollutant$Parameter.Code
      )
    ]

write.csv(tracts_per_pollutant_ordered,
          file = "results/tracts_per_pollutant_ordered.csv")

load(file = 
       "air_data_all_obs_mdl.rdata")
load(file = 
       "air_all_obs_mdl_num.rdata")
load(file = 
       "air_all_obs_mdl_percent.rdata")

View(air_data_all_obs_mdl)
View(air_all_obs_mdl_num)
View(air_all_obs_mdl_percent)

# make ordered list of mdls and nondetects per pollutant
obs_nondetect_per_pollutant_ordered <- 
  air_all_obs_mdl_percent[
    match(
      components_for_paper, 
      air_all_obs_mdl_percent$parameter_code
      ),
    ]

obs_nondetect_per_pollutant_ordered <- 
  obs_nondetect_per_pollutant_ordered %>% 
  mutate(non_detect_percent = 
           1 - percent_above_mdl_all_year)

write.csv(
  obs_nondetect_per_pollutant_ordered, 
  file = 
    "results/obs_nondetect_per_pollutant_ordered.csv")
)

colnames(air_all_obs_mdl_num)

nondetects <- 
  air_all_obs_mdl_num %>% 
  filter(`arithmetic_mean < federal_mdl` == TRUE) %>% 
  arrange(match(parameter_code, 
                components_for_paper))

write.csv(nondetects, 
          file = 
            "results/nondetects.csv")



# 3 year 180 observation data

# count monitors per pollutant in raw data without exclusions
pollutantsandmonitors <- 
  atleast3years[,c("Parameter.Code",
                       "monitor_ID")] # select only data points needed
# View(pollutantsandmonitors)
pollutantsandmonitors <- 
  unique(pollutantsandmonitors)
# View(pollutantsandmonitors)

monitorsperpollutant <- 
  pollutantsandmonitors %>% # make the counts
  group_by(Parameter.Code) %>%
  mutate(count = n())
monitorsperpollutant <- 
  unique(monitorsperpollutant[,c(1,3)])
# View(monitorsperpollutant)

# count tracts per pollutant in raw data without exclusions
pollutantsandtracts <- 
  allairdataandruca[,c("Parameter.Code",
                       "tract_ID")]
pollutantsandtracts <- 
  unique(pollutantsandtracts)
# View(pollutantsandtracts)
tractsperpollutant <- 
  pollutantsandtracts %>%
  group_by(Parameter.Code) %>%
  mutate(count = n())
# View(tractsperpollutant)
tractsperpollutant <- 
  unique(tractsperpollutant[,c(1,3)])
# View(tractsperpollutant)


  


```


```{r mdl analysis}

# make table of all 3
load(file = "air_5_year_300_obs_mdl_percent.rdata")
load(file = "air_3_year_180_obs_mdl_percent.rdata")
load(file = "air_all_obs_mdl_percent.rdata")
load(file = "air_all_obs_mdl_num.rdata")
load(file = "air_3_year_180_obs_mdl_num.rdata")
load(file = "air_5_year_300_obs_mdl_num.rdata")

mdl_num_tibbles <- 
  list(air_all_obs_mdl_num, 
      air_3_year_180_obs_mdl_num, 
      air_5_year_300_obs_mdl_num)

mdl_percent_tibbles <- 
 list(air_all_obs_mdl_percent, 
      air_3_year_180_obs_mdl_percent, 
      air_5_year_300_obs_mdl_percent
 )

all_mdl_percents <- 
  reduce(mdl_percent_tibbles, 
      full_join, 
      by = c("parameter_code", 
             "component"))

# figure out ECs
ec_rows_all_obs <- 
  air_all_obs_mdl_num %>% 
  filter(parameter_code %in% 
           c("88307", 
            "88316", 
            "88381"))
sum_ec_all_obs <- 
  sum(ec_rows_all_obs$n)

ec_below_mdl_all_obs <- 
  ec_rows_all_obs %>% 
  filter(`arithmetic_mean < federal_mdl` == TRUE)

sum_ec_below_mdl_all_obs <- 
  sum(ec_below_mdl_all_obs$n)

ec_above_mdl_all_obs <- 
  ec_rows_all_obs %>% 
  filter(`arithmetic_mean < federal_mdl` == FALSE)

sum_ec_above_mdl_all_obs <- 
  sum(ec_above_mdl_all_obs$n)

ec_all_obs_percent_above_mdl <- 
  sum_ec_above_mdl_all_obs /
  sum_ec_all_obs





# figure out ECs
ec_rows_3_year <- 
  air_3_year_180_obs_mdl_num %>% 
  filter(parameter_code %in% 
           c("88307", 
            "88316", 
            "88381"))
sum_ec_3_year <- 
  sum(ec_rows_3_year$n)

ec_below_mdl_3_year <- 
  ec_rows_3_year %>% 
  filter(`arithmetic_mean < federal_mdl` == TRUE)

sum_ec_below_mdl_3_year <- 
  sum(ec_below_mdl_3_year$n)

ec_above_mdl_3_year <- 
  ec_rows_3_year %>% 
  filter(`arithmetic_mean < federal_mdl` == FALSE)

sum_ec_above_mdl_3_year <- 
  sum(ec_above_mdl_3_year$n)

ec_percent_above_mdl_3_year <- 
  sum_ec_above_mdl_3_year /
  sum_ec_3_year



# figure out ECs
ec_rows_5_year <- 
  air_5_year_300_obs_mdl_num %>% 
  filter(parameter_code %in% 
           c("88307", 
            "88316", 
            "88381"))
  

components_from_paper <- 
  c("PM2.5",
    "aluminum", 
    "ammonium ion", 
    "arsenic", 
    "bromine",  
    "calcium", 
    "chlorine", 
    "copper", 
    "elemental carbon",
    "iron", 
    "lead",
    "mercury", 
    "nickel", 
    "nitrate ion", 
    "silicon", 
    "sodium", 
    "sodium ion", 
    "sulfate ion", 
    "titanium", 
    "vanadium", 
    "zinc")

mdl_percent_tibbles$components


save(all_mdl_percents, 
     file = "all_mdl_percents.rdata")

View(all_mdl_percents)

select_components_for_paper <- 
  c("PM_25_FRM",
    "aluminum", 
    "ammonium_ion", 
    "arsenic", 
    "bromine",  
    "calcium", 
    "chlorine", 
    "copper",
    "iron", 
    "lead",
    "mercury", 
    "nickel", 
    "nitrate_ion", 
    "silicon", 
    "sodium", 
    "sodium_ion", 
    "sulfate ion", 
    "titanium", 
    "vanadium", 
    "zinc")

mdl_percents_for_graph <- 
  all_mdl_percents %>% 
  dplyr::select(component, 
         parameter_code, 
         observations_3_year, 
         percent_above_mdl_3_year) %>% 
  filter(component %in% select_components_for_paper) 

# names(mdl_percents_for_graph) <- components_from_paper
  

elemental_carbon_tibble <-  
  tibble(component = "elemental_carbon", 
         parameter_code = "ec", 
         observations_3_year = sum_ec_3_year, 
         percent_above_mdl_3_year = ec_percent_above_mdl_3_year)

mdl_percents_for_graph <- 
  mdl_percents_for_graph %>% 
  bind_rows(elemental_carbon_tibble)

ggplot(data = mdl_percents_for_graph, 
       aes(y = percent_above_mdl_3_year, 
           x = component)) +
  geom_bar(stat = "identity") + 
  ylab("% above MDL") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.25))
  
  
  

  
  
  
  
components_from_paper <- 
  c("PM2.5",
    "aluminum", 
    "ammonium ion", 
    "arsenic", 
    "bromine",  
    "calcium", 
    "chlorine", 
    "copper", 
    "elemental carbon",
    "iron", 
    "lead",
    "mercury", 
    "nickel", 
    "nitrate ion", 
    "silicon", 
    "sodium", 
    "sodium ion", 
    "sulfate ion", 
    "titanium", 
    "vanadium", 
    "zinc")

all_mdl_percents$component

```

## make racial isolation indices

```{r racial isolation indices, eval=FALSE, include=FALSE}

# Guide to this section:
# 1. List of groups of census tracts
#    a. Without nodes
#    b. With nodes
# 2. Isolation indices
#    a. All tracts
#    b. All urban tracts

#### preparation for all versions ####

# import ArcGIS table with adjacency results into R
censusadjacent <- 
  read.csv("censusadjacent.csv", 
           header = TRUE)

# import full census data
load(file = "fullcensus.rdata")

# import ruca data
load(file = "onlyurbanruca.rdata")

censusadjacent <- 
  censusadjacent[c(-1)]

censusadjacent$NODE_COUNT <- 
  as.numeric(censusadjacent$NODE_COUNT)

# import census data (Black, Black/other, total)
segregationvars <- 
  fullcensus[c("GEOID10", 
               "DP0100001", 
               "DP0110012")]

segregationvars$allbutblack <- 
  segregationvars$DP0100001 - 
  segregationvars$DP0110012 # create non-black

colnames(segregationvars)[1] <- 
  "selfneighbor"



#### without nodes ####

# remove nodes
censusadjacentnonodes <- censusadjacent[censusadjacent[,4]==0,]
censusadjacentnonodes <- censusadjacentnonodes[c(-4)]
censusadjacentnonodes <- as.data.frame(censusadjacentnonodes[c(-3)])
censusadjacentnonodes$src_GEOID10 <- as.factor(censusadjacentnonodes$src_GEOID10)
censusadjacentnonodes$nbr_GEOID10 <- as.factor(censusadjacentnonodes$nbr_GEOID10)

# get adjacent blocks into single column as single character w/ commas
require(data.table)
canncon <- 
  setDT(censusadjacentnonodes)[,.(nbr_GEOID10=paste(nbr_GEOID10, 
                                                    collapse = ",")),
                               by=src_GEOID10]

canncon$src_GEOID10 <- as.character(canncon$src_GEOID10)

# add own census tract to tracts
canncon$selfandfriends <- 
  paste(canncon$src_GEOID10, 
        canncon$nbr_GEOID10, 
        sep=",")

# save file to disk
save(canncon,
     file="canncon.rdata")
# load(file="canncon.rdata")


#### with nodes ####

# keep nodes
censusadjacentyesnodes <- censusadjacent
censusadjacentyesnodes <- censusadjacentyesnodes[c(-4)]
censusadjacentyesnodes <- as.data.frame(censusadjacentyesnodes[c(-3)])
censusadjacentyesnodes$src_GEOID10 <- 
  as.factor(censusadjacentyesnodes$src_GEOID10)
censusadjacentyesnodes$nbr_GEOID10 <- 
  as.factor(censusadjacentyesnodes$nbr_GEOID10)

# get adjacent blocks into single column as single character w/ commas
require(data.table)
cayncon <- setDT(censusadjacentyesnodes)[,.(nbr_GEOID10=paste(nbr_GEOID10, collapse = ",")), by=src_GEOID10]
cayncon$src_GEOID10 <- as.character(cayncon$src_GEOID10)

# add own census tract to tracts
cayncon$selfandfriends <- paste(cayncon$src_GEOID10, cayncon$nbr_GEOID10, sep=",")
str(cayncon)

# save file to disk
save(cayncon,
     file="cayncon.rdata")
# load(file="cayncon.rdata")




#### racial isolation index with nodes urban tracts ####

monitorct <- 
  cayncon[which(cayncon$src_GEOID10 %in% onlyurbanruca$tract_ID),]

# neighbors for each census tract plus itself
temp <- strsplit(monitorct$selfandfriends, split=",")
ltemp <- sapply(temp, length)
ct.nb <- data.frame(censustract = rep(NA, sum(ltemp)), selfneighbor = NA)
ct.nb[1:ltemp[1], "censustract"] <- monitorct[1, "src_GEOID10"]
ct.nb[1:ltemp[1], "selfneighbor"] <- temp[[1]]
for (i in 2:length(temp)) {
  st <- sum(ltemp[1:i-1])
  ct.nb[(st+1):(st+ltemp[i]), "censustract"] <- monitorct[i, "src_GEOID10"]
  ct.nb[(st+1):(st+ltemp[i]), "selfneighbor"] <- temp[[i]]
}

# merge the popoulation info
segindcalcbasis <- merge(segregationvars, ct.nb, by="selfneighbor")

# aggregate by census tract
aggregatevars <- segindcalcbasis[c("censustract", 
                                   "DP0100001", 
                                   "DP0110012", 
                                   "allbutblack")]
as.numeric(aggregatevars$DP0100001, 
           aggregatevars$DP0110012, 
           aggregatevars$allbutblack)

aggregatedcensus <- 
  aggregate(. ~ censustract, 
            data = aggregatevars, sum)

aggregatedcensus$finalsegregationindex <- 
  aggregatedcensus$DP0110012/aggregatedcensus$DP0100001

aggregatedcensus$GEOID10 <- aggregatedcensus$censustract

RI_yes_nodes_urban_tracts <- 
  aggregatedcensus[c("GEOID10",
                     "finalsegregationindex")]

RI_yes_nodes_urban_tracts$GEOID10 <- as.factor(RI_yes_nodes_urban_tracts$GEOID10)

colnames(RI_yes_nodes_urban_tracts) <- c("tract_ID","RI_nodes_urban")
# View(RI_yes_nodes_urban_tracts)

# save RI for all urban tracts with nodes
save(RI_yes_nodes_urban_tracts, 
     file="RI_yes_nodes_urban_tracts.rdata")
load(file="RI_yes_nodes_urban_tracts.rdata")

# remove temporary files
rm(segindcalcbasis, 
   aggregatevars, 
   aggregatedcensus, 
   ct.nb, 
   temp, 
   ltemp, 
   st, 
   i, 
   monitorct)




#### racial isolation index without nodes urban tracts ####

monitorct <- canncon[which(cayncon$src_GEOID10 %in% onlyurbanruca$tract_ID),]

# neighbors for each census tract plus itself
temp <- strsplit(monitorct$selfandfriends, split=",")
ltemp <- sapply(temp, length)
ct.nb <- data.frame(censustract = rep(NA, sum(ltemp)), selfneighbor = NA)
ct.nb[1:ltemp[1], "censustract"] <- monitorct[1, "src_GEOID10"]
ct.nb[1:ltemp[1], "selfneighbor"] <- temp[[1]]
for (i in 2:length(temp)) {
  st <- sum(ltemp[1:i-1])
  ct.nb[(st+1):(st+ltemp[i]), "censustract"] <- monitorct[i, "src_GEOID10"]
  ct.nb[(st+1):(st+ltemp[i]), "selfneighbor"] <- temp[[i]]
}

# merge the popoulation info
segindcalcbasis <- merge(segregationvars, ct.nb, by="selfneighbor")

# aggregate by census tract
aggregatevars <- segindcalcbasis[c("censustract", "DP0100001", "DP0110012", "allbutblack")]
as.numeric(aggregatevars$DP0100001, aggregatevars$DP0110012, aggregatevars$allbutblack)
aggregatedcensus <- aggregate(. ~ censustract, data = aggregatevars, sum)
aggregatedcensus$finalsegregationindex <- aggregatedcensus$DP0110012/aggregatedcensus$DP0100001
aggregatedcensus$GEOID10 <- aggregatedcensus$censustract
RI_no_nodes_urban_tracts <- aggregatedcensus[c("GEOID10","finalsegregationindex")]
RI_no_nodes_urban_tracts$GEOID10 <- as.factor(RI_no_nodes_urban_tracts$GEOID10)
colnames(RI_no_nodes_urban_tracts) <- c("tract_ID","RI_no_nodes_urban")
# View(RI_no_nodes_urban_tracts)

# save RI for all urban tracts w/o nodes
save(RI_no_nodes_urban_tracts, file="RI_no_nodes_urban_tracts.rdata")
load(file="RI_no_nodes_urban_tracts.rdata")

# remove temporary files
rm(segindcalcbasis, aggregatevars, aggregatedcensus, ct.nb, temp, ltemp, st, i, monitorct)




#### racial isolation index with nodes all tracts ####

# all census tracts only
monitorct <- cayncon

# neighbors for each census tract plus itself
temp <- strsplit(monitorct$selfandfriends, split=",")
ltemp <- sapply(temp, length)
ct.nb <- data.frame(censustract = rep(NA, sum(ltemp)), selfneighbor = NA)
ct.nb[1:ltemp[1], "censustract"] <- monitorct[1, "src_GEOID10"]
ct.nb[1:ltemp[1], "selfneighbor"] <- temp[[1]]
for (i in 2:length(temp)) {
  st <- sum(ltemp[1:i-1])
  ct.nb[(st+1):(st+ltemp[i]), "censustract"] <- monitorct[i, "src_GEOID10"]
  ct.nb[(st+1):(st+ltemp[i]), "selfneighbor"] <- temp[[i]]
}

# merge the popoulation info
segindcalcbasis <- merge(segregationvars, ct.nb, by="selfneighbor")

# aggregate by census tract
aggregatevars <- segindcalcbasis[c("censustract", "DP0100001", "DP0110012", "allbutblack")]
as.numeric(aggregatevars$DP0100001, aggregatevars$DP0110012, aggregatevars$allbutblack)
aggregatedcensus <- aggregate(. ~ censustract, data = aggregatevars, sum)
aggregatedcensus$finalsegregationindex <- aggregatedcensus$DP0110012/aggregatedcensus$DP0100001
aggregatedcensus$GEOID10 <- aggregatedcensus$censustract
RI_yes_nodes_all_tracts <- aggregatedcensus[c("GEOID10","finalsegregationindex")]
RI_yes_nodes_all_tracts$GEOID10 <- as.factor(RI_yes_nodes_all_tracts$GEOID10)
colnames(RI_yes_nodes_all_tracts) <- c("tract_ID","RI_nodes_all")
# View(RI_yes_nodes_all_tracts)

# save RI for all tracts with nodes
save(RI_yes_nodes_all_tracts, 
     file="RI_yes_nodes_all_tracts.rdata")
load(file="RI_yes_nodes_all_tracts.rdata")
# View(RI_yes_nodes_all_tracts)

# remove temporary files
rm(segindcalcbasis, aggregatevars, aggregatedcensus, ct.nb, temp, ltemp, st, i, monitorct)




#### racial isolation index no nodes all tracts ####

# all census tracts only
monitorct <- canncon

# neighbors for each census tract plus itself
temp <- strsplit(monitorct$selfandfriends, split=",")
ltemp <- sapply(temp, length)
ct.nb <- data.frame(censustract = rep(NA, sum(ltemp)), selfneighbor = NA)
ct.nb[1:ltemp[1], "censustract"] <- monitorct[1, "src_GEOID10"]
ct.nb[1:ltemp[1], "selfneighbor"] <- temp[[1]]
for (i in 2:length(temp)) {
  st <- sum(ltemp[1:i-1])
  ct.nb[(st+1):(st+ltemp[i]), "censustract"] <- monitorct[i, "src_GEOID10"]
  ct.nb[(st+1):(st+ltemp[i]), "selfneighbor"] <- temp[[i]]
}

# merge the popoulation info
segindcalcbasis <- merge(segregationvars, ct.nb, by="selfneighbor")

# aggregate by census tract
aggregatevars <- segindcalcbasis[c("censustract", "DP0100001", "DP0110012", "allbutblack")]
as.numeric(aggregatevars$DP0100001, aggregatevars$DP0110012, aggregatevars$allbutblack)
aggregatedcensus <- aggregate(. ~ censustract, data = aggregatevars, sum)
aggregatedcensus$finalsegregationindex <- aggregatedcensus$DP0110012/aggregatedcensus$DP0100001
aggregatedcensus$GEOID10 <- aggregatedcensus$censustract
RI_no_nodes_all_tracts <- aggregatedcensus[c("GEOID10","finalsegregationindex")]
RI_no_nodes_all_tracts$GEOID10 <- as.factor(RI_no_nodes_all_tracts$GEOID10)
colnames(RI_no_nodes_all_tracts) <- c("tract_ID","RI_no_nodes_all")
# View(RI_no_nodes_all_tracts)

# save RI for all tracts w/o nodes
save(RI_no_nodes_all_tracts, 
     file="RI_no_nodes_all_tracts.rdata")
# load(file="RI_no_nodes_all_tracts.rdata")
# View(RI_no_nodes_all_tracts)

# remove temporary files
rm(segindcalcbasis, 
   aggregatevars, 
   aggregatedcensus, 
   ct.nb, 
   temp, 
   ltemp, 
   st, 
   i, 
   monitorct)
```


```{r racial isolation quintiles, eval=FALSE, include=FALSE}

# load necesssary files
load(file = "RI_yes_nodes_all_tracts.rdata")
load(file = "RI_yes_nodes_urban_tracts.rdata")
load(file = "fullcensus.rdata")

#### split RI into quantiles overall

## all tracts
RI_yes_nodes_all_tracts_quantile <- 
  within(RI_yes_nodes_all_tracts, 
         RI_quantile <- 
           as.integer(cut2(RI_nodes_all, 
                           quantile(RI_nodes_all, 
                                    c(0.000000000000000000,
                                      0.2,
                                      0.4,
                                      0.6,
                                      0.8,
                                      1),
                                    na.rm=TRUE)),
                      include.lowest=TRUE))

# check quantiles
table(RI_yes_nodes_all_tracts_quantile$RI_quantile)

## urban tracts only
RI_yes_nodes_urban_tracts_quantile <- 
  within(RI_yes_nodes_urban_tracts, 
         RI_quantile <- 
           as.integer(cut2(RI_nodes_urban, 
                           quantile(RI_nodes_urban, 
                                    c(0.000000000000000000,
                                      0.2,
                                      0.4,
                                      0.6,
                                      0.8,
                                      1),
                                    na.rm=TRUE)),
                      include.lowest=TRUE))

# check quantiles
table(RI_yes_nodes_urban_tracts_quantile$RI_quantile)



#### make regions to split RI by quantile

# make new dataframe to edit the full census file
editablecensus <- 
  fullcensus

# pad GEOIDs so 10-digit ones are now 11 digits
editablecensus$GEOID10pad0 <- 
  str_pad(editablecensus$GEOID10, 
          11, 
          pad = "0")

# pull digits for state
editablecensus$state2digits <- 
  substr(editablecensus$GEOID10pad0, 
         start = 1, 
         stop = 2)

# import list of states and state codes
states_and_counties <- 
  read.csv(file="states_and_counties.csv")
states_and_codes <- 
  unique(states_and_counties[c("State.Name",
                               "State.Code")])
states_and_codes$State.Code <- 
  as.character(states_and_codes$State.Code)
states_and_codes$State.Name <- 
  as.character(states_and_codes$State.Name)

# change state code for Canada to the number 81 in states_and_codes
states_and_codes$State.Code[states_and_codes$State.Code == "CC"] <- "81"
# View(states_and_codes)

# make new state code file for isolation index
states_for_isolation_index <- 
  states_and_codes

# make variable name the same
states_for_isolation_index$state2digits <- 
  states_for_isolation_index$State.Code
states_for_isolation_index$State.Code <- 
  NULL
# View(states_for_isolation_index)

# add states to editable census
editablecensuswithstates <- 
  merge(editablecensus,
        states_for_isolation_index,
        by="state2digits",
        all.x=TRUE)
# View(editablecensuswithstates[,190:198])
# View(editablecensuswithstates)

# extract state and GEOID10 from editable census
states_and_GEOIDs <- 
  editablecensuswithstates[,c("state2digits",
                              "GEOID10",
                              "State.Name",
                              "GEOID10pad0")]
# View(states_and_GEOIDs)

# read in regions
rawregion <- 
  read.csv(file="uscensusbureauregionsanddivisions.csv")
# View(rawregion)

# rename state variable
states_and_GEOIDs$State <- states_and_GEOIDs$State.Name
states_and_GEOIDs$State.Name <- NULL
# View(states_and_GEOIDs)

# merge states, GEOIDs, and regions
states_GEOIDs_and_regions <- 
  merge(states_and_GEOIDs,
        rawregion,
        by="State",
        all.x=TRUE)
# View(states_GEOIDs_and_regions)

# make tract_ID for merging
states_GEOIDs_and_regions$tract_ID <- 
  states_GEOIDs_and_regions$GEOID10

# make region into a character
states_GEOIDs_and_regions$Region <- 
  as.character(states_GEOIDs_and_regions$Region)

# fix DC to be in the south
states_GEOIDs_and_regions$Region[
  states_GEOIDs_and_regions$State=='District Of Columbia'] <-'South'

# fix Puerto Rico
states_GEOIDs_and_regions$Region[
  states_GEOIDs_and_regions$State=='Puerto Rico'] <- 'Other'

save(states_GEOIDs_and_regions,
     file = "states_GEOIDs_and_regions.rdata")

# merge states, GEOIDs, regions, and RI
racial_iso_region_nodes <- 
  merge(states_GEOIDs_and_regions,
        RI_yes_nodes_all_tracts,
        by="tract_ID",
        all.x=TRUE)
# View(is.na(racial_iso_region_nodes))

# make table of isolation NAs before fixing
racial_iso_region_nodes_NAs_for_iso <- 
  racial_iso_region_nodes[is.na(racial_iso_region_nodes$RI_nodes_all),]

save(racial_iso_region_nodes_NAs_for_iso,
     file = "racial_iso_region_nodes_NAs_for_iso.rdata")
# View(racial_iso_region_nodes_NAs_for_iso)

# split into quantiles by region
racial_iso_nodes_quantiles_by_region <- 
  racial_iso_region_nodes %>%
  group_by(Region) %>% 
  mutate(RegionQuantile = 
           as.integer(cut2(RI_nodes_all, 
                           (quantile(RI_nodes_all, 
                                     probs = 0:5/5,
                                     na.rm = TRUE)))))

# split into overall quantiles
racial_iso_nodes_quantiles_by_region$overall_quantile <- 
  as.integer(cut2(racial_iso_nodes_quantiles_by_region$RI_nodes_all, 
                  quantile(racial_iso_nodes_quantiles_by_region$RI_nodes_all, 
                           probs = 0:5/5,
                           na.rm = TRUE)))

# View(racial_iso_nodes_quantiles_by_region)




# split into urban quantiles by region

# merge states, GEOIDs, regions, and RI
RI_nodes_urban_region <- 
  merge(states_GEOIDs_and_regions,
        RI_yes_nodes_urban_tracts,
        by="tract_ID",
        all.x=TRUE)
# View(is.na(RI_nodes_urban_region))

# make table of isolation NAs before fixing
RI_nodes_urban_region_NAs_for_iso <- 
  RI_nodes_urban_region[is.na(RI_nodes_urban_region$RI_nodes_urban),]

save(RI_nodes_urban_region_NAs_for_iso,
     file = "RI_nodes_urban_region_NAs_for_iso.rdata")
# View(RI_nodes_urban_region_NAs_for_iso)

# split into quantiles by region
RI_nodes_urban_region_quantiles_by_region <- 
  RI_nodes_urban_region %>%
  group_by(Region) %>% 
  mutate(region_quantile = 
           as.integer(cut2(RI_nodes_urban, 
                           (quantile(RI_nodes_urban, 
                                     probs = 0:5/5,
                                     na.rm = TRUE)))))
table(RI_nodes_urban_region_quantiles_by_region$Region, 
      RI_nodes_urban_region_quantiles_by_region$region_quantile)

# split into overall quantiles
RI_nodes_urban_region_quantiles_by_region$overall_quantile <- 
  as.integer(cut2(RI_nodes_urban_region_quantiles_by_region$RI_nodes_urban, 
                  quantile(RI_nodes_urban_region_quantiles_by_region$RI_nodes_urban, 
                           probs = 0:5/5,
                           na.rm = TRUE)))

# save and load
save(RI_nodes_urban_region_quantiles_by_region,
     file="RI_nodes_urban_region_quantiles_by_region.rdata")
```


```{r making the dataset for at least 3 years/180 observations}

load(file = "atleast3years180obs.rdata")

# move this code later
atleast3years180obs <- 
  atleast3years180obs %>% 
  rename(arithmetic_mean = Arithmetic.Mean, 
         parameter_code = Parameter.Code)

#### THREE-YEAR DATA RUN ####

# aggregate mean on months and years for three-year data
monthlyaveragesnodrops3 <- 
  aggregate(arithmetic_mean ~ month + year + parameter_code + tract_ID, 
            atleast3years180obs, mean)

#get long-term averages
averagebycensustractnodrops3 <- 
  aggregate(arithmetic_mean ~ parameter_code + tract_ID, 
            data = monthlyaveragesnodrops3, FUN="mean")

#make it by tract
moltenaverage3 <- 
  melt(averagebycensustractnodrops3)
tractaverage3 <- 
  dcast(moltenaverage3,tract_ID ~ parameter_code)
# View(tractaverage3)

# remove OC
# tractaverage3$`88320` <- NULL
# tractaverage3$`88382` <- NULL

#count number of tracts for each parameter
# View(tractaverage3)
colSums(!is.na(tractaverage3) | tractaverage3 != "", na.rm = TRUE)
tractcountbypollutant3 <- 
  colSums(!is.na(tractaverage3) | tractaverage3 != "", na.rm = TRUE)
write.csv(tractcountbypollutant3,
          file = "tractcountbypollutant3.csv")
# View(tractcountbypollutant3)

#add rurality data
load(file="onlyruca.rdata")
tractaverageplusruca3 <- 
  merge(tractaverage3,onlyruca,by="tract_ID")

# add total population data
load(file = "fullcensus.rdata")
censustotalpopulation <- 
  fullcensus[c("GEOID10", "DP0010001")]
colnames(censustotalpopulation) <- 
  c("tract_ID","total_population_DP0010001")
tractaverageplusrucaandtotalpop3 <- 
  merge(tractaverageplusruca3,censustotalpopulation,by="tract_ID")

#drop non-urbans
tractaverageonlyurbanandtotalpop3 <- 
  tractaverageplusrucaandtotalpop3[which(tractaverageplusrucaandtotalpop3$urban=='urban'),]

#count new number of tracts for each parameter
tractcountbypollutanturban3 <- 
  colSums(!is.na(tractaverageonlyurbanandtotalpop3))
tractcountbypollutanturban3
write.csv(tractcountbypollutanturban3,file="tractcountbypollutanturban3.csv")

#drop tracts < 100
tractaverageonlyurbanover1003 <- 
  tractaverageonlyurbanandtotalpop3[which(tractaverageonlyurbanandtotalpop3$total_population_DP0010001>100),]

#count tracts again
monitorcountonlyurbanover1003 <- 
  colSums(!is.na(tractaverageonlyurbanover1003))
write.csv(monitorcountonlyurbanover1003,
          file = "monitorcountonlyurbanover1003.csv")

load(file = "RI_yes_nodes_urban_tracts.rdata")
# add racial isolation index
threeyearspluswithRInodes <- 
  merge(tractaverageonlyurbanover1003,
        RI_yes_nodes_urban_tracts,
        by = "tract_ID")
# colnames(threeyearspluswithRI) <- c("tract_ID","PM25_88101","aluminum_88104","calcium_88111","chlorine_88115","nickel_88136","titanium_88161","vanadium_88164","silicon_88165","zinc_88167","ammonium_88301","sodium_ion_88302","nitrate_88306","sulfate_88403","PM_25_non_FRM_88502","EC","ruca_prime","ruca_second","urban","total_population_DP0010001","isolationindex")
# View(threeyearspluswithRInodes)
save(threeyearspluswithRInodes,
     file = "threeyearspluswithRInodes.rdata")
# load(file="threeyearspluswithRI.rdata")

#### run everything with three years plus with RI ####

load(file = "RI_nodes_urban_region_quantiles_by_region.rdata")
# add region and overall quantiles
threeyearsplusregionRInodes <- 
  merge(threeyearspluswithRInodes,
        RI_nodes_urban_region_quantiles_by_region,
        by = "tract_ID")
# View(threeyearsplusregionRInodes)

table(threeyearsplusregionRInodes$overall_quantile)

# pull census data
censusfullracedata <- fullcensus[c("GEOID10","DP0080001","DP0080002","DP0080003","DP0080004","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")]

colnames(censusfullracedata) <- c("tract_ID","DP0080001","DP0080002","DP0080003","DP0080004","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")
# View(censusfullracedata)

# join race data to three years of data with RI quintile
threeyearspluswithRInodesquantilesandrace <- 
  merge(threeyearsplusregionRInodes,
        censusfullracedata,
        by = "tract_ID")
tractcountbypollutant <- 
  colSums(!is.na(threeyearspluswithRInodesquantilesandrace))

# load raw ACS data
load(file = "ACS_raw_data.rdata")

# load simplified raw ACS data
load(file = "ACS_simplified_raw_data.rdata")

# population variables
acs_pop_no_marg <- 
  ACS_simplified_raw_data[c <- c("GEOID","B00001e1")]

acs_earnings_no_marg <- ACS_raw_data[c("GEOID","B20001e1","B20001e2","B20001e3","B20001e4","B20001e5","B20001e6","B20001e7","B20001e8","B20001e9","B20001e10","B20001e11","B20001e12","B20001e13","B20001e14","B20001e15","B20001e16","B20001e17","B20001e18","B20001e19","B20001e20","B20001e21","B20001e22","B20001e23","B20001e24","B20001e25","B20001e26","B20001e27","B20001e28","B20001e29","B20001e30","B20001e31","B20001e32","B20001e33","B20001e34","B20001e35","B20001e36","B20001e37","B20001e38","B20001e39","B20001e40","B20001e41","B20001e42","B20001e43")]

acs_median_earnings_no_marg <- ACS_raw_data[c("GEOID","B20002e1")]

# education variables
acs_education_variables <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003m1","B15003e2","B15003m2","B15003e3","B15003m3","B15003e4","B15003m4","B15003e5","B15003m5","B15003e6","B15003m6","B15003e7","B15003m7","B15003e8","B15003m8","B15003e9","B15003m9","B15003e10","B15003m10","B15003e11","B15003m11","B15003e12","B15003m12","B15003e13","B15003m13","B15003e14","B15003m14","B15003e15","B15003m15","B15003e16","B15003m16","B15003e17","B15003m17","B15003e18","B15003m18","B15003e19","B15003m19","B15003e20","B15003m20","B15003e21","B15003m21","B15003e22","B15003m22","B15003e23","B15003m23","B15003e24","B15003m24","B15003e25","B15003m25")]

education_labels <- c("tract_ID","ed_pop","ed_pop_margin","ed_no_school","ed_no_school_margin","ed_nurse","ed_nurse_margin","ed_kinder","ed_kinder_margin","ed_1","ed_1_margin","ed_2","ed_2_margin","ed_3","ed_3_margin","ed_4","ed_4_margin","ed_5","ed_5_margin","ed_6","ed_6_margin","ed_7","ed_7_margin","ed_8","ed_8_margin","ed_9","ed_9_margin","ed_10","ed_10_margin","ed_11","ed_11_margin","ed_12","ed_12_margin","ed_hsdip","ed_hsdip_margin","ed_GED","ed_GED_margin","ed_<1_college","ed_<1_college_margin","ed_1+_college","ed_1+_college_margin","ed_associate","ed_associate_margin","ed_bachelor","ed_bachelor_margin","ed_master","ed_master_margin","ed_prof","ed_prof_marg","ed_doctor","ed_doctor_marg")

acs_education_variables_no_margins <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003e2","B15003e3","B15003e4","B15003e5","B15003e6","B15003e7","B15003e8","B15003e9","B15003e10","B15003e11","B15003e12","B15003e13","B15003e14","B15003e15","B15003e16","B15003e17","B15003e18","B15003e19","B15003e20","B15003e21","B15003e22","B15003e23","B15003e24","B15003e25")]
# View(acs_education_variables_no_margins)

education_labels_no_margins <- c("GEOID","ed_pop","ed_no_school","ed_nurse","ed_kinder","ed_1","ed_2","ed_3","ed_4","ed_5","ed_6","ed_7","ed_8","ed_9","ed_10","ed_11","ed_12","ed_hsdip","ed_GED","ed_<1_college","ed_1+_college","ed_associate","ed_bachelor","ed_master","ed_prof","ed_doctor")

colnames(acs_education_variables_no_margins) <- education_labels_no_margins

# household value
acs_median_househ_value_no_marg <- ACS_raw_data[c("GEOID","B25077e1")]

# household income
acs_median_household_income_no_marg <- ACS_raw_data[c("GEOID","B19013e1")]

# poverty
acs_poverty <- ACS_raw_data[c("GEOID","B17001e1","B17001e2")]

# unemployment
acs_unemp_no_marg <- ACS_simplified_raw_data[c("GEOID","B23025e1","B23025e2","B23025e3","B23025e4","B23025e5","B23025e6","B23025e7")]

# make tract_ID back to GEOID
threeyearspluswithRInodesquantilesandrace$GEOID <- 
  threeyearspluswithRInodesquantilesandrace$tract_ID

# figuring out why a variable is dropping -- because Richmond County Tract 228 has no population (?) in the 2012 5-year ACS estimates (GEOID 36085022800)
#airdataID <- as.data.frame(alldatawithRI$GEOID)
#colnames(airdataID) <- c("GEOID")
#acs_pop_no_margID <- as.data.frame(acs_pop_no_marg$GEOID)
#colnames(acs_pop_no_margID) <- c("GEOID")
#testingIDs <- merge(airdataID,acs_pop_no_margID,by="GEOID",all.x=TRUE)

#merge air and seg with acs
air_acs_seg_nodes_no_drops <- merge(threeyearspluswithRInodesquantilesandrace,acs_pop_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_nodes_no_drops <- merge(air_acs_seg_nodes_no_drops,acs_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_nodes_no_drops <- merge(air_acs_seg_nodes_no_drops,acs_median_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_nodes_no_drops <- merge(air_acs_seg_nodes_no_drops,acs_education_variables_no_margins,by="GEOID",all.x=TRUE)
air_acs_seg_nodes_no_drops <- merge(air_acs_seg_nodes_no_drops,acs_median_househ_value_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_nodes_no_drops <- merge(air_acs_seg_nodes_no_drops,acs_median_household_income_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_nodes_no_drops <- merge(air_acs_seg_nodes_no_drops,acs_poverty,by="GEOID",all.x=TRUE)
air_acs_seg_nodes_no_drops <- merge(air_acs_seg_nodes_no_drops,acs_unemp_no_marg,by="GEOID",all.x=TRUE)
# View(air_acs_seg_nodes_no_drops)

save(air_acs_seg_nodes_no_drops,file="air_acs_seg_nodes_no_drops.rdata")


#### add census ####
#censusdataforfinaljoin <- census_2010_DP1_raw
#censusdataforfinaljoin$GEOID <- censusdataforfinaljoin$GEOID10
#censusdataforfinaljoin$GEOID10 <- NULL


#censusdataforfinaljoin <- subset(censusdataforfinaljoin, select=-c(FID,ALAND10,AWATER10,Shape_Leng,Shape_Area))
#colnames(censusdataforfinaljoin)

# age from census
agefromcensus <- fullcensus[c("GEOID10","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")]

colnames(agefromcensus) <- c("GEOID","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")
# View(agefromcensus)

# Hispanic or Latino from census
HispanicLatinofromCensus <- fullcensus[c("GEOID10","DP0100001","DP0100002")]
# View(HispanicLatinofromCensus)
colnames(HispanicLatinofromCensus) <- c("GEOID","DP0100001","DP0100002")

# race and ethnicity from census
raceethnicityfromcensus <- fullcensus[c("GEOID10","DP0110001","DP0110002","DP0110003","DP0110004","DP0110005","DP0110006","DP0110007","DP0110008","DP0110009","DP0110010","DP0110011","DP0110012","DP0110013","DP0110014","DP0110015","DP0110016","DP0110017")]    

colnames(raceethnicityfromcensus) <- c("GEOID","DP0110001","DP0110002","DP0110003","DP0110004","DP0110005","DP0110006","DP0110007","DP0110008","DP0110009","DP0110010","DP0110011","DP0110012","DP0110013","DP0110014","DP0110015","DP0110016","DP0110017")
# View(raceethnicityfromcensus)

# merge census to prior
air_acs_census_seg_nodes_no_drops <-
  merge(air_acs_seg_nodes_no_drops,
        agefromcensus,
        by = "GEOID")
air_acs_census_seg_nodes_no_drops <- 
  merge(air_acs_census_seg_nodes_no_drops,
        HispanicLatinofromCensus,
        by = "GEOID")
air_acs_census_seg_nodes_no_drops <-
  merge(air_acs_census_seg_nodes_no_drops,
        raceethnicityfromcensus,
        by = "GEOID")

# note, just replaced old variables starting here
finaldatanodrops <- 
  air_acs_census_seg_nodes_no_drops
save(finaldatanodrops, 
     file = "finaldatanodrops.rdata")
load(file = "finaldatanodrops.rdata")
# View(finaldatanodrops)

#### making needed vars ####

# % white -- 
finaldatanodrops$percent_white <- 
  finaldatanodrops$DP0110002 / finaldatanodrops$DP0100001

# % of population with less than high school education
finaldatanodrops$percent_less_than_high_school <- finaldatanodrops$ed_no_school+finaldatanodrops$ed_nurse+finaldatanodrops$ed_kinder+finaldatanodrops$ed_1+finaldatanodrops$ed_2+finaldatanodrops$ed_3+finaldatanodrops$ed_4+finaldatanodrops$ed_5+finaldatanodrops$ed_6+finaldatanodrops$ed_7+finaldatanodrops$ed_8+finaldatanodrops$ed_9+finaldatanodrops$ed_10+finaldatanodrops$ed_11+finaldatanodrops$ed_12/finaldatanodrops$ed_pop

# % in poverty
finaldatanodrops$percent_poverty <- finaldatanodrops$B17001e2 / finaldatanodrops$B17001e1

# % black
finaldatanodrops$percent_black <- finaldatanodrops$DP0110012 / finaldatanodrops$DP0100001

# % Hispanic
finaldatanodrops$percent_Hispanic <- finaldatanodrops$DP0100002/finaldatanodrops$DP0100001
# View(finaldatanodrops)

# % unemployed
finaldatanodrops$percent_unemployed <- finaldatanodrops$B23025e5/finaldatanodrops$B23025e1

# age 0-19
finaldatanodrops$age0to19 <- finaldatanodrops$DP0010002+finaldatanodrops$DP0010003+finaldatanodrops$DP0010004+finaldatanodrops$DP0010005

# age 20-64
finaldatanodrops$age20to64 <- finaldatanodrops$DP0010006+finaldatanodrops$DP0010007+finaldatanodrops$DP0010008+finaldatanodrops$DP0010009+finaldatanodrops$DP0010010+finaldatanodrops$DP0010011+finaldatanodrops$DP0010012+finaldatanodrops$DP0010013+finaldatanodrops$DP0010014

# age 65+
finaldatanodrops$age65plus <- finaldatanodrops$DP0010015+finaldatanodrops$DP0010016+finaldatanodrops$DP0010017+finaldatanodrops$DP0010018+finaldatanodrops$DP0010019

save(finaldatanodrops,file="finaldatanodrops.rdata")
load(file="finaldatanodrops.rdata")
```


```{r salvaged plot code, eval=FALSE, include=FALSE}

pm_plot <- 
  ggplot(PM25summary, 
         aes(x=factor(overall_quantile), 
             y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
pm_plot
ggsave("pm_plot.png",plot=pm_plot,width=20,height=20,units="cm")

al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=meaWheren-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
al_plot
am_plot<-ggplot(Amsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Ammonium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
am_plot
as_plot<-ggplot(Assummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Arsenic (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
as_plot
br_plot<-ggplot(Brsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Bromine (",italic("n")," = 274)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
br_plot
ca_plot<-ggplot(Casummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Calcium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
ca_plot
cl_plot<-ggplot(Clsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Chlorine (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
cl_plot
cu_plot<-ggplot(Cusummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Copper (",italic("n")," = 275)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
cu_plot
ec_plot<-ggplot(ECsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Elemental Carbon (",italic("n")," = 201)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ec_plot
fe_plot<-ggplot(Fesummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Iron (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
fe_plot
pb_plot<-ggplot(Pbsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Lead (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
pb_plot
hg_plot<-ggplot(Hgsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Mercury (",italic("n")," = 162)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
hg_plot
ni_plot<-ggplot(Nisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nickel (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ni_plot
no_plot<-ggplot(NO3summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nitrate Ion (",italic("n")," = 267)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
no_plot
si_plot<-ggplot(Sisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Silicon (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
si_plot
na_plot<-ggplot(Nasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium (",italic("n")," = 264)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
na_plot
nai_plot<-ggplot(NaIsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
nai_plot
so_plot<-ggplot(SO4summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sulfate Ion (",italic("n")," = 277)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
so_plot
ti_plot<-ggplot(Tisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Titanium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30, hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ti_plot
v_plot<-ggplot(Vasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Vanadium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
v_plot
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none"
)
zn_plot
ti_plot<-ggplot(Tisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Titanium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=8) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=30)) +
theme(plot.title = element_text(size=30,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ti_plot
all_plots_3<-grid.arrange(rbind(ggplotGrob(al_plot), ggplotGrob(ca_plot),ggplotGrob(fe_plot), ggplotGrob(no_plot),ggplotGrob(so_plot),size="last"),rbind(ggplotGrob(am_plot),ggplotGrob(cl_plot), ggplotGrob(pb_plot), ggplotGrob(si_plot),ggplotGrob(ti_plot),size="last"),rbind(ggplotGrob(as_plot), ggplotGrob(cu_plot), ggplotGrob(hg_plot), ggplotGrob(na_plot),ggplotGrob(v_plot), size = "last"),rbind(ggplotGrob(br_plot), ggplotGrob(ec_plot), ggplotGrob(ni_plot), ggplotGrob(nai_plot),ggplotGrob(zn_plot), size = "last"),ncol=4)
ggsave("all_plots_3.png",plot=all_plots_3,width=60,height=60,units="cm")
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none"
)
zn_plot
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=7) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none"
)
zn_plot
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none"
)
zn_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
al_plot
am_plot<-ggplot(Amsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Ammonium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
am_plot
as_plot<-ggplot(Assummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Arsenic (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
as_plot
br_plot<-ggplot(Brsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Bromine (",italic("n")," = 274)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
br_plot
ca_plot<-ggplot(Casummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Calcium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
ca_plot
cl_plot<-ggplot(Clsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Chlorine (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
cl_plot
cu_plot<-ggplot(Cusummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Copper (",italic("n")," = 275)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
cu_plot
ec_plot<-ggplot(ECsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Elemental Carbon (",italic("n")," = 201)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ec_plot
fe_plot<-ggplot(Fesummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Iron (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
fe_plot
pb_plot<-ggplot(Pbsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Lead (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
pb_plot
hg_plot<-ggplot(Hgsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Mercury (",italic("n")," = 162)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
hg_plot
ni_plot<-ggplot(Nisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nickel (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ni_plot
no_plot<-ggplot(NO3summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nitrate Ion (",italic("n")," = 267)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
no_plot
si_plot<-ggplot(Sisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Silicon (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
si_plot
na_plot<-ggplot(Nasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium (",italic("n")," = 264)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
na_plot
nai_plot<-ggplot(NaIsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
nai_plot
so_plot<-ggplot(SO4summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sulfate Ion (",italic("n")," = 277)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
so_plot
ti_plot<-ggplot(Tisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Titanium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ti_plot
v_plot<-ggplot(Vasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Vanadium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
v_plot
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none"
)
zn_plot
all_plots_3<-grid.arrange(rbind(ggplotGrob(al_plot), ggplotGrob(ca_plot),ggplotGrob(fe_plot), ggplotGrob(no_plot),ggplotGrob(so_plot),size="last"),rbind(ggplotGrob(am_plot),ggplotGrob(cl_plot), ggplotGrob(pb_plot), ggplotGrob(si_plot),ggplotGrob(ti_plot),size="last"),rbind(ggplotGrob(as_plot), ggplotGrob(cu_plot), ggplotGrob(hg_plot), ggplotGrob(na_plot),ggplotGrob(v_plot), size = "last"),rbind(ggplotGrob(br_plot), ggplotGrob(ec_plot), ggplotGrob(ni_plot), ggplotGrob(nai_plot),ggplotGrob(zn_plot), size = "last"),ncol=4)
ggsave("all_plots_3.png",plot=all_plots_3,width=60,height=60,units="cm")
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,15,15),"pt"))
al_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,15,5.5),"pt"))
al_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,15,100),"pt"))
al_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,100,15),"pt"))
al_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,100,5.5,15),"pt"))
al_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,15),"pt"))
al_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,15),"pt"))
al_plot
am_plot<-ggplot(Amsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Ammonium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
am_plot
as_plot<-ggplot(Assummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Arsenic (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
as_plot
br_plot<-ggplot(Brsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Bromine (",italic("n")," = 274)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
br_plot
ca_plot<-ggplot(Casummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Calcium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,15),"pt"))
ca_plot
cl_plot<-ggplot(Clsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Chlorine (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
cl_plot
cu_plot<-ggplot(Cusummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Copper (",italic("n")," = 275)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
cu_plot
ec_plot<-ggplot(ECsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Elemental Carbon (",italic("n")," = 201)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
ec_plot
fe_plot<-ggplot(Fesummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Iron (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
fe_plot
pb_plot<-ggplot(Pbsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Lead (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,15),"pt"))
pb_plot
hg_plot<-ggplot(Hgsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Mercury (",italic("n")," = 162)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
hg_plot
ni_plot<-ggplot(Nisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nickel (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
ni_plot
no_plot<-ggplot(NO3summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nitrate Ion (",italic("n")," = 267)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,15),"pt"))
no_plot
si_plot<-ggplot(Sisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Silicon (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
si_plot
na_plot<-ggplot(Nasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium (",italic("n")," = 264)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
na_plot
nai_plot<-ggplot(NaIsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
nai_plot
so_plot<-ggplot(SO4summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sulfate Ion (",italic("n")," = 277)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,15),"pt"))
so_plot
ti_plot<-ggplot(Tisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Titanium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
ti_plot
v_plot<-ggplot(Vasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Vanadium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt"))
v_plot
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6.5) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=24)) +
theme(plot.title = element_text(size=24,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,15,5.5,5.5),"pt")
)
zn_plot
all_plots_3<-grid.arrange(rbind(ggplotGrob(al_plot), ggplotGrob(ca_plot),ggplotGrob(fe_plot), ggplotGrob(no_plot),ggplotGrob(so_plot),size="last"),rbind(ggplotGrob(am_plot),ggplotGrob(cl_plot), ggplotGrob(pb_plot), ggplotGrob(si_plot),ggplotGrob(ti_plot),size="last"),rbind(ggplotGrob(as_plot), ggplotGrob(cu_plot), ggplotGrob(hg_plot), ggplotGrob(na_plot),ggplotGrob(v_plot), size = "last"),rbind(ggplotGrob(br_plot), ggplotGrob(ec_plot), ggplotGrob(ni_plot), ggplotGrob(nai_plot),ggplotGrob(zn_plot), size = "last"),ncol=4)
ggsave("all_plots_3.png",plot=all_plots_3,width=60,height=60,units="cm")
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
)
zn_plot
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
zn_plot
al_plot<-ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Aluminum (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
al_plot
am_plot<-ggplot(Amsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle("Aluminum") +
ggtitle(expression(paste("Ammonium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
am_plot
as_plot<-ggplot(Assummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Arsenic (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
as_plot
br_plot<-ggplot(Brsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Bromine (",italic("n")," = 274)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
br_plot
ca_plot<-ggplot(Casummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Calcium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
ca_plot
cl_plot<-ggplot(Clsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Chlorine (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
cl_plot
cu_plot<-ggplot(Cusummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Copper (",italic("n")," = 275)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
cu_plot
ec_plot<-ggplot(ECsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Elemental Carbon (",italic("n")," = 201)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ec_plot
fe_plot<-ggplot(Fesummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Iron (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
fe_plot
pb_plot<-ggplot(Pbsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Lead (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
pb_plot
hg_plot<-ggplot(Hgsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Mercury (",italic("n")," = 162)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
hg_plot
ni_plot<-ggplot(Nisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nickel (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ni_plot
no_plot<-ggplot(NO3summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Nitrate Ion (",italic("n")," = 267)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
no_plot
si_plot<-ggplot(Sisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Silicon (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
si_plot
na_plot<-ggplot(Nasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium (",italic("n")," = 264)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
na_plot
nai_plot<-ggplot(NaIsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sodium Ion (",italic("n")," = 213)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
nai_plot
so_plot<-ggplot(SO4summary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Sulfate Ion (",italic("n")," = 277)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none",
plot.margin = unit(c(5.5,5.5,5.5,10),"pt"))
so_plot
ti_plot<-ggplot(Tisummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Titanium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
ti_plot
v_plot<-ggplot(Vasummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Vanadium (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
v_plot
zn_plot<-ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
scale_color_gradientn(colors = rainbow(4)) +
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
geom_point() +
ggtitle(expression(paste("Zinc (",italic("n")," = 276)"))) +
geom_text(aes(label=format(mean,digits=3)),hjust=-.1,vjust=0,show.legend=FALSE,family="Bahnschrift",size=6) +
scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
theme_bw() +
theme(text=element_text(family="Bahnschrift", size=21)) +
theme(plot.title = element_text(size=21,hjust = 0.5)) +
theme(axis.line = element_line(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
legend.position="none")
zn_plot
all_plots_3<-grid.arrange(rbind(ggplotGrob(al_plot), ggplotGrob(ca_plot),ggplotGrob(fe_plot), ggplotGrob(no_plot),ggplotGrob(so_plot),size="last"),rbind(ggplotGrob(am_plot),ggplotGrob(cl_plot), ggplotGrob(pb_plot), ggplotGrob(si_plot),ggplotGrob(ti_plot),size="last"),rbind(ggplotGrob(as_plot), ggplotGrob(cu_plot), ggplotGrob(hg_plot), ggplotGrob(na_plot),ggplotGrob(v_plot), size = "last"),rbind(ggplotGrob(br_plot), ggplotGrob(ec_plot), ggplotGrob(ni_plot), ggplotGrob(nai_plot),ggplotGrob(zn_plot), size = "last"),ncol=4)
ggsave("all_plots_3.png",plot=all_plots_3,width=60,height=60,units="cm")

```



```{r stats}

#### begin statistical analysis ####







table(finaldatanodrops$Region)

#individual anovas not logs
#### PM25 ####
plot(`88101` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88101` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

PM25_88101_levene <- leveneTest(finaldatanodrops$`88101` ~ as.factor(finaldatanodrops$overall_quantile))
PM25_88101_levene

PM25_88101_anova <- aov(finaldatanodrops$`88101` ~ as.factor(finaldatanodrops$overall_quantile))
summary(PM25_88101_anova)

PM25_88101_one <- oneway.test(finaldatanodrops$`88101` ~ finaldatanodrops$overall_quantile)
PM25_88101_one
summary(PM25_88101_one)
TukeyHSD(PM25_88101_anova)
PM25_no_NAs <- finaldatanodrops[c("88101","overall_quantile")]
PM25_no_NAs <- na.omit(PM25_no_NAs)
posthocTGH(y=PM25_no_NAs$`88101`,x=PM25_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(PM25_no_NAs$overall_quantile,PM25_no_NAs$`88101`)

PM25_88101_aov_residuals <- residuals(object = PM25_88101_anova)
summary(PM25_88101_aov_residuals)
plot(PM25_88101_aov_residuals)

# simple glm
simpleglmPM25 <- glm(finaldatanodrops$`88101`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmPM25)

plot(simpleglmPM25)

confint(simpleglmPM25)

tractcountbypollutant
sum(!is.na(finaldatanodrops$`88101`))

# make the plot!  :D


##### plotting for ISEE #####

# summarize the data
PM25summary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
               N    = sum(!is.na(`88101`)),
               mean = mean(`88101`, na.rm=TRUE),
               sd   = sd(`88101`, na.rm=TRUE),
               se   = sd / sqrt(N),
               ciM  = qt(.95/2 + .5, N-1),
               ci   = se*ciM
)

PM25summary

windowsFonts(YaleNew=windowsFont("YaleNew"))

PM25summaryplot <-
  ggplot(PM25summary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean PM"[2.5]," (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Mean Total Fine Particulate Matter Concentration from \n2005 to 2015 by Racial Isolation Quintile in the Urban United States") +
  geom_text(aes(label=format(mean,digits=3)),hjust=0, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())
PM25summaryplot
getOption("device")
```


```{r}


# glm with raw index
simpleglmPM25raw <- glm(finaldatanodrops$`88101`~finaldatanodrops$isolationindex.x+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region+finaldatanodrops$percent_black)
summary(simpleglmPM25raw)

# results linear models


component_list <- c("pm","al","am","as","br,","ca","cl","cu","ec","fe","pb","hg","ni","no","si","na","nai","so","ti","v","zn")
p_values <- c(2.02e-09,0.000499,0.0363,1.51e-05,0.00505,0.02592,0.7968,0.0113,0.00575,0.011496,0.02165,0.7431,4.39e-08,0.000274,0.000205,0.766027,0.770472,5.9e-07,0.04267,2.77e-06,0.00833)
adjusted_ps <- p.adjust(p=c(2.02e-09,0.000499,0.0363,1.51e-05,0.00505,0.02592,0.7968,0.0113,0.00575,0.011496,0.02165,0.7431,4.39e-08,0.000274,0.000205,0.766027,0.770472,5.9e-07,0.04267,2.77e-06,0.00833), method="holm")

p_and_p_adjust <- cbind(p_values,adjusted_ps)
p_and_p_adjust <- cbind(component_list,p_and_p_adjust)



# View(p_and_p_adjust)
adjusted_ps



# p.adjust(p=c(2.02e-09x,0.000499,0.0363,1.51e-05,0.00505,0.02592,0.7968,0.0113,0.00575,0.011496,0.02165,0.7431,4.39e-08,0.000274,4.03e-11,0.766027,0.770472,5.9e-07,0.04267,2.77e-06,0.00833), method="holm")

# al -5.180e-03, p 0.000499
# 



#### aluminum ####
table(!is.na(finaldatanodrops))

sum(!is.na(finaldatanodrops$`88104`))

plot(`88104` ~ isolationindex.x, data=finaldatanodrops)
plot(`88104` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88104` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

aluminum_88104_levene <- leveneTest(finaldatanodrops$`88104` ~ as.factor(finaldatanodrops$overall_quantile))
aluminum_88104_levene

aluminum_88104_anova <- aov(finaldatanodrops$`88104` ~ as.factor(finaldatanodrops$overall_quantile))
summary(aluminum_88104_anova)
aluminum_88104_anova

aluminum_88104_one <- oneway.test(finaldatanodrops$`88104` ~ finaldatanodrops$overall_quantile, posthoc = 'games-howell')
aluminum_correct_post <- oneway(finaldatanodrops$overall_quantile, y = finaldatanodrops$`88104`, posthoc = 'games-howell')
TukeyHSD(aluminum_88104_anova)

aluminum_88104_aov_residuals <- residuals(object = aluminum_88104_anova)
summary(aluminum_88104_aov_residuals)
plot(aluminum_88104_aov_residuals)

# glm
simpleglmaluminum_88104 <- glm(finaldatanodrops$`88104`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmaluminum_88104)

simpleglmaluminumnoregion_88104 <- glm(finaldatanodrops$`88104`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$percent_black)
summary(simpleglmaluminumnoregion_88104)
summary(simpleglmaluminum_88104)

plot(simpleglmaluminum_88104)

# make the plot!  :D

# summarize the data
Alsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                     N    = sum(!is.na(`88104`)),
                     mean = mean(`88104`, na.rm=TRUE),
                     sd   = sd(`88104`, na.rm=TRUE),
                     se   = sd / sqrt(N),
                     ciM  = qt(.95/2 + .5, N-1),
                     ci   = se*ciM
)

Alsummary

windowsFonts(YaleNew=windowsFont("YaleNew"))

ggplot(Alsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Aluminum") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-0.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())





#### calcium ####
sum(!is.na(finaldatanodrops$`88111`))
plot(`88111` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88111` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

calcium_88111_levene <- leveneTest(finaldatanodrops$`88111` ~ as.factor(finaldatanodrops$overall_quantile))
calcium_88111_levene

calcium_88111_anova <- aov(finaldatanodrops$`88111` ~ as.factor(finaldatanodrops$overall_quantile)) 
summary(calcium_88111_anova)

calcium_88111_one <- oneway.test(finaldatanodrops$`88111` ~ finaldatanodrops$overall_quantile)
TukeyHSD(calcium_88111_anova)

calcium_88111_aov_residuals <- residuals(object = calcium_88111_anova)
summary(calcium_88111_aov_residuals)
plot(calcium_88111_aov_residuals)

# glm
simpleglmcalcium_88111 <- glm(finaldatanodrops$`88111`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region+finaldatanodrops$percent_black)
summary(simpleglmcalcium_88111)

plot(simpleglmcalcium_88111)


# make the plot!  :D

# summarize the data
Casummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88111`)),
                   mean = mean(`88111`, na.rm=TRUE),
                   sd   = sd(`88111`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Casummary

ggplot(Casummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Calcium") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-0.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())




#### chlorine ####
sum(!is.na(finaldatanodrops$`88115`))
plot(`88115` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88115` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

chlorine_88115_levene <- leveneTest(finaldatanodrops$`88115` ~ as.factor(finaldatanodrops$overall_quantile))
chlorine_88115_levene

chlorine_88115_anova <- aov(finaldatanodrops$`88115` ~ as.factor(finaldatanodrops$overall_quantile))
summary(chlorine_88115_anova)
TukeyHSD(chlorine_88115_anova)

chlorine_88115_one <- oneway.test(finaldatanodrops$`88115` ~ finaldatanodrops$overall_quantile)
TukeyHSD(chlorine_88115_anova)

chlorine_88115_aov_residuals <- residuals(object = chlorine_88115_anova)
summary(chlorine_88115_aov_residuals)
plot(chlorine_88115_aov_residuals)

# glm
simpleglmchlorine_88115 <- glm(finaldatanodrops$`88115`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmchlorine_88115)

plot(simpleglmchlorine_88115)


# summarize the data
Clsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88115`)),
                   mean = mean(`88115`, na.rm=TRUE),
                   sd   = sd(`88115`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Clsummary

windowsFonts(YaleNew=windowsFont("YaleNew"))

ggplot(Clsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Chlorine") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())





#### nickel ####
sum(!is.na(finaldatanodrops$`88136`))
plot(`88136` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88136` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

nickel_88136_levene <- leveneTest(finaldatanodrops$`88136` ~ as.factor(finaldatanodrops$overall_quantile))
nickel_88136_levene

nickel_88136_anova <- aov(finaldatanodrops$`88136` ~ as.factor(finaldatanodrops$overall_quantile))
summary(nickel_88136_anova)

nickel_88136_one <- oneway.test(finaldatanodrops$`88136` ~ finaldatanodrops$overall_quantile)
nickel_88136_one
TukeyHSD(nickel_88136_anova)

# correct post-hoc
nickel_88136_no_NAs <- finaldatanodrops[c("88136","overall_quantile")]
nickel_88136_no_NAs <- na.omit(nickel_88136_no_NAs)
posthocTGH(y=nickel_88136_no_NAs$`88136`,x=nickel_88136_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(nickel_88136_no_NAs$overall_quantile,nickel_88136_no_NAs$`88136`)




nickel_88136_aov_residuals <- residuals(object = nickel_88136_anova)
summary(nickel_88136_aov_residuals)
plot(nickel_88136_aov_residuals)

# glm
simpleglmnickel_88136 <- glm(finaldatanodrops$`88136`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmnickel_88136)

plot(simpleglmnickel_88136)


# make the plot!  :D

# summarize the data
Nisummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88136`)),
                   mean = mean(`88136`, na.rm=TRUE),
                   sd   = sd(`88136`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Nisummary

windowsFonts(YaleNew=windowsFont("YaleNew"))

ggplot(Nisummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Nickel") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())




#### titanium ####
sum(!is.na(finaldatanodrops$`88161`))
plot(`88161` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88161` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

titanium_88161_levene <- leveneTest(finaldatanodrops$`88161` ~ as.factor(finaldatanodrops$overall_quantile))
titanium_88161_levene

titanium_88161_anova <- aov(finaldatanodrops$`88161` ~ as.factor(finaldatanodrops$overall_quantile))
summary(titanium_88161_anova)

titanium_88161_one <- oneway.test(finaldatanodrops$`88161` ~ finaldatanodrops$overall_quantile)
titanium_88161_one
TukeyHSD(titanium_88161_anova)

titanium_88161_aov_residuals <- residuals(object = titanium_88161_anova)
summary(titanium_88161_aov_residuals)
plot(titanium_88161_aov_residuals)

# glm
simpleglmtitanium_88161 <- glm(finaldatanodrops$`88161`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmtitanium_88161)

plot(simpleglmtitanium_88161)


# summarize the data
Tisummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88161`)),
                   mean = mean(`88161`, na.rm=TRUE),
                   sd   = sd(`88161`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Tisummary

windowsFonts(YaleNew=windowsFont("YaleNew"))

ggplot(Tisummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Titanium") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())


#### vanadium ####
sum(!is.na(finaldatanodrops$`88164`))
plot(`88164` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88164` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

vanadium_88164_levene <- leveneTest(finaldatanodrops$`88161` ~ as.factor(finaldatanodrops$overall_quantile))
vanadium_88164_levene

vanadium_88164_anova <- aov(finaldatanodrops$`88164` ~ as.factor(finaldatanodrops$overall_quantile))
summary(vanadium_88164_anova)

vanadium_88164_one <- oneway.test(finaldatanodrops$`88164` ~ finaldatanodrops$overall_quantile)
vanadium_88164_one
TukeyHSD(vanadium_88164_anova)

# correct post-hoc
vanadium_88164_no_NAs <- finaldatanodrops[c("88164","overall_quantile")]
vanadium_88164_no_NAs <- na.omit(vanadium_88164_no_NAs)
posthocTGH(y=vanadium_88164_no_NAs$`88164`,x=vanadium_88164_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(vanadium_88164_no_NAs$overall_quantile,vanadium_88164_no_NAs$`88164`)

vanadium_88164_aov_residuals <- residuals(object = vanadium_88164_anova)
summary(vanadium_88164_aov_residuals)
plot(vanadium_88164_aov_residuals)

# glm
simpleglmvanadium_88164 <- glm(finaldatanodrops$`88164`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmvanadium_88164)

plot(simpleglmvanadium_88164)


# make the plot!  :D

# summarize the data
Vasummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88164`)),
                   mean = mean(`88164`, na.rm=TRUE),
                   sd   = sd(`88164`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Vasummary

ggplot(Vasummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Vanadium") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())




#### silicon ####

sum(!is.na(finaldatanodrops$`88165`))
plot(`88165` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88165` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

silicon_88165_levene <- leveneTest(finaldatanodrops$`88165` ~ as.factor(finaldatanodrops$overall_quantile))
silicon_88165_levene

silicon_88165_anova <- aov(finaldatanodrops$`88165` ~ as.factor(finaldatanodrops$overall_quantile))
summary(silicon_88165_anova)

silicon_88165_one <- oneway.test(finaldatanodrops$`88165` ~ finaldatanodrops$overall_quantile)
silicon_88165_one
TukeyHSD(silicon_88165_anova)

silicon_88165_aov_residuals <- residuals(object = silicon_88165_anova)
summary(silicon_88165_aov_residuals)
plot(silicon_88165_aov_residuals)

# glm
simpleglmsilicon_88165 <- glm(finaldatanodrops$`88165`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmsilicon_88165)

plot(simpleglmsilicon_88165)


# make the plot!  :D

# summarize the data
Sisummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88165`)),
                   mean = mean(`88165`, na.rm=TRUE),
                   sd   = sd(`88165`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Sisummary

ggplot(Sisummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Silicon") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())




#### zinc ####

sum(!is.na(finaldatanodrops$`88167`))
plot(`88167` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88167` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

zinc_88167_levene <- leveneTest(finaldatanodrops$`88167` ~ as.factor(finaldatanodrops$overall_quantile))
zinc_88167_levene

zinc_88167_anova <- aov(finaldatanodrops$`88167` ~ as.factor(finaldatanodrops$overall_quantile))
summary(zinc_88167_anova)

zinc_88167_one <- oneway.test(finaldatanodrops$`88167` ~ finaldatanodrops$overall_quantile)
zinc_88167_one
TukeyHSD(zinc_88167_anova)

zinc_88167_aov_residuals <- residuals(object = zinc_88167_anova)
summary(zinc_88167_aov_residuals)
plot(zinc_88167_aov_residuals)

# glm
simpleglmzinc_88167 <- glm(finaldatanodrops$`88167`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmzinc_88167)

plot(simpleglmzinc_88167)


# make the plot!  :D

# summarize the data
Znsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88167`)),
                   mean = mean(`88167`, na.rm=TRUE),
                   sd   = sd(`88167`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Znsummary

ggplot(Znsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Zinc") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())


#### ammonium ####
sum(!is.na(finaldatanodrops$`88301`))
plot(`88301` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88301` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

ammonium_88301_levene <- leveneTest(finaldatanodrops$`88301` ~ as.factor(finaldatanodrops$overall_quantile))
ammonium_88301_levene

ammonium_88301_anova <- aov(finaldatanodrops$`88301` ~ as.factor(finaldatanodrops$overall_quantile))
summary(ammonium_88301_anova)

ammonium_88301_one <- oneway.test(finaldatanodrops$`88301` ~ finaldatanodrops$overall_quantile)
ammonium_88301_one
TukeyHSD(ammonium_88301_anova)

# ammonium correct post-hoc
ammonium_88301_no_NAs <- finaldatanodrops[c("88301","overall_quantile")]
ammonium_88301_no_NAs <- na.omit(ammonium_88301_no_NAs)
posthocTGH(y=ammonium_88301_no_NAs$`88301`,x=ammonium_88301_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(ammonium_88301_no_NAs$overall_quantile,ammonium_88301_no_NAs$`88301`)

ammonium_88301_aov_residuals <- residuals(object = ammonium_88301_anova)
summary(ammonium_88301_aov_residuals)
plot(ammonium_88301_aov_residuals)

# glm
simpleglmammonium_88301 <- glm(finaldatanodrops$`88301`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmammonium_88301)

plot(simpleglmammonium_88301)


# make the plot!  :D

# summarize the data
Amsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88301`)),
                   mean = mean(`88301`, na.rm=TRUE),
                   sd   = sd(`88301`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Amsummary

ggplot(Amsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Ammonium Ion") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())


#### sodium ion ####

sum(!is.na(finaldatanodrops$`88302`))
plot(`88302` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88302` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

sodium_ion_88302_levene <- leveneTest(finaldatanodrops$`88302` ~ as.factor(finaldatanodrops$overall_quantile))
sodium_ion_88302_levene

sodium_ion_88302_anova <- aov(finaldatanodrops$`88302` ~ as.factor(finaldatanodrops$overall_quantile))
summary(sodium_ion_88302_anova)

sodium_ion_88302_one <- oneway.test(finaldatanodrops$`88302` ~ finaldatanodrops$overall_quantile)
sodium_ion_88302_one
TukeyHSD(sodium_ion_88302_anova)

sodium_ion_88302_aov_residuals <- residuals(object = sodium_ion_88302_anova)
summary(sodium_ion_88302_aov_residuals)
plot(sodium_ion_88302_aov_residuals)

# glm
simpleglmsodium_ion_88302 <- glm(finaldatanodrops$`88302`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmsodium_ion_88302)

plot(simpleglmsodium_ion_88302)

# make the plot!  :D

# summarize the data
NaIsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88302`)),
                   mean = mean(`88302`, na.rm=TRUE),
                   sd   = sd(`88302`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

NaIsummary

ggplot(NaIsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Sodium Ion") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())


#### nitrate ####

sum(!is.na(finaldatanodrops$`88306`))
plot(`88306` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88306` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

nitrate_88306_levene <- leveneTest(finaldatanodrops$`88306` ~ as.factor(finaldatanodrops$overall_quantile))
nitrate_88306_levene

nitrate_88306_anova <- aov(finaldatanodrops$`88306` ~ as.factor(finaldatanodrops$overall_quantile))
summary(nitrate_88306_anova)

nitrate_88306_one <- oneway.test(finaldatanodrops$`88306` ~ finaldatanodrops$overall_quantile)
nitrate_88306_one
TukeyHSD(nitrate_88306_anova)

nitrate_88306_aov_residuals <- residuals(object = nitrate_88306_anova)
summary(nitrate_88306_aov_residuals)
plot(nitrate_88306_aov_residuals)

# glm
simpleglmnitrate_88306 <- glm(finaldatanodrops$`88306`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmnitrate_88306)

plot(simpleglmnitrate_88306)


# make the plot!  :D

# summarize the data
NO3summary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                    N    = sum(!is.na(`88306`)),
                    mean = mean(`88306`, na.rm=TRUE),
                    sd   = sd(`88306`, na.rm=TRUE),
                    se   = sd / sqrt(N),
                    ciM  = qt(.95/2 + .5, N-1),
                    ci   = se*ciM
)

NO3summary

ggplot(NO3summary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Nitrate Ion") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())


#### sulfate ####

sum(!is.na(finaldatanodrops$`88403`))
plot(`88403` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88403` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

sulfate_88403_levene <- leveneTest(finaldatanodrops$`88403` ~ as.factor(finaldatanodrops$overall_quantile))
sulfate_88403_levene

sulfate_88403_anova <- aov(finaldatanodrops$`88403` ~ as.factor(finaldatanodrops$overall_quantile))
summary(sulfate_88403_anova)

sulfate_88403_one <- oneway.test(finaldatanodrops$`88403` ~ finaldatanodrops$overall_quantile)
sulfate_88403_one
TukeyHSD(sulfate_88403_anova)

# sulfate correct post-hoc
sulfate_88403_no_NAs <- finaldatanodrops[c("88403","overall_quantile")]
sulfate_88403_no_NAs <- na.omit(sulfate_88403_no_NAs)
posthocTGH(y=sulfate_88403_no_NAs$`88403`,x=sulfate_88403_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(sulfate_88403_no_NAs$overall_quantile,sulfate_88403_no_NAs$`88403`)


sulfate_88403_aov_residuals <- residuals(object = sulfate_88403_anova)
summary(sulfate_88403_aov_residuals)
plot(sulfate_88403_aov_residuals)

# glm
simpleglmsulfate_88403 <- glm(finaldatanodrops$`88403`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmsulfate_88403)

plot(simpleglmsulfate_88403)


# make the plot!  :D

# summarize the data
SO4summary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                    N    = sum(!is.na(`88403`)),
                    mean = mean(`88403`, na.rm=TRUE),
                    sd   = sd(`88403`, na.rm=TRUE),
                    se   = sd / sqrt(N),
                    ciM  = qt(.95/2 + .5, N-1),
                    ci   = se*ciM
)

SO4summary

ggplot(SO4summary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Sulfate Ion") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())



#### EC ####

sum(!is.na(finaldatanodrops$`99321`))
plot(`99321` ~ overall_quantile, data=finaldatanodrops)

boxplot(`99321` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

EC_levene <- leveneTest(finaldatanodrops$`99321` ~ as.factor(finaldatanodrops$overall_quantile))
EC_levene

EC_anova <- aov(finaldatanodrops$`99321` ~ as.factor(finaldatanodrops$overall_quantile))
summary(EC_anova)

EC_one <- oneway.test(finaldatanodrops$`99321` ~ finaldatanodrops$overall_quantile)
EC_one
TukeyHSD(EC_anova)

EC_aov_residuals <- residuals(object = EC_anova)
summary(EC_aov_residuals)
plot(EC_aov_residuals)

# glm
simpleglmEC <- glm(finaldatanodrops$`99321`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmEC)

plot(simpleglmEC)



# make the plot!  :D

# summarize the data
ECsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                    N    = sum(!is.na(`99321`)),
                    mean = mean(`99321`, na.rm=TRUE),
                    sd   = sd(`99321`, na.rm=TRUE),
                    se   = sd / sqrt(N),
                    ciM  = qt(.95/2 + .5, N-1),
                    ci   = se*ciM
)

ECsummary

ggplot(ECsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Elemental Carbon") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())


#### arsenic 88103 ####

sum(!is.na(finaldatanodrops$`88103`))
plot(`88103` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88103` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

arsenic_levene <- leveneTest(finaldatanodrops$`88103` ~ as.factor(finaldatanodrops$overall_quantile))
arsenic_levene

arsenic_anova <- aov(finaldatanodrops$`88103` ~ as.factor(finaldatanodrops$overall_quantile))
summary(arsenic_anova)

arsenic_one <- oneway.test(finaldatanodrops$`88103` ~ finaldatanodrops$overall_quantile)
arsenic_one
TukeyHSD(arsenic_anova)

# arsenic correct post-hoc
arsenic_88103_no_NAs <- finaldatanodrops[c("88103","overall_quantile")]
arsenic_88103_no_NAs <- na.omit(arsenic_88103_no_NAs)
posthocTGH(y=arsenic_88103_no_NAs$`88103`,x=arsenic_88103_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(arsenic_88103_no_NAs$overall_quantile,arsenic_88103_no_NAs$`88103`)


arsenic_aov_residuals <- residuals(object = arsenic_anova)
summary(arsenic_aov_residuals)
plot(arsenic_aov_residuals)

# glm
simpleglmarsenic <- glm(finaldatanodrops$`88103`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmarsenic)

plot(simpleglmarsenic)

# 
# xlab("Racial Isolation Quintile") +
#   ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) 

# make the plot!  :D


windowsFonts(Bahnschrift=windowsFont("Bahnschrift"))

# summarize the data
Assummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88103`)),
                   mean = mean(`88103`, na.rm=TRUE),
                   sd   = sd(`88103`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

##### Assummary #####

# myplot1 <- ggplot(nmmaps, aes(date, temp))+geom_point(color="firebrick")
# myplot2 <- ggplot(nmmaps, aes(temp, o3))+geom_point(color="olivedrab")
# 
# library(grid)
# pushViewport(viewport(layout = grid.layout(1, 2)))
# print(myplot1, vp = viewport(layout.pos.row = 1, layout.pos.col = 1))
# print(myplot2, vp = viewport(layout.pos.row = 1, layout.pos.col = 2))
# 
# # alternative, a little easier
# library(gridExtra)
# grid.arrange(myplot1, myplot2, ncol=2)

# xlab("Racial Isolation Quintile") +
#   ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) 


as_plot <- ggplot(Assummary, aes(x=factor(overall_quantile), y=mean,color=overall_quantile)) +
  scale_color_gradientn(colors = rainbow(4)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1, size=.7) +
  geom_point() +
  ggtitle("Arsenic") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="Bahnschrift") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="Bahnschrift", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position="none")
as_plot


#### bromine 88109 ####

sum(!is.na(finaldatanodrops$`88109`))
plot(`88109` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88109` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

bromine_88109_levene <- leveneTest(finaldatanodrops$`88109` ~ as.factor(finaldatanodrops$overall_quantile))
bromine_88109_levene

bromine_88109_anova <- aov(finaldatanodrops$`88109` ~ as.factor(finaldatanodrops$overall_quantile))
summary(bromine_88109_anova)

bromine_88109_one <- oneway.test(finaldatanodrops$`88109` ~ finaldatanodrops$overall_quantile)
bromine_88109_one
TukeyHSD(bromine_88109_anova)

# bromine correct post-hoc
bromine_88109_no_NAs <- finaldatanodrops[c("88109","overall_quantile")]
bromine_88109_no_NAs <- na.omit(bromine_88109_no_NAs)
posthocTGH(y=bromine_88109_no_NAs$`88109`,x=bromine_88109_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(bromine_88109_no_NAs$overall_quantile,bromine_88109_no_NAs$`88109`)



bromine_88109_aov_residuals <- residuals(object = bromine_88109_anova)
summary(bromine_88109_aov_residuals)
plot(bromine_88109_aov_residuals)

# glm
simpleglmbromine_88109 <- glm(finaldatanodrops$`88109`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmbromine_88109)

plot(simpleglmbromine_88109)


# make the plot!  :D

# summarize the data
Brsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88109`)),
                   mean = mean(`88109`, na.rm=TRUE),
                   sd   = sd(`88109`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Brsummary

ggplot(Brsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Bromine") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())



#### copper 88114 ####
sum(!is.na(finaldatanodrops$`88114`))
plot(`88114` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88114` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

copper_88114_levene <- leveneTest(finaldatanodrops$`88114` ~ as.factor(finaldatanodrops$overall_quantile))
copper_88114_levene

copper_88114_anova <- aov(finaldatanodrops$`88114` ~ as.factor(finaldatanodrops$overall_quantile))
summary(copper_88114_anova)

copper_88114_one <- oneway.test(finaldatanodrops$`88114` ~ finaldatanodrops$overall_quantile)
copper_88114_one
TukeyHSD(copper_88114_anova)

# copper correct post-hoc
copper_88114_no_NAs <- finaldatanodrops[c("88114","overall_quantile")]
copper_88114_no_NAs <- na.omit(copper_88114_no_NAs)
posthocTGH(y=copper_88114_no_NAs$`88114`,x=copper_88114_no_NAs$overall_quantile,method = 'games-howell',formatPvalue = FALSE)
games.howell(copper_88114_no_NAs$overall_quantile,copper_88114_no_NAs$`88114`)

copper_88114_aov_residuals <- residuals(object = copper_88114_anova)
summary(copper_88114_aov_residuals)
plot(copper_88114_aov_residuals)

# glm
simpleglmcopper_88114 <- glm(finaldatanodrops$`88114`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmcopper_88114)

plot(simpleglmcopper_88114)


# make the plot!  :D

# summarize the data
Cusummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88114`)),
                   mean = mean(`88114`, na.rm=TRUE),
                   sd   = sd(`88114`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Cusummary

ggplot(Cusummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Copper") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())



#### iron 88126 ####

sum(!is.na(finaldatanodrops$`88126`))
plot(`88126` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88126` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

iron_88126_levene <- leveneTest(finaldatanodrops$`88126` ~ as.factor(finaldatanodrops$overall_quantile))
iron_88126_levene

iron_88126_anova <- aov(finaldatanodrops$`88126` ~ as.factor(finaldatanodrops$overall_quantile))
summary(iron_88126_anova)

iron_88126_one <- oneway.test(finaldatanodrops$`88126` ~ finaldatanodrops$overall_quantile)
iron_88126_one
TukeyHSD(iron_88126_anova)

iron_88126_aov_residuals <- residuals(object = iron_88126_anova)
summary(iron_88126_aov_residuals)
plot(iron_88126_aov_residuals)

# glm
simpleglmiron_88126 <- glm(finaldatanodrops$`88126`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmiron_88126)

plot(simpleglmiron_88126)


# make the plot!  :D

# summarize the data
Fesummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88126`)),
                   mean = mean(`88126`, na.rm=TRUE),
                   sd   = sd(`88126`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Fesummary

ggplot(Fesummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Iron") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())



#### lead 88128 ####
sum(!is.na(finaldatanodrops$`88128`))
plot(`88128` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88128` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

lead_88128_levene <- leveneTest(finaldatanodrops$`88128` ~ as.factor(finaldatanodrops$overall_quantile))
lead_88128_levene

lead_88128_anova <- aov(finaldatanodrops$`88128` ~ as.factor(finaldatanodrops$overall_quantile))
summary(lead_88128_anova)

lead_88128_one <- oneway.test(finaldatanodrops$`88128` ~ finaldatanodrops$overall_quantile)
lead_88128_one
TukeyHSD(lead_88128_anova)

lead_88128_aov_residuals <- residuals(object = lead_88128_anova)
summary(lead_88128_aov_residuals)
plot(lead_88128_aov_residuals)

# glm
simpleglmlead_88128 <- glm(finaldatanodrops$`88128`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmlead_88128)

plot(simpleglmlead_88128)


# make the plot!  :D

# summarize the data
Pbsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88128`)),
                   mean = mean(`88128`, na.rm=TRUE),
                   sd   = sd(`88128`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Pbsummary

ggplot(Pbsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Lead") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())



#### mercury 88142 ####
sum(!is.na(finaldatanodrops$`88142`))
plot(`88142` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88142` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

mercury_88142_levene <- leveneTest(finaldatanodrops$`88142` ~ as.factor(finaldatanodrops$overall_quantile))
mercury_88142_levene

mercury_88142_anova <- aov(finaldatanodrops$`88142` ~ as.factor(finaldatanodrops$overall_quantile))
summary(mercury_88142_anova)

mercury_88142_one <- oneway.test(finaldatanodrops$`88142` ~ finaldatanodrops$overall_quantile)
mercury_88142_one
TukeyHSD(mercury_88142_anova)

mercury_88142_aov_residuals <- residuals(object = mercury_88142_anova)
summary(mercury_88142_aov_residuals)
plot(mercury_88142_aov_residuals)

# glm
simpleglmmercury_88142 <- glm(finaldatanodrops$`88142`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmmercury_88142)

plot(simpleglmmercury_88142)

tractcountbypollutant


# make the plot!  :D

# summarize the data
Hgsummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88142`)),
                   mean = mean(`88142`, na.rm=TRUE),
                   sd   = sd(`88142`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Hgsummary

ggplot(Hgsummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Mercury") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())


#### sodium 88184 ####

sum(!is.na(finaldatanodrops$`88184`))
plot(`88184` ~ overall_quantile, data=finaldatanodrops)

boxplot(`88184` ~ overall_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

sodium_88184_levene <- leveneTest(finaldatanodrops$`88184` ~ as.factor(finaldatanodrops$overall_quantile))
sodium_88184_levene

sodium_88184_anova <- aov(finaldatanodrops$`88184` ~ as.factor(finaldatanodrops$overall_quantile))
summary(sodium_88184_anova)

sodium_88184_one <- oneway.test(finaldatanodrops$`88184` ~ finaldatanodrops$overall_quantile)
sodium_88184_one
TukeyHSD(sodium_88184_anova)

sodium_88184_aov_residuals <- residuals(object = sodium_88184_anova)
summary(sodium_88184_aov_residuals)
plot(sodium_88184_aov_residuals)

# glm
simpleglmsodium_88184 <- glm(finaldatanodrops$`88184`~finaldatanodrops$overall_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic+finaldatanodrops$Region)
summary(simpleglmsodium_88184)

plot(simpleglmsodium_88184)


# make the plot!  :D

# summarize the data
Nasummary <- ddply(finaldatanodrops, c("overall_quantile"), summarise,
                   N    = sum(!is.na(`88184`)),
                   mean = mean(`88184`, na.rm=TRUE),
                   sd   = sd(`88184`, na.rm=TRUE),
                   se   = sd / sqrt(N),
                   ciM  = qt(.95/2 + .5, N-1),
                   ci   = se*ciM
)

Nasummary

ggplot(Nasummary, aes(x=factor(overall_quantile), y=mean)) + 
  geom_line(aes(group=1)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.1) +
  geom_point() +
  xlab("Racial Isolation Quintile") +
  ylab(expression(paste("Mean (",mu,"g/",m^3,")", sep=""))) +
  ggtitle("Sodium") +
  geom_text(aes(label=format(mean,digits=3)),hjust=-.1, vjust=-1.25,show.legend=FALSE,family="YaleNew") +
  scale_x_discrete(breaks = 1:5, labels=c("1st","2nd","3rd","4th","5th")) +
  theme_bw() +
  theme(text=element_text(family="YaleNew", size=18)) +
  theme(plot.title = element_text(size=18,hjust = 0.5)) +
  theme(axis.line = element_line(colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())

```


```{r}

#### ended here 2018-04-04 ####

# making plots

















# #make normal quantile plots
# #check for linearity
# par(mfrow=c(2,2))
# qqnorm(finaldatanodrops$isolationindex,main="RI Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$isolationindex,lwd=2,col="red")
# qqnorm(finaldatanodrops$PM25_88101,main="PM2.5 Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$PM25_88101,lwd=2,col="red")
# qqnorm(finaldatanodrops$aluminum_88104,main="Aluminum Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$aluminum_88104,lwd=2,col="red")
# qqnorm(finaldatanodrops$calcium_88111,main="Calcium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$calcium_88111,lwd=2,col="red")
# qqnorm(finaldatanodrops$chlorine_88115,main="Chlorine Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$chlorine_88115,lwd=2,col="red")
# qqnorm(finaldatanodrops$nickel_88136,main="Nickel Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$nickel_88136,lwd=2,col="red")
# qqnorm(finaldatanodrops$titanium_88161,main="Titanium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$titanium_88161,lwd=2,col="red")
# qqnorm(finaldatanodrops$vanadium_88164,main="Vanadium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$vanadium_88164,lwd=2,col="red")
# qqnorm(finaldatanodrops$silicon_88165,main="Silicon Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$silicon_88165,lwd=2,col="red")
# qqnorm(finaldatanodrops$zinc_88167,main="Zinc Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$zinc_88167,lwd=2,col="red")
# qqnorm(finaldatanodrops$ammonium_88301,main="Ammonium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$ammonium_88301,lwd=2,col="red")
# qqnorm(finaldatanodrops$nitrate_88306,main="Nitrate Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$nitrate_88306,lwd=2,col="red")
# qqnorm(finaldatanodrops$sulfate_88403,main="Sulfate Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$sulfate_88403,lwd=2,col="red")
# qqnorm(finaldatanodrops$EC,main="Elemental Carbon Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$EC,lwd=2,col="red")
# 
# #copy chlorine and nickel values for logging
# finaldatanodrops$chlorine_no_zero_88115 <- finaldatanodrops$chlorine_88115
# finaldatanodrops$nickel_no_zero_88136 <- finaldatanodrops$nickel_88136
# 
# #fix zeroes to below detection limits
# finaldatanodrops$chlorine_no_zero_88115[finaldatanodrops$chlorine_no_zero_88115==0] <- 0.0000001
# finaldatanodrops$nickel_no_zero_88136[finaldatanodrops$nickel_no_zero_88136==0] <- 0.000000001
# 
# 
# #take logs of concentrations
# finaldatanodrops$log_PM25_88101 <- log(finaldatanodrops$PM25_88101)
# finaldatanodrops$log_aluminum_88104 <- log(finaldatanodrops$aluminum_88104)
# finaldatanodrops$log_calcium_88111 <- log(finaldatanodrops$calcium_88111)
# finaldatanodrops$log_chlorine_no_zero_88115 <- log(finaldatanodrops$chlorine_no_zero_88115)
# finaldatanodrops$log_nickel_no_zero_88136 <- log(finaldatanodrops$nickel_no_zero_88136)
# finaldatanodrops$log_titanium_88161 <- log(finaldatanodrops$titanium_88161)
# finaldatanodrops$log_vanadium_88164 <- log(finaldatanodrops$vanadium_88164)
# finaldatanodrops$log_silicon_88165 <- log(finaldatanodrops$silicon_88165)
# finaldatanodrops$log_zinc_88167 <- log(finaldatanodrops$zinc_88167)
# finaldatanodrops$log_ammonium_88301 <- log(finaldatanodrops$ammonium_88301)
# finaldatanodrops$log_sodium_ion_88302 <- log(finaldatanodrops$sodium_ion_88302)
# finaldatanodrops$log_nitrate_88306 <- log(finaldatanodrops$nitrate_88306)
# finaldatanodrops$log_sulfate_88403 <- log(finaldatanodrops$sulfate_88403)
# finaldatanodrops$log_EC <- log(finaldatanodrops$EC)
# # View(finaldatanodrops)
# 
# #make normal quantile plots for the logs
# #check for linearity
# dev.off()
# par(mfrow=c(2,2))
# qqnorm(finaldatanodrops$log_PM25_88101,main="Log PM2.5 Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_PM25_88101,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_aluminum_88104,main="Log Aluminum Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_aluminum_88104,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_calcium_88111,main="Log Calcium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_calcium_88111,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_chlorine_no_zero_88115,main="Log Chlorine Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_chlorine_no_zero_88115,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_nickel_no_zero_88136,main="Log Nickel Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_nickel_no_zero_88136,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_titanium_88161,main="Log Titanium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_titanium_88161,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_vanadium_88164,main="Log Vanadium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_vanadium_88164,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_silicon_88165,main="Log Silicon Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_silicon_88165,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_zinc_88167,main="Log Zinc Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_zinc_88167,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_ammonium_88301,main="Log Ammonium Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_ammonium_88301,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_nitrate_88306,main="Log Nitrate Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_nitrate_88306,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_sulfate_88403,main="Log Sulfate Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_sulfate_88403,lwd=2,col="red")
# qqnorm(finaldatanodrops$log_EC,main="Log Elemental Carbon Normal Quantile Plot",col="blue")
# qqline(finaldatanodrops$log_EC,lwd=2,col="red")
# 
# #get rid of non-FRM
# finaldatanodrops$PM_25_non_FRM_88502 <- NULL
# 
# ##boxplots!
# par(mfrow=c(1,1))
# 
# #boxplot untransformed components
# boxplot(finaldatanodrops[2:14])
# 
# #boxplot transformed -- looks better
# boxplot(finaldatanodrops[23:35])
# 
# save(finaldatanodrops, file="finaldatanodrops.rdata")
# 
# hist(finaldatanodrops$isolationindex)
# 
# 
# #individual anovas not logs
# #PM25
# plot(PM25_88101 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(PM25_88101 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# PM25_88101_levene <- leveneTest(finaldatanodrops$PM25_88101 ~ as.factor(finaldatanodrops$RI_quantile))
# PM25_88101_levene
# 
# PM25_88101_anova <- aov(finaldatanodrops$PM25_88101 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(PM25_88101_anova)
# 
# 
# PM25_88101_one <- oneway.test(finaldatanodrops$PM25_88101 ~ finaldatanodrops$RI_quantile)
# PM25_88101_one
# summary(PM25_88101_one)
# TukeyHSD(PM25_88101_anova)
# 
# PM25_88101_aov_residuals <- residuals(object = PM25_88101_anova)
# summary(PM25_88101_aov_residuals)
# plot(PM25_88101_aov_residuals)
# 
# 
# #aluminum
# plot(aluminum_88104 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(aluminum_88104 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# aluminum_88104_levene <- leveneTest(finaldatanodrops$aluminum_88104 ~ as.factor(finaldatanodrops$RI_quantile))
# aluminum_88104_levene
# 
# aluminum_88104_anova <- aov(finaldatanodrops$aluminum_88104 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(aluminum_88104_anova)
# 
# aluminum_88104_one <- oneway.test(finaldatanodrops$aluminum_88104 ~ finaldatanodrops$RI_quantile)
# TukeyHSD(aluminum_88104_anova)
# 
# aluminum_88104_aov_residuals <- residuals(object = aluminum_88104_anova)
# summary(aluminum_88104_aov_residuals)
# plot(aluminum_88104_aov_residuals)
# 
# 
# 
# 
# 
# #calcium
# plot(calcium_88111 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(calcium_88111 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# calcium_88111_levene <- leveneTest(finaldatanodrops$calcium_88111 ~ as.factor(finaldatanodrops$RI_quantile))
# calcium_88111_levene
# 
# calcium_88111_anova <- aov(finaldatanodrops$calcium_88111 ~ as.factor(finaldatanodrops$RI_quantile)) 
# summary(calcium_88111_anova)
# 
# calcium_88111_one <- oneway.test(finaldatanodrops$calcium_88111 ~ finaldatanodrops$RI_quantile)
# TukeyHSD(calcium_88111_anova)
# 
# calcium_88111_aov_residuals <- residuals(object = calcium_88111_anova)
# summary(calcium_88111_aov_residuals)
# plot(calcium_88111_aov_residuals)
# 
# 
# 
# 
# #chlorine
# plot(chlorine_88115 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(chlorine_88115 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# chlorine_88115_levene <- leveneTest(finaldatanodrops$chlorine_88115 ~ as.factor(finaldatanodrops$RI_quantile))
# chlorine_88115_levene
# 
# chlorine_88115_anova <- aov(finaldatanodrops$chlorine_88115 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(chlorine_88115_anova)
# TukeyHSD(chlorine_88115_anova)
# 
# chlorine_88115_one <- oneway.test(finaldatanodrops$chlorine_88115 ~ finaldatanodrops$RI_quantile)
# TukeyHSD(chlorine_88115_anova)
# 
# chlorine_88115_aov_residuals <- residuals(object = chlorine_88115_anova)
# summary(chlorine_88115_aov_residuals)
# plot(chlorine_88115_aov_residuals)
# 
# 
# 
# #nickel
# plot(nickel_88136 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(nickel_88136 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# nickel_88136_levene <- leveneTest(finaldatanodrops$nickel_88136 ~ as.factor(finaldatanodrops$RI_quantile))
# nickel_88136_levene
# 
# nickel_88136_anova <- aov(finaldatanodrops$nickel_88136 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(nickel_88136_anova)
# 
# nickel_88136_one <- oneway.test(finaldatanodrops$nickel_88136 ~ finaldatanodrops$RI_quantile)
# summary(nickel_88136_one)
# nickel_88136_one
# TukeyHSD(nickel_88136_anova)
# 
# nickel_88136_aov_residuals <- residuals(object = nickel_88136_anova)
# summary(nickel_88136_aov_residuals)
# plot(nickel_88136_aov_residuals)
# 
# 
# 
# #titanium
# plot(titanium_88161 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(titanium_88161 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# titanium_88161_levene <- leveneTest(finaldatanodrops$titanium_88161 ~ as.factor(finaldatanodrops$RI_quantile))
# titanium_88161_levene
# 
# titanium_88161_anova <- aov(finaldatanodrops$titanium_88161 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(titanium_88161_anova)
# 
# titanium_88161_one <- oneway.test(finaldatanodrops$titanium_88161 ~ finaldatanodrops$RI_quantile)
# titanium_88161_one
# TukeyHSD(titanium_88161_anova)
# 
# titanium_88161_aov_residuals <- residuals(object = titanium_88161_anova)
# summary(titanium_88161_aov_residuals)
# plot(titanium_88161_aov_residuals)
# 
# 
# #vanadium
# plot(vanadium_88164 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(vanadium_88164 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# vanadium_88164_levene <- leveneTest(finaldatanodrops$vanadium_88164 ~ as.factor(finaldatanodrops$RI_quantile))
# vanadium_88164_levene
# 
# vanadium_88164_anova <- aov(finaldatanodrops$vanadium_88164 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(vanadium_88164_anova)
# 
# vanadium_88164_one <- oneway.test(finaldatanodrops$vanadium_88164 ~ finaldatanodrops$RI_quantile)
# vanadium_88164_one
# TukeyHSD(vanadium_88164_anova)
# 
# vanadium_88164_aov_residuals <- residuals(object = vanadium_88164_anova)
# summary(vanadium_88164_aov_residuals)
# plot(vanadium_88164_aov_residuals)
# 
# 
# #silicon
# plot(silicon_88165 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(silicon_88165 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# silicon_88165_levene <- leveneTest(finaldatanodrops$silicon_88165 ~ as.factor(finaldatanodrops$RI_quantile))
# silicon_88165_levene
# 
# silicon_88165_anova <- aov(finaldatanodrops$silicon_88165 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(silicon_88165_anova)
# 
# silicon_88165_one <- oneway.test(finaldatanodrops$silicon_88165 ~ finaldatanodrops$RI_quantile)
# silicon_88165_one
# TukeyHSD(silicon_88165_anova)
# 
# silicon_88165_aov_residuals <- residuals(object = silicon_88165_anova)
# summary(silicon_88165_aov_residuals)
# plot(silicon_88165_aov_residuals)
# 
# 
# 
# #zinc
# plot(zinc_88167 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(zinc_88167 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# zinc_88167_levene <- leveneTest(finaldatanodrops$zinc_88167 ~ as.factor(finaldatanodrops$RI_quantile))
# zinc_88167_levene
# 
# zinc_88167_anova <- aov(finaldatanodrops$zinc_88167 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(zinc_88167_anova)
# 
# zinc_88167_one <- oneway.test(finaldatanodrops$zinc_88167 ~ finaldatanodrops$RI_quantile)
# zinc_88167_one
# TukeyHSD(zinc_88167_anova)
# 
# zinc_88167_aov_residuals <- residuals(object = zinc_88167_anova)
# summary(zinc_88167_aov_residuals)
# plot(zinc_88167_aov_residuals)
# 
# 
# #ammonium
# plot(ammonium_88301 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(ammonium_88301 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# ammonium_88301_levene <- leveneTest(finaldatanodrops$ammonium_88301 ~ as.factor(finaldatanodrops$RI_quantile))
# ammonium_88301_levene
# 
# ammonium_88301_anova <- aov(finaldatanodrops$ammonium_88301 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(ammonium_88301_anova)
# 
# ammonium_88301_one <- oneway.test(finaldatanodrops$ammonium_88301 ~ finaldatanodrops$RI_quantile)
# ammonium_88301_one
# TukeyHSD(ammonium_88301_anova)
# 
# ammonium_88301_aov_residuals <- residuals(object = ammonium_88301_anova)
# summary(ammonium_88301_aov_residuals)
# plot(ammonium_88301_aov_residuals)
# 
# 
# 
# 
# #sodium
# plot(sodium_ion_88302 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(sodium_ion_88302 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# sodium_ion_88302_levene <- leveneTest(finaldatanodrops$sodium_ion_88302 ~ as.factor(finaldatanodrops$RI_quantile))
# sodium_ion_88302_levene
# 
# sodium_ion_88302_anova <- aov(finaldatanodrops$sodium_ion_88302 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(sodium_ion_88302_anova)
# 
# sodium_ion_88302_one <- oneway.test(finaldatanodrops$sodium_ion_88302 ~ finaldatanodrops$RI_quantile)
# sodium_ion_88302_one
# TukeyHSD(sodium_ion_88302_anova)
# 
# sodium_ion_88302_aov_residuals <- residuals(object = sodium_ion_88302_anova)
# summary(sodium_ion_88302_aov_residuals)
# plot(sodium_ion_88302_aov_residuals)
# 
# 
# 
# #nitrate
# plot(nitrate_88306 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(nitrate_88306 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# nitrate_88306_levene <- leveneTest(finaldatanodrops$nitrate_88306 ~ as.factor(finaldatanodrops$RI_quantile))
# nitrate_88306_levene
# 
# nitrate_88306_anova <- aov(finaldatanodrops$nitrate_88306 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(nitrate_88306_anova)
# 
# nitrate_88306_one <- oneway.test(finaldatanodrops$nitrate_88306 ~ finaldatanodrops$RI_quantile)
# nitrate_88306_one
# TukeyHSD(nitrate_88306_anova)
# 
# nitrate_88306_aov_residuals <- residuals(object = nitrate_88306_anova)
# summary(nitrate_88306_aov_residuals)
# plot(nitrate_88306_aov_residuals)
# 
# 
# 
# 
# #sulfate
# plot(sulfate_88403 ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(sulfate_88403 ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# sulfate_88403_levene <- leveneTest(finaldatanodrops$sulfate_88403 ~ as.factor(finaldatanodrops$RI_quantile))
# sulfate_88403_levene
# 
# sulfate_88403_anova <- aov(finaldatanodrops$sulfate_88403 ~ as.factor(finaldatanodrops$RI_quantile))
# summary(sulfate_88403_anova)
# 
# sulfate_88403_one <- oneway.test(finaldatanodrops$sulfate_88403 ~ finaldatanodrops$RI_quantile)
# sulfate_88403_one
# TukeyHSD(sulfate_88403_anova)
# 
# sulfate_88403_aov_residuals <- residuals(object = sulfate_88403_anova)
# summary(sulfate_88403_aov_residuals)
# plot(sulfate_88403_aov_residuals)
# 
# 
# 
# #EC
# plot(EC ~ RI_quantile, data=finaldatanodrops)
# 
# boxplot(EC ~ RI_quantile, data=finaldatanodrops,
#         xlab = "Treatment", ylab = "Weight",
#         frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))
# 
# EC_levene <- leveneTest(finaldatanodrops$EC ~ as.factor(finaldatanodrops$RI_quantile))
# EC_levene
# 
# EC_anova <- aov(finaldatanodrops$EC ~ as.factor(finaldatanodrops$RI_quantile))
# summary(EC_anova)
# 
# EC_one <- oneway.test(finaldatanodrops$EC ~ finaldatanodrops$RI_quantile)
# EC_one
# TukeyHSD(EC_anova)
# 
# EC_aov_residuals <- residuals(object = EC_anova)
# summary(EC_aov_residuals)
# plot(EC_aov_residuals)
# 
# 
# #### ended here 2018-04-03 ####
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# # split RI into quantiles
# threeyearspluswithRIquantiles <- within(threeyearspluswithRI, RI_quantile <- as.integer(cut(isolationindex, quantile(isolationindex, probs=0:5/5)), include.lowest=TRUE))
# # View(threeyearspluswithRIquantiles)
# 
# # pull census data
# censusfullracedata <- fullcensus[c("GEOID10","DP0100001","DP0080002","DP0080003","DP0110012","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")]
# 
# colnames(censusfullracedata) <- c("tract_ID","DP0100001","DP0080002","DP0080003","DP0110012","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")
# # View(censusfullracedata)
# 
# 
# # join race data to three years of data with RI quintile
# threeyearspluswithRIquantilesandrace <- merge(threeyearspluswithRIquantiles,censusfullracedata,by="tract_ID")
# 
# tractcountbypollutant <- colSums(!is.na(threeyearspluswithRIquantilesandrace))
# tractcountbypollutant
# 
# 
# 
# #### ACS DATA ####
# 
# # read in raw ACS data
# ACS_raw_data <- read.csv(file="ACSDataExportfromArcGIS.txt")
# 
# # save raW ACS data to disk
# save(ACS_raw_data,file="ACS_raw_data.rdata")
# 
# # load raw ACS data
# load(file="ACS_raw_data.rdata")
# 
# 
# 
# # read simplified raw ACS data
# ACS_simplified_raw_data <- read.csv(file="ACS_data_simplified_from_ArcGIS.txt")
# 
# # save simplified raw ACS data to disk
# save(ACS_simplified_raw_data,file="ACS_simplified_raw_data.rdata")
# 
# # load simplified raw ACS data
# load(file="ACS_simplified_raw_data.rdata")
# 
# # get rid of unnecessary columns
# #ACS_data <- ACS_simplified_raw_data[, -grep("GEOID_1", colnames(ACS_raw_data))]
# #ACS_data <- ACS_data[, -grep("OBJECTID", colnames(ACS_data))]
# #ACS_data <- subset(ACS_data, select=-c(STATEFP,COUNTYFP,TRACTCE,NAMELSAD,MTFCC,ALAND,AWATER,INTPTLAT,INTPTLON,Shape_Length,Shape_Area,NAME,FUNCSTAT))
# 
# # save shrunken ACS data
# #save(ACS_data,file="ACS_simplified_data.rdata")
# 
# # population variables
# acs_pop_no_marg <- ACS_simplified_raw_data[c <- c("GEOID","B00001e1")]
# 
# acs_earnings_no_marg <- ACS_raw_data[c("GEOID","B20001e1","B20001e2","B20001e3","B20001e4","B20001e5","B20001e6","B20001e7","B20001e8","B20001e9","B20001e10","B20001e11","B20001e12","B20001e13","B20001e14","B20001e15","B20001e16","B20001e17","B20001e18","B20001e19","B20001e20","B20001e21","B20001e22","B20001e23","B20001e24","B20001e25","B20001e26","B20001e27","B20001e28","B20001e29","B20001e30","B20001e31","B20001e32","B20001e33","B20001e34","B20001e35","B20001e36","B20001e37","B20001e38","B20001e39","B20001e40","B20001e41","B20001e42","B20001e43")]
# 
# acs_median_earnings_no_marg <- ACS_raw_data[c("GEOID","B20002e1")]
# 
# # education variables
# acs_education_variables <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003m1","B15003e2","B15003m2","B15003e3","B15003m3","B15003e4","B15003m4","B15003e5","B15003m5","B15003e6","B15003m6","B15003e7","B15003m7","B15003e8","B15003m8","B15003e9","B15003m9","B15003e10","B15003m10","B15003e11","B15003m11","B15003e12","B15003m12","B15003e13","B15003m13","B15003e14","B15003m14","B15003e15","B15003m15","B15003e16","B15003m16","B15003e17","B15003m17","B15003e18","B15003m18","B15003e19","B15003m19","B15003e20","B15003m20","B15003e21","B15003m21","B15003e22","B15003m22","B15003e23","B15003m23","B15003e24","B15003m24","B15003e25","B15003m25")]
# 
# education_labels <- c("tract_ID","ed_pop","ed_pop_margin","ed_no_school","ed_no_school_margin","ed_nurse","ed_nurse_margin","ed_kinder","ed_kinder_margin","ed_1","ed_1_margin","ed_2","ed_2_margin","ed_3","ed_3_margin","ed_4","ed_4_margin","ed_5","ed_5_margin","ed_6","ed_6_margin","ed_7","ed_7_margin","ed_8","ed_8_margin","ed_9","ed_9_margin","ed_10","ed_10_margin","ed_11","ed_11_margin","ed_12","ed_12_margin","ed_hsdip","ed_hsdip_margin","ed_GED","ed_GED_margin","ed_<1_college","ed_<1_college_margin","ed_1+_college","ed_1+_college_margin","ed_associate","ed_associate_margin","ed_bachelor","ed_bachelor_margin","ed_master","ed_master_margin","ed_prof","ed_prof_marg","ed_doctor","ed_doctor_marg")
# 
# acs_education_variables_no_margins <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003e2","B15003e3","B15003e4","B15003e5","B15003e6","B15003e7","B15003e8","B15003e9","B15003e10","B15003e11","B15003e12","B15003e13","B15003e14","B15003e15","B15003e16","B15003e17","B15003e18","B15003e19","B15003e20","B15003e21","B15003e22","B15003e23","B15003e24","B15003e25")]
# # View(acs_education_variables_no_margins)
# 
# education_labels_no_margins <- c("GEOID","ed_pop","ed_no_school","ed_nurse","ed_kinder","ed_1","ed_2","ed_3","ed_4","ed_5","ed_6","ed_7","ed_8","ed_9","ed_10","ed_11","ed_12","ed_hsdip","ed_GED","ed_<1_college","ed_1+_college","ed_associate","ed_bachelor","ed_master","ed_prof","ed_doctor")
# 
# colnames(acs_education_variables_no_margins) <- education_labels_no_margins
# 
# # household value
# acs_median_househ_value_no_marg <- ACS_raw_data[c("GEOID","B25077e1")]
# 
# # household income
# acs_median_household_income_no_marg <- ACS_raw_data[c("GEOID","B19013e1")]
# 
# # poverty
# acs_poverty <- ACS_raw_data[c("GEOID","B17001e1","B17001e2")]
# 
# # unemployment
# acs_unemp_no_marg <- ACS_simplified_raw_data[c("GEOID","B23025e1","B23025e2","B23025e3","B23025e4","B23025e5","B23025e6","B23025e7")]
# 
# # make tract_ID back to GEOID
# threeyearspluswithRIquantilesandrace$GEOID <- threeyearspluswithRIquantilesandrace$tract_ID
# threeyearspluswithRIquantilesandrace$tract_ID
# 
# # figuring out why a variable is dropping -- because Richmond County Tract 228 has no population (?) in the 2012 5-year ACS estimates (GEOID 36085022800)
# #airdataID <- as.data.frame(alldatawithRI$GEOID)
# #colnames(airdataID) <- c("GEOID")
# #acs_pop_no_margID <- as.data.frame(acs_pop_no_marg$GEOID)
# #colnames(acs_pop_no_margID) <- c("GEOID")
# #testingIDs <- merge(airdataID,acs_pop_no_margID,by="GEOID",all.x=TRUE)
# 
# #merge air and seg with acs
# air_acs_seg_no_drops <- merge(threeyearspluswithRIquantilesandrace,acs_pop_no_marg,by="GEOID",all.x=TRUE)
# air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_earnings_no_marg,by="GEOID",all.x=TRUE)
# air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_earnings_no_marg,by="GEOID",all.x=TRUE)
# air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_education_variables_no_margins,by="GEOID",all.x=TRUE)
# air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_househ_value_no_marg,by="GEOID",all.x=TRUE)
# air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_household_income_no_marg,by="GEOID",all.x=TRUE)
# air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_poverty,by="GEOID",all.x=TRUE)
# air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_unemp_no_marg,by="GEOID",all.x=TRUE)
# # View(air_acs_seg_no_drops)
# 
# save(air_acs_seg_no_drops,file="air_acs_seg_no_drops.rdata")
# 
# 
# #### add census ####
# #censusdataforfinaljoin <- census_2010_DP1_raw
# #censusdataforfinaljoin$GEOID <- censusdataforfinaljoin$GEOID10
# #censusdataforfinaljoin$GEOID10 <- NULL
# 
# 
# #censusdataforfinaljoin <- subset(censusdataforfinaljoin, select=-c(FID,ALAND10,AWATER10,Shape_Leng,Shape_Area))
# #colnames(censusdataforfinaljoin)
# 
# # age from census
# agefromcensus <- fullcensus[c("GEOID10","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")]
# 
# colnames(agefromcensus) <- c("GEOID","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")
# # View(agefromcensus)
# 
# # Hispanic or Latino from census
# HispanicLatinofromCensus <- fullcensus[c("GEOID10","DP0100001","DP0100002")]
# # View(HispanicLatinofromCensus)
# colnames(HispanicLatinofromCensus) <- c("GEOID","DP0100001","DP0100002")
# 
# # race and ethnicity from census
# raceethnicityfromcensus <- fullcensus[c("GEOID10","DP0110001","DP0110002","DP0110003","DP0110004","DP0110005","DP0110006","DP0110007","DP0110008","DP0110009","DP0110010","DP0110011","DP0110012","DP0110013","DP0110014","DP0110015","DP0110016","DP0110017")]    
# 
# colnames(raceethnicityfromcensus) <- c("GEOID","DP0110001","DP0110002","DP0110003","DP0110004","DP0110005","DP0110006","DP0110007","DP0110008","DP0110009","DP0110010","DP0110011","DP0110012","DP0110013","DP0110014","DP0110015","DP0110016","DP0110017")
# # View(raceethnicityfromcensus)
# 
# # merge census to prior
# air_acs_census_seg_no_drops <- merge(air_acs_seg_no_drops,agefromcensus,by="GEOID")
# air_acs_census_seg_no_drops <- merge(air_acs_census_seg_no_drops,HispanicLatinofromCensus,by="GEOID")
# air_acs_census_seg_no_drops <- merge(air_acs_census_seg_no_drops,raceethnicityfromcensus,by="GEOID")
# 
# finaldatanodrops <- air_acs_census_seg_no_drops
# save(finaldatanodrops,file="finaldatanodrops.rdata")
# load(file="finaldatanodrops.rdata")
# # View(finaldatanodrops)
# 
# 
# ########making the variables I need
# 
# # Race: population self-identified as non-Hispanic white, non-Hispanic black or African American, non-Hispanic Asian, Hispanic, or other [SF1.P08 (Summary File 1, Table P8)]
# # Educational attainment: persons geq 25 years of age with less than a high school degree or equivalent, high school degree or equivalent, or some college (SF3.P37)
# # Poverty: persons in poverty using Census-defined poverty levels (SF3.P87)
# # Unemployment: persons geq 16 years of age who were unemployed, employed, or not job seekers (SF3.P43)
# # Age: 0-19, 20-64, or geq 65 years of age (SF1.P12)
# # Earnings: average annual earnings of those geq 16 years of age with earnings (SF3.P84)
# # Total population: (SF1.P08).
# # 
# # Bravo paper:
# # primary and secondary RUCA # codes
# # Race/ethnicity: population self-identified as NHB, NHW, Hispanic, or
# # other
# # Age: persons 0-19, 20-64, or geq65y of age
# # Educational attainment: persons geq25ywith less than a high school degree
# # or equivalent; high school degree/GED or some college; or college
# # degree
# # Poverty: percentage in poverty using census-defined poverty levels
# # Unemployment: percentage geq 16y who are unemployed.
# 
# 
# 
# 
# 
# # % white -- 
# finaldatanodrops$percent_white <- finaldatanodrops$DP0080003 / finaldatanodrops$DP0100001
# 
# # % of population with less than high school education
# finaldatanodrops$percent_less_than_high_school <- finaldatanodrops$ed_no_school+finaldatanodrops$ed_nurse+finaldatanodrops$ed_kinder+finaldatanodrops$ed_1+finaldatanodrops$ed_2+finaldatanodrops$ed_3+finaldatanodrops$ed_4+finaldatanodrops$ed_5+finaldatanodrops$ed_6+finaldatanodrops$ed_7+finaldatanodrops$ed_8+finaldatanodrops$ed_9+finaldatanodrops$ed_10+finaldatanodrops$ed_11+finaldatanodrops$ed_12/finaldatanodrops$ed_pop
# 
# # % in poverty
# finaldatanodrops$percent_poverty <- finaldatanodrops$B17001e2 / finaldatanodrops$B17001e1
# 
# # % black
# finaldatanodrops$percent_black <- finaldatanodrops$DP0110012 / finaldatanodrops$DP0100001
# 
# # % Hispanic
# finaldatanodrops$percent_Hispanic <- finaldatanodrops$DP0100002/finaldatanodrops$DP0100001
# # View(finaldatanodrops)
# 
# # % unemployed
# finaldatanodrops$percent_unemployed <- finaldatanodrops$B23025e5/finaldatanodrops$B23025e1
# 
# # age 0-19
# finaldatanodrops$age0to19 <- finaldatanodrops$DP0010002+finaldatanodrops$DP0010003+finaldatanodrops$DP0010004+finaldatanodrops$DP0010005
# 
# # age 20-64
# finaldatanodrops$age20to64 <- finaldatanodrops$DP0010006+finaldatanodrops$DP0010007+finaldatanodrops$DP0010008+finaldatanodrops$DP0010009+finaldatanodrops$DP0010010+finaldatanodrops$DP0010011+finaldatanodrops$DP0010012+finaldatanodrops$DP0010013+finaldatanodrops$DP0010014
# 
# # age 65+
# finaldatanodrops$age65plus <- finaldatanodrops$DP0010015+finaldatanodrops$DP0010016+finaldatanodrops$DP0010017+finaldatanodrops$DP0010018+finaldatanodrops$DP0010019
# 
# save(finaldatanodrops,file="finaldatanodrops.rdata")
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# #### ended here 2018-03-19
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 





# ###########FROM HERE WE SPLIT INTO ALL, 3, AND 5-YEAR DATA RUNs
# 
# ####ALL DATA RUN
# #  Aggregate mean on months and year and get mean for all data
# monthlyaveragesnodrops <- aggregate(arithmetic_mean ~ month + year + parameter_code + tract_ID, allairdataandruca, mean)
# 
# 
# #get long-term averages
# averagebycensustractnodrops <- aggregate(arithmetic_mean ~ parameter_code + tract_ID, data = monthlyaveragesnodrops, FUN="mean")
# 
# #make it by tract
# moltenaverage <- melt(averagebycensustractnodrops)
# 
# tractaverage <- dcast(moltenaverage,tract_ID ~ parameter_code)
# 
# #remove OC
# tractaverage$`88320` <- NULL
# tractaverage$`88382` <- NULL
# 
# #count number of tracts for each parameter
# monitorcountbypollutant <- colSums(!is.na(tractaverage))
# monitorcountbypollutant
# write.csv(monitorcountbypollutant,file="monitorcountbypollutant.csv")
# 
# #add rurality data
# tractaverageplusruca <- merge(tractaverage,onlyruca,by="tract_ID")
# 
# # add total population data
# censustotalpopulation <- fullcensus[c("GEOID10", "DP0010001")]
# colnames(censustotalpopulation) <- c("tract_ID","total_population_DP0010001")
# tractaverageplusrucaandtotalpop <- merge(tractaverageplusruca,censustotalpopulation,by="tract_ID")
# 
# #drop non-urbans
# tractaverageonlyurbanandtotalpop <- tractaverageplusrucaandtotalpop[which(tractaverageplusrucaandtotalpop$urban=='urban'),]
# 
# #count new number of tracts for each parameter
# monitorcountbypollutanturban <- colSums(!is.na(tractaverageonlyurbanandtotalpop))
# write.csv(monitorcountbypollutanturban,file="monitorcountbypollutanturban.csv")
# 
# #drop tracts < 100
# tractaverageonlyurbanover100 <- tractaverageonlyurbanandtotalpop[which(tractaverageonlyurbanandtotalpop$total_population_DP0010001>100),]
# 
# #count tracts again
# monitorcountonlyurbanover100 <- colSums(!is.na(tractaverageonlyurbanover100))
# write.csv(monitorcountonlyurbanover100,file="monitorcountonlyurbanover100.csv")
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# #####THREE-YEAR DATA RUN
# #aggregate mean on months and years for three-year data
# monthlyaveragesnodrops3 <- aggregate(arithmetic_mean ~ month + year + parameter_code + tract_ID, lessthan3yearsexcluded, mean)
# 
# #get long-term averages
# averagebycensustractnodrops3 <- aggregate(arithmetic_mean ~ parameter_code + tract_ID, data = monthlyaveragesnodrops3, FUN="mean")
# 
# #make it by tract
# moltenaverage3 <- melt(averagebycensustractnodrops3)
# 
# tractaverage3 <- dcast(moltenaverage3,tract_ID ~ parameter_code)
# 
# #remove OC
# tractaverage3$`88320` <- NULL
# tractaverage3$`88382` <- NULL
# 
# #count number of tracts for each parameter
# monitorcountbypollutant3 <- colSums(!is.na(tractaverage3))
# write.csv(monitorcountbypollutant3,file="monitorcountbypollutant3.csv")
# 
# #add rurality data
# tractaverageplusruca3 <- merge(tractaverage3,onlyruca,by="tract_ID")
# 
# # add total population data
# censustotalpopulation <- fullcensus[c("GEOID10", "DP0010001")]
# colnames(censustotalpopulation) <- c("tract_ID","total_population_DP0010001")
# tractaverageplusrucaandtotalpop3 <- merge(tractaverageplusruca3,censustotalpopulation,by="tract_ID")
# 
# #drop non-urbans
# tractaverageonlyurbanandtotalpop3 <- tractaverageplusrucaandtotalpop3[which(tractaverageplusrucaandtotalpop3$urban=='urban'),]
# 
# #count new number of tracts for each parameter
# monitorcountbypollutanturban3 <- colSums(!is.na(tractaverageonlyurbanandtotalpop3))
# write.csv(monitorcountbypollutanturban3,file="monitorcountbypollutanturban3.csv")
# 
# #drop tracts < 100
# tractaverageonlyurbanover1003 <- tractaverageonlyurbanandtotalpop3[which(tractaverageonlyurbanandtotalpop3$total_population_DP0010001>100),]
# 
# #count tracts again
# monitorcountonlyurbanover1003 <- colSums(!is.na(tractaverageonlyurbanover1003))
# write.csv(monitorcountonlyurbanover1003,file="monitorcountonlyurbanover1003.csv")
# 
# 
# load(file="finaldatanodrops.rdata")
# 
# 
# 
# 
# 
# 
# #####FIVE-YEAR DATA RUN
# #aggregate mean on months and years for five-year data
# monthlyaveragesnodrops5 <- aggregate(arithmetic_mean ~ month + year + parameter_code + tract_ID, lessthan5yearsexcluded, mean)
# 
# #get long-term averages
# averagebycensustractnodrops5 <- aggregate(arithmetic_mean ~ parameter_code + tract_ID, data = monthlyaveragesnodrops5, FUN="mean")
# 
# #make it by tract
# moltenaverage5 <- melt(averagebycensustractnodrops5)
# 
# 
# tractaverage5 <- dcast(moltenaverage5,tract_ID ~ parameter_code)
# 
# 
# #remove OC
# tractaverage5$`88320` <- NULL
# tractaverage5$`88382` <- NULL
# 
# 
# #count number of tracts for each parameter
# monitorcountbypollutant5 <- colSums(!is.na(tractaverage5))
# write.csv(monitorcountbypollutant5,file="monitorcountbypollutant5.csv")
# 
# #add rurality data
# tractaverageplusruca5 <- merge(tractaverage5,onlyruca,by="tract_ID")
# 
# 
# # add total population data
# censustotalpopulation <- fullcensus[c("GEOID10", "DP0010001")]
# colnames(censustotalpopulation) <- c("tract_ID","total_population_DP0010001")
# 
# tractaverageplusrucaandtotalpop5 <- merge(tractaverageplusruca5,censustotalpopulation,by="tract_ID")
# 
# #drop non-urbans
# tractaverageonlyurbanandtotalpop5 <- tractaverageplusrucaandtotalpop5[which(tractaverageplusrucaandtotalpop5$urban=='urban'),]
# 
# 
# #count new number of tracts for each parameter
# monitorcountbypollutanturban5 <- colSums(!is.na(tractaverageonlyurbanandtotalpop5))
# 
# write.csv(monitorcountbypollutanturban5,file="monitorcountbypollutanturban5.csv")
# 
# #drop tracts < 100
# tractaverageonlyurbanover1005 <- tractaverageonlyurbanandtotalpop5[which(tractaverageonlyurbanandtotalpop5$total_population_DP0010001>100),]
# 
# 
# #count tracts again
# monitorcountonlyurbanover1005 <- colSums(!is.na(tractaverageonlyurbanover1005))
# 
# write.csv(monitorcountonlyurbanover1005,file="monitorcountonlyurbanover1005.csv")
# 
# #need for methods
# #original monitor count











#### MERGE RACIAL ISOLATION INDEX AND AIR POLLUTION DATA ####

# ###ALL DATA
# alldatawithRI <- merge(tractaverageonlyurbanover100,racialisolationindexmonitors,by="tract_ID")
# names <- colnames(alldatawithRI)
# names
# colnames(alldatawithRI) <- c("tract_ID","PM25_88101","aluminum_88104","calcium_88111","chlorine_88115","nickel_88136","titanium_88161","vanadium_88164","silicon_88165","zinc_88167","ammonium_88301","sodium_ion_88302","nitrate_88306","sulfate_88403","PM_25_non_FRM_88502","EC","ruca_prime","ruca_second","urban","total_population_DP0010001","isolationindex")
# # View(alldatawithRI)
# save(alldatawithRI,file="alldatawithRI.rdata")
# load(file="alldatawithRI.rdata")




# #3 years or more
# threeyearspluswithRI <- merge(tractaverageonlyurbanover1003,racialisolationindexmonitors,by="tract_ID")
# # View(threeyearspluswithRI)
# # colnames(threeyearspluswithRI) <- c("tract_ID","PM25_88101","aluminum_88104","calcium_88111","chlorine_88115","nickel_88136","titanium_88161","vanadium_88164","silicon_88165","zinc_88167","ammonium_88301","sodium_ion_88302","nitrate_88306","sulfate_88403","PM_25_non_FRM_88502","EC","ruca_prime","ruca_second","urban","total_population_DP0010001","isolationindex")
#  # View(threeyearspluswithRI)
# save(threeyearspluswithRI,file="threeyearspluswithRI.rdata")
# # load(file="threeyearspluswithRI.rdata")
# 
# #####
# # run everything with three years plus with RI
# 
# 
# # split RI into quantiles
# threeyearspluswithRIquantiles <- within(threeyearspluswithRI, RI_quantile <- as.integer(cut(isolationindex, quantile(isolationindex, probs=0:5/5)), include.lowest=TRUE))
# # View(threeyearspluswithRIquantiles)
# 
# # pull census data
# censusfullracedata <- fullcensus[c("GEOID10","DP0100001","DP0080002","DP0080003","DP0110012","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")]
# 
# colnames(censusfullracedata) <- c("tract_ID","DP0100001","DP0080002","DP0080003","DP0110012","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")
# # View(censusfullracedata)
# 
# 
# # join race data to three years of data with RI quintile
# threeyearspluswithRIquantilesandrace <- merge(threeyearspluswithRIquantiles,censusfullracedata,by="tract_ID")
# 
# tractcountbypollutant <- colSums(!is.na(alldatawithRI))
# tractcountbypollutant

########################ACS DATA

# read in raw ACS data
# ACS_raw_data <- read.csv(file="ACSDataExportfromArcGIS.txt")

# save raW ACS data to disk
# save(ACS_raw_data,file="ACS_raw_data.rdata")

# load raw ACS data
load(file="ACS_raw_data.rdata")



#read simplified raw data
#ACS_simplified_raw_data <- read.csv(file="ACS_data_simplified_from_ArcGIS.txt")

#save simplified raw data to disk
#save(ACS_simplified_raw_data,file="ACS_simplified_raw_data.rdata")
## View(ACS_simplified_raw_data)


load(file="ACS_simplified_raw_data.rdata")
#get rid of unnecessary columns
#ACS_data  <-  ACS_simplified_raw_data[, -grep("GEOID_1", colnames(ACS_raw_data))]
#ACS_data <- ACS_data[, -grep("OBJECTID", colnames(ACS_data))]
#ACS_data <- subset(ACS_data, select=-c(STATEFP,COUNTYFP,TRACTCE,NAMELSAD,MTFCC,ALAND,AWATER,INTPTLAT,INTPTLON,Shape_Length,Shape_Area,NAME,FUNCSTAT))

#save shrunken ACS data
#save(ACS_data,file="ACS_simplified_data.rdata")


#population variables
acs_pop_no_marg <- ACS_simplified_raw_data[c <- c("GEOID","B00001e1")]

acs_earnings_no_marg <- ACS_raw_data[c("GEOID","B20001e1","B20001e2","B20001e3","B20001e4","B20001e5","B20001e6","B20001e7","B20001e8","B20001e9","B20001e10","B20001e11","B20001e12","B20001e13","B20001e14","B20001e15","B20001e16","B20001e17","B20001e18","B20001e19","B20001e20","B20001e21","B20001e22","B20001e23","B20001e24","B20001e25","B20001e26","B20001e27","B20001e28","B20001e29","B20001e30","B20001e31","B20001e32","B20001e33","B20001e34","B20001e35","B20001e36","B20001e37","B20001e38","B20001e39","B20001e40","B20001e41","B20001e42","B20001e43")]

acs_median_earnings_no_marg <- ACS_raw_data[c("GEOID","B20002e1")]


#education variables
#acs_education_variables <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003m1","B15003e2","B15003m2","B15003e3","B15003m3","B15003e4","B15003m4","B15003e5","B15003m5","B15003e6","B15003m6","B15003e7","B15003m7","B15003e8","B15003m8","B15003e9","B15003m9","B15003e10","B15003m10","B15003e11","B15003m11","B15003e12","B15003m12","B15003e13","B15003m13","B15003e14","B15003m14","B15003e15","B15003m15","B15003e16","B15003m16","B15003e17","B15003m17","B15003e18","B15003m18","B15003e19","B15003m19","B15003e20","B15003m20","B15003e21","B15003m21","B15003e22","B15003m22","B15003e23","B15003m23","B15003e24","B15003m24","B15003e25","B15003m25")]

#education_labels <- c("tract_ID","ed_pop","ed_pop_margin","ed_no_school","ed_no_school_margin","ed_nurse","ed_nurse_margin","ed_kinder","ed_kinder_margin","ed_1","ed_1_margin","ed_2","ed_2_margin","ed_3","ed_3_margin","ed_4","ed_4_margin","ed_5","ed_5_margin","ed_6","ed_6_margin","ed_7","ed_7_margin","ed_8","ed_8_margin","ed_9","ed_9_margin","ed_10","ed_10_margin","ed_11","ed_11_margin","ed_12","ed_12_margin","ed_hsdip","ed_hsdip_margin","ed_GED","ed_GED_margin","ed_<1_college","ed_<1_college_margin","ed_1+_college","ed_1+_college_margin","ed_associate","ed_associate_margin","ed_bachelor","ed_bachelor_margin","ed_master","ed_master_margin","ed_prof","ed_prof_marg","ed_doctor","ed_doctor_marg")

acs_education_variables_no_margins <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003e2","B15003e3","B15003e4","B15003e5","B15003e6","B15003e7","B15003e8","B15003e9","B15003e10","B15003e11","B15003e12","B15003e13","B15003e14","B15003e15","B15003e16","B15003e17","B15003e18","B15003e19","B15003e20","B15003e21","B15003e22","B15003e23","B15003e24","B15003e25")]
# View(acs_education_variables_no_margins)

#education_labels_no_margins <- c("tract_ID","ed_pop","ed_no_school","ed_nurse","ed_kinder","ed_1","ed_2","ed_3","ed_4","ed_5","ed_6","ed_7","ed_8","ed_9","ed_10","ed_11","ed_12","ed_hsdip","ed_GED","ed_<1_college","ed_1+_college","ed_associate","ed_bachelor","ed_master","ed_prof","ed_doctor")

#colnames(acs_education_variables_no_margins) <- education_labels_no_margins



#household value
acs_median_househ_value_no_marg <- ACS_raw_data[c("GEOID","B25077e1")]

#household income
acs_median_household_income_no_marg <- ACS_raw_data[c("GEOID","B19013e1")]

#poverty
acs_poverty <- ACS_raw_data[c("GEOID","B17001e1","B17001e2")]

#unemployment
acs_unemp_no_marg <- ACS_simplified_raw_data[c("GEOID","B23025e1","B23025e2","B23025e3","B23025e4","B23025e5","B23025e6","B23025e7")]


#make tract_ID back to GEOID
alldatawithRI$GEOID <- alldatawithRI$tract_ID
alldatawithRI$tract_ID

#figuring out why a variable is dropping -- because Richmond County Tract 228 has no population (?) in the 2012 5-year ACS estimates (GEOID 36085022800)
#airdataID <- as.data.frame(alldatawithRI$GEOID)
#colnames(airdataID) <- c("GEOID")
#acs_pop_no_margID <- as.data.frame(acs_pop_no_marg$GEOID)
#colnames(acs_pop_no_margID) <- c("GEOID")
#testingIDs <- merge(airdataID,acs_pop_no_margID,by="GEOID",all.x=TRUE)

#merge air and seg with acs
air_acs_seg_no_drops <- merge(alldatawithRI,acs_pop_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_education_variables_no_margins,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_househ_value_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_household_income_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_poverty,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_unemp_no_marg,by="GEOID",all.x=TRUE)
# View(air_acs_seg_no_drops)

save(air_acs_seg_no_drops,file="air_acs_seg_no_drops.rdata")




# 
# 
# # add census
# # censusdataforfinaljoin <- census_2010_DP1_raw
# # censusdataforfinaljoin$GEOID <- censusdataforfinaljoin$GEOID10
# # censusdataforfinaljoin$GEOID10 <- NULL
# 
# 
# # censusdataforfinaljoin <- subset(censusdataforfinaljoin, select=-c(FID,ALAND10,AWATER10,Shape_Leng,Shape_Area))
# # colnames(censusdataforfinaljoin)
# 
# # age from census
# agefromcensus <- fullcensus[c("GEOID10","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")]
# 
# colnames(agefromcensus) <- c("GEOID","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")
# # View(agefromcensus)
# 
# HispanicLatinofromCensus <- fullcensus[c("GEOID10","DP0100001","DP0100002")]
# # View(HispanicLatinofromCensus)
# colnames(HispanicLatinofromCensus) <- c("GEOID","DP0100001","DP0100002")
# 
# # View(air_acs_seg_no_drops)
# air_acs_census_seg_no_drops <- merge(air_acs_seg_no_drops,agefromcensus,by="GEOID")
# 
# 
# finaldatanodrops <- air_acs_census_seg_no_drops
# save(finaldatanodrops,file = "finaldatanodrops.rdata")
# 
# finaldatanodrops <- merge(finaldatanodrops,HispanicLatinofromCensus,by="GEOID")

















































# # 5 years or more
# fiveyearspluswithRI <- merge(tractaverageonlyurbanover1005,racialisolationindexmonitors,by="tract_ID")
# colnames(fiveyearspluswithRI) <- c("tract_ID","PM25_88101","aluminum_88104","calcium_88111","chlorine_88115","nickel_88136","titanium_88161","vanadium_88164","silicon_88165","zinc_88167","ammonium_88301","sodium_ion_88302","nitrate_88306","sulfate_88403","PM_25_non_FRM_88502","EC","ruca_prime","ruca_second","urban","total_population_DP0010001","isolationindex")
# # View(fiveyearspluswithRI)
# save(fiveyearspluswithRI,file="fiveyearspluswithRI.rdata")
# load(file="fiveyearspluswithRI.rdata")




########################
# # simple regression controlled for nothing
# alldatamultipleregressRII <- lm(formula = cbind(PM25_88101,aluminum_88104,calcium_88111,chlorine_88115,nickel_88136,titanium_88161,vanadium_88164,silicon_88165,zinc_88167,ammonium_88301,nitrate_88306,sulfate_88403,EC)~isolationindex,data=alldatawithRI)
# summary(alldatamultipleregressRII)
# 
# threeyeardatamultipleregressRII <- lm(formula = cbind(PM25_88101,aluminum_88104,calcium_88111,chlorine_88115,nickel_88136,titanium_88161,vanadium_88164,silicon_88165,zinc_88167,ammonium_88301,nitrate_88306,sulfate_88403,EC)~isolationindex,data=threeyearspluswithRI)
# summary(threeyeardatamultipleregressRII)
# 
# fiveyearmultipleregressRII <- lm(formula = cbind(PM25_88101,aluminum_88104,calcium_88111,chlorine_88115,nickel_88136,titanium_88161,vanadium_88164,silicon_88165,zinc_88167,ammonium_88301,nitrate_88306,sulfate_88403,EC)~isolationindex,data=fiveyearspluswithRI)
# summary(fiveyeardatamultipleregressRII)

# plot RI
# plot(isolationindex ~ isolationindex,data=alldatawithRI)







#####now specifc to ALL DATA

#split RI into quantiles
alldatawithRI <- within(alldatawithRI, RI_quantile <- as.integer(cut(isolationindex, quantile(isolationindex, probs=0:5/5)), include.lowest=TRUE))
# View(alldatawithRI)

#pull census data
censusfullracedata <- fullcensus[c("GEOID10","DP0100001","DP0080002","DP0080003","DP0110012","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")]

colnames(censusfullracedata) <- c("tract_ID","DP0100001","DP0080002","DP0080003","DP0110012","DP0080005","DP0080006","DP0080007","DP0080008","DP0080009","DP0080010","DP0080011","DP0080012","DP0080013","DP0080014","DP0080015","DP0080016","DP0080017","DP0080018","DP0080019","DP0080020","DP0080021","DP0080022","DP0080023","DP0080024")
# View(censusfullracedata)


#joinracedatatoalldatawithRI
load(file="alldatawithRI.rdata")
alldatawithRI <- merge(alldatawithRI,censusfullracedata,by="tract_ID")

tractcountbypollutant <- colSums(!is.na(alldatawithRI))
tractcountbypollutant

########################ACS DATA

#read in raw ACS data
#ACS_raw_data <- read.csv(file="ACSDataExportfromArcGIS.txt")

#save raW ACS data to disk
#save(ACS_raw_data,file="ACS_raw_data.rdata")

#load raw ACS data
load(file="ACS_raw_data.rdata")

#read simplified raw data
#ACS_simplified_raw_data <- read.csv(file="ACS_data_simplified_from_ArcGIS.txt")

#save simplified raw data to disk
#save(ACS_simplified_raw_data,file="ACS_simplified_raw_data.rdata")
## View(ACS_simplified_raw_data)


load(file="ACS_simplified_raw_data.rdata")
#get rid of unnecessary columns
#ACS_data <- ACS_simplified_raw_data[, -grep("GEOID_1", colnames(ACS_raw_data))]
#ACS_data <- ACS_data[, -grep("OBJECTID", colnames(ACS_data))]
#ACS_data <- subset(ACS_data, select=-c(STATEFP,COUNTYFP,TRACTCE,NAMELSAD,MTFCC,ALAND,AWATER,INTPTLAT,INTPTLON,Shape_Length,Shape_Area,NAME,FUNCSTAT))

#save shrunken ACS data
#save(ACS_data,file="ACS_simplified_data.rdata")

#population variables
acs_pop_no_marg <- ACS_simplified_raw_data[c <- c("GEOID","B00001e1")]

acs_earnings_no_marg <- ACS_raw_data[c("GEOID","B20001e1","B20001e2","B20001e3","B20001e4","B20001e5","B20001e6","B20001e7","B20001e8","B20001e9","B20001e10","B20001e11","B20001e12","B20001e13","B20001e14","B20001e15","B20001e16","B20001e17","B20001e18","B20001e19","B20001e20","B20001e21","B20001e22","B20001e23","B20001e24","B20001e25","B20001e26","B20001e27","B20001e28","B20001e29","B20001e30","B20001e31","B20001e32","B20001e33","B20001e34","B20001e35","B20001e36","B20001e37","B20001e38","B20001e39","B20001e40","B20001e41","B20001e42","B20001e43")]

acs_median_earnings_no_marg <- ACS_raw_data[c("GEOID","B20002e1")]


#education variables
#acs_education_variables <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003m1","B15003e2","B15003m2","B15003e3","B15003m3","B15003e4","B15003m4","B15003e5","B15003m5","B15003e6","B15003m6","B15003e7","B15003m7","B15003e8","B15003m8","B15003e9","B15003m9","B15003e10","B15003m10","B15003e11","B15003m11","B15003e12","B15003m12","B15003e13","B15003m13","B15003e14","B15003m14","B15003e15","B15003m15","B15003e16","B15003m16","B15003e17","B15003m17","B15003e18","B15003m18","B15003e19","B15003m19","B15003e20","B15003m20","B15003e21","B15003m21","B15003e22","B15003m22","B15003e23","B15003m23","B15003e24","B15003m24","B15003e25","B15003m25")]

#education_labels <- c("tract_ID","ed_pop","ed_pop_margin","ed_no_school","ed_no_school_margin","ed_nurse","ed_nurse_margin","ed_kinder","ed_kinder_margin","ed_1","ed_1_margin","ed_2","ed_2_margin","ed_3","ed_3_margin","ed_4","ed_4_margin","ed_5","ed_5_margin","ed_6","ed_6_margin","ed_7","ed_7_margin","ed_8","ed_8_margin","ed_9","ed_9_margin","ed_10","ed_10_margin","ed_11","ed_11_margin","ed_12","ed_12_margin","ed_hsdip","ed_hsdip_margin","ed_GED","ed_GED_margin","ed_<1_college","ed_<1_college_margin","ed_1+_college","ed_1+_college_margin","ed_associate","ed_associate_margin","ed_bachelor","ed_bachelor_margin","ed_master","ed_master_margin","ed_prof","ed_prof_marg","ed_doctor","ed_doctor_marg")

acs_education_variables_no_margins <- ACS_simplified_raw_data[c("GEOID","B15003e1","B15003e2","B15003e3","B15003e4","B15003e5","B15003e6","B15003e7","B15003e8","B15003e9","B15003e10","B15003e11","B15003e12","B15003e13","B15003e14","B15003e15","B15003e16","B15003e17","B15003e18","B15003e19","B15003e20","B15003e21","B15003e22","B15003e23","B15003e24","B15003e25")]
# View(acs_education_variables_no_margins)

#education_labels_no_margins <- c("tract_ID","ed_pop","ed_no_school","ed_nurse","ed_kinder","ed_1","ed_2","ed_3","ed_4","ed_5","ed_6","ed_7","ed_8","ed_9","ed_10","ed_11","ed_12","ed_hsdip","ed_GED","ed_<1_college","ed_1+_college","ed_associate","ed_bachelor","ed_master","ed_prof","ed_doctor")

#colnames(acs_education_variables_no_margins) <- education_labels_no_margins



#household value
acs_median_househ_value_no_marg <- ACS_raw_data[c("GEOID","B25077e1")]

#household income
acs_median_household_income_no_marg <- ACS_raw_data[c("GEOID","B19013e1")]

#poverty
acs_poverty <- ACS_raw_data[c("GEOID","B17001e1","B17001e2")]

#unemployment
acs_unemp_no_marg <- ACS_simplified_raw_data[c("GEOID","B23025e1","B23025e2","B23025e3","B23025e4","B23025e5","B23025e6","B23025e7")]


#make tract_ID back to GEOID
alldatawithRI$GEOID <- alldatawithRI$tract_ID
alldatawithRI$tract_ID

#figuring out why a variable is dropping -- because Richmond County Tract 228 has no population (?) in the 2012 5-year ACS estimates (GEOID 36085022800)
#airdataID <- as.data.frame(alldatawithRI$GEOID)
#colnames(airdataID) <- c("GEOID")
#acs_pop_no_margID <- as.data.frame(acs_pop_no_marg$GEOID)
#colnames(acs_pop_no_margID) <- c("GEOID")
#testingIDs <- merge(airdataID,acs_pop_no_margID,by="GEOID",all.x=TRUE)

#merge air and seg with acs
air_acs_seg_no_drops <- merge(alldatawithRI,acs_pop_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_education_variables_no_margins,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_househ_value_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_median_household_income_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_poverty,by="GEOID",all.x=TRUE)
air_acs_seg_no_drops <- merge(air_acs_seg_no_drops,acs_unemp_no_marg,by="GEOID",all.x=TRUE)
# View(air_acs_seg_no_drops)

save(air_acs_seg_no_drops,file="air_acs_seg_no_drops.rdata")






#add census
#censusdataforfinaljoin <- census_2010_DP1_raw
#censusdataforfinaljoin$GEOID <- censusdataforfinaljoin$GEOID10
#censusdataforfinaljoin$GEOID10 <- NULL


#censusdataforfinaljoin <- subset(censusdataforfinaljoin, select=-c(FID,ALAND10,AWATER10,Shape_Leng,Shape_Area))
#colnames(censusdataforfinaljoin)

#age from census
agefromcensus <- fullcensus[c("GEOID10","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")]

colnames(agefromcensus) <- c("GEOID","DP0010001","DP0010002","DP0010003","DP0010004","DP0010005","DP0010006","DP0010007","DP0010008","DP0010009","DP0010010","DP0010011","DP0010012","DP0010013","DP0010014","DP0010015","DP0010016","DP0010017","DP0010018","DP0010019")
# View(agefromcensus)

HispanicLatinofromCensus <- fullcensus[c("GEOID10","DP0100001","DP0100002")]
# View(HispanicLatinofromCensus)
colnames(HispanicLatinofromCensus) <- c("GEOID","DP0100001","DP0100002")

# View(air_acs_seg_no_drops)
air_acs_census_seg_no_drops <- merge(air_acs_seg_no_drops,agefromcensus,by="GEOID")


finaldatanodrops <- air_acs_census_seg_no_drops
save(finaldatanodrops,file = "finaldatanodrops.rdata")

finaldatanodrops <- merge(finaldatanodrops,HispanicLatinofromCensus,by="GEOID")





########making the variables I need

# Race: population self-identified as non-Hispanic white, non-Hispanic black or African American, non-Hispanic Asian, Hispanic, or other [SF1.P08 (Summary File 1, Table P8)]
# Educational attainment: persons geq 25 years of age with less than a high school degree or equivalent, high school degree or equivalent, or some college (SF3.P37)
# Poverty: persons in poverty using Census-defined poverty levels (SF3.P87)
# Unemployment: persons geq 16 years of age who were unemployed, employed, or not job seekers (SF3.P43)
# Age: 0-19, 20-64, or geq 65 years of age (SF1.P12)
# Earnings: average annual earnings of those geq 16 years of age with earnings (SF3.P84)
# Total population: (SF1.P08).
# 
# Bravo paper:
# primary and secondary RUCA # codes
# Race/ethnicity: population self-identified as NHB, NHW, Hispanic, or
# other
# Age: persons 0-19, 20-64, or geq65y of age
# Educational attainment: persons geq25ywith less than a high school degree
# or equivalent; high school degree/GED or some college; or college
# degree
# Poverty: percentage in poverty using census-defined poverty levels
# Unemployment: percentage geq 16y who are unemployed.





#% white -- 
finaldatanodrops$percent_white <- finaldatanodrops$DP0080003 / finaldatanodrops$DP0100001
finaldatanodrops$percent_white

#% of population with less than high school education
finaldatanodrops$percent_less_than_high_school <-  (finaldatanodrops$B15003e2+finaldatanodrops$B15003e3+finaldatanodrops$B15003e4+finaldatanodrops$B15003e5+finaldatanodrops$B15003e6+finaldatanodrops$B15003e7+finaldatanodrops$B15003e8+finaldatanodrops$B15003e9+finaldatanodrops$B15003e10+finaldatanodrops$B15003e11+finaldatanodrops$B15003e12+finaldatanodrops$B15003e13+finaldatanodrops$B15003e14+finaldatanodrops$B15003e15+finaldatanodrops$B15003e16)/ finaldatanodrops$B15003e1

finaldatanodrops$percent_less_than_high_school

#% in poverty
finaldatanodrops$percent_poverty <- finaldatanodrops$B17001e2 / finaldatanodrops$B17001e1

#% black
finaldatanodrops$percent_black <- finaldatanodrops$DP0110012 / finaldatanodrops$DP0100001

#% Hispanic
finaldatanodrops$percent_Hispanic <- finaldatanodrops$DP0100002/finaldatanodrops$DP0100001



simpleglmPM25 <- glm(finaldatanodrops$PM25_88101~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_Hispanic)
summary(simpleglmPM25)

plot(simpleglmPM25
     )



#make normal quantile plots
#check for linearity
par(mfrow=c(2,2))
qqnorm(finaldatanodrops$isolationindex,main="RI Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$isolationindex,lwd=2,col="red")
qqnorm(finaldatanodrops$PM25_88101,main="PM2.5 Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$PM25_88101,lwd=2,col="red")
qqnorm(finaldatanodrops$aluminum_88104,main="Aluminum Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$aluminum_88104,lwd=2,col="red")
qqnorm(finaldatanodrops$calcium_88111,main="Calcium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$calcium_88111,lwd=2,col="red")
qqnorm(finaldatanodrops$chlorine_88115,main="Chlorine Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$chlorine_88115,lwd=2,col="red")
qqnorm(finaldatanodrops$nickel_88136,main="Nickel Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$nickel_88136,lwd=2,col="red")
qqnorm(finaldatanodrops$titanium_88161,main="Titanium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$titanium_88161,lwd=2,col="red")
qqnorm(finaldatanodrops$vanadium_88164,main="Vanadium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$vanadium_88164,lwd=2,col="red")
qqnorm(finaldatanodrops$silicon_88165,main="Silicon Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$silicon_88165,lwd=2,col="red")
qqnorm(finaldatanodrops$zinc_88167,main="Zinc Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$zinc_88167,lwd=2,col="red")
qqnorm(finaldatanodrops$ammonium_88301,main="Ammonium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$ammonium_88301,lwd=2,col="red")
qqnorm(finaldatanodrops$nitrate_88306,main="Nitrate Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$nitrate_88306,lwd=2,col="red")
qqnorm(finaldatanodrops$sulfate_88403,main="Sulfate Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$sulfate_88403,lwd=2,col="red")
qqnorm(finaldatanodrops$EC,main="Elemental Carbon Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$EC,lwd=2,col="red")

#copy chlorine and nickel values for logging
finaldatanodrops$chlorine_no_zero_88115 <- finaldatanodrops$chlorine_88115
finaldatanodrops$nickel_no_zero_88136 <- finaldatanodrops$nickel_88136

#fix zeroes to below detection limits
finaldatanodrops$chlorine_no_zero_88115[finaldatanodrops$chlorine_no_zero_88115==0] <- 0.0000001
finaldatanodrops$nickel_no_zero_88136[finaldatanodrops$nickel_no_zero_88136==0] <- 0.000000001


#take logs of concentrations
finaldatanodrops$log_PM25_88101 <- log(finaldatanodrops$PM25_88101)
finaldatanodrops$log_aluminum_88104 <- log(finaldatanodrops$aluminum_88104)
finaldatanodrops$log_calcium_88111 <- log(finaldatanodrops$calcium_88111)
finaldatanodrops$log_chlorine_no_zero_88115 <- log(finaldatanodrops$chlorine_no_zero_88115)
finaldatanodrops$log_nickel_no_zero_88136 <- log(finaldatanodrops$nickel_no_zero_88136)
finaldatanodrops$log_titanium_88161 <- log(finaldatanodrops$titanium_88161)
finaldatanodrops$log_vanadium_88164 <- log(finaldatanodrops$vanadium_88164)
finaldatanodrops$log_silicon_88165 <- log(finaldatanodrops$silicon_88165)
finaldatanodrops$log_zinc_88167 <- log(finaldatanodrops$zinc_88167)
finaldatanodrops$log_ammonium_88301 <- log(finaldatanodrops$ammonium_88301)
finaldatanodrops$log_sodium_ion_88302 <- log(finaldatanodrops$sodium_ion_88302)
finaldatanodrops$log_nitrate_88306 <- log(finaldatanodrops$nitrate_88306)
finaldatanodrops$log_sulfate_88403 <- log(finaldatanodrops$sulfate_88403)
finaldatanodrops$log_EC <- log(finaldatanodrops$EC)
# View(finaldatanodrops)

#make normal quantile plots for the logs
#check for linearity
dev.off()
par(mfrow=c(2,2))
qqnorm(finaldatanodrops$log_PM25_88101,main="Log PM2.5 Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_PM25_88101,lwd=2,col="red")
qqnorm(finaldatanodrops$log_aluminum_88104,main="Log Aluminum Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_aluminum_88104,lwd=2,col="red")
qqnorm(finaldatanodrops$log_calcium_88111,main="Log Calcium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_calcium_88111,lwd=2,col="red")
qqnorm(finaldatanodrops$log_chlorine_no_zero_88115,main="Log Chlorine Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_chlorine_no_zero_88115,lwd=2,col="red")
qqnorm(finaldatanodrops$log_nickel_no_zero_88136,main="Log Nickel Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_nickel_no_zero_88136,lwd=2,col="red")
qqnorm(finaldatanodrops$log_titanium_88161,main="Log Titanium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_titanium_88161,lwd=2,col="red")
qqnorm(finaldatanodrops$log_vanadium_88164,main="Log Vanadium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_vanadium_88164,lwd=2,col="red")
qqnorm(finaldatanodrops$log_silicon_88165,main="Log Silicon Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_silicon_88165,lwd=2,col="red")
qqnorm(finaldatanodrops$log_zinc_88167,main="Log Zinc Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_zinc_88167,lwd=2,col="red")
qqnorm(finaldatanodrops$log_ammonium_88301,main="Log Ammonium Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_ammonium_88301,lwd=2,col="red")
qqnorm(finaldatanodrops$log_nitrate_88306,main="Log Nitrate Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_nitrate_88306,lwd=2,col="red")
qqnorm(finaldatanodrops$log_sulfate_88403,main="Log Sulfate Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_sulfate_88403,lwd=2,col="red")
qqnorm(finaldatanodrops$log_EC,main="Log Elemental Carbon Normal Quantile Plot",col="blue")
qqline(finaldatanodrops$log_EC,lwd=2,col="red")

#get rid of non-FRM
finaldatanodrops$PM_25_non_FRM_88502 <- NULL

##boxplots!
par(mfrow=c(1,1))

#boxplot untransformed components
boxplot(finaldatanodrops[2:14])

#boxplot transformed -- looks better
boxplot(finaldatanodrops[23:35])

save(finaldatanodrops, file="finaldatanodrops.rdata")

hist(finaldatanodrops$isolationindex)


#individual anovas not logs
#PM25
plot(PM25_88101 ~ RI_quantile, data=finaldatanodrops)

boxplot(PM25_88101 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

PM25_88101_levene <- leveneTest(finaldatanodrops$PM25_88101 ~ as.factor(finaldatanodrops$RI_quantile))
PM25_88101_levene

PM25_88101_anova <- aov(finaldatanodrops$PM25_88101 ~ as.factor(finaldatanodrops$RI_quantile))
summary(PM25_88101_anova)


PM25_88101_one <- oneway.test(finaldatanodrops$PM25_88101 ~ finaldatanodrops$RI_quantile)
PM25_88101_one
summary(PM25_88101_one)
TukeyHSD(PM25_88101_anova)

PM25_88101_aov_residuals <- residuals(object = PM25_88101_anova)
summary(PM25_88101_aov_residuals)
plot(PM25_88101_aov_residuals)


#aluminum
plot(aluminum_88104 ~ RI_quantile, data=finaldatanodrops)

boxplot(aluminum_88104 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

aluminum_88104_levene <- leveneTest(finaldatanodrops$aluminum_88104 ~ as.factor(finaldatanodrops$RI_quantile))
aluminum_88104_levene

aluminum_88104_anova <- aov(finaldatanodrops$aluminum_88104 ~ as.factor(finaldatanodrops$RI_quantile))
summary(aluminum_88104_anova)

aluminum_88104_one <- oneway.test(finaldatanodrops$aluminum_88104 ~ finaldatanodrops$RI_quantile)
TukeyHSD(aluminum_88104_anova)

aluminum_88104_aov_residuals <- residuals(object = aluminum_88104_anova)
summary(aluminum_88104_aov_residuals)
plot(aluminum_88104_aov_residuals)





#calcium
plot(calcium_88111 ~ RI_quantile, data=finaldatanodrops)

boxplot(calcium_88111 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

calcium_88111_levene <- leveneTest(finaldatanodrops$calcium_88111 ~ as.factor(finaldatanodrops$RI_quantile))
calcium_88111_levene

calcium_88111_anova <- aov(finaldatanodrops$calcium_88111 ~ as.factor(finaldatanodrops$RI_quantile)) 
summary(calcium_88111_anova)

calcium_88111_one <- oneway.test(finaldatanodrops$calcium_88111 ~ finaldatanodrops$RI_quantile)
TukeyHSD(calcium_88111_anova)

calcium_88111_aov_residuals <- residuals(object = calcium_88111_anova)
summary(calcium_88111_aov_residuals)
plot(calcium_88111_aov_residuals)




#chlorine
plot(chlorine_88115 ~ RI_quantile, data=finaldatanodrops)

boxplot(chlorine_88115 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

chlorine_88115_levene <- leveneTest(finaldatanodrops$chlorine_88115 ~ as.factor(finaldatanodrops$RI_quantile))
chlorine_88115_levene

chlorine_88115_anova <- aov(finaldatanodrops$chlorine_88115 ~ as.factor(finaldatanodrops$RI_quantile))
summary(chlorine_88115_anova)
TukeyHSD(chlorine_88115_anova)

chlorine_88115_one <- oneway.test(finaldatanodrops$chlorine_88115 ~ finaldatanodrops$RI_quantile)
TukeyHSD(chlorine_88115_anova)

chlorine_88115_aov_residuals <- residuals(object = chlorine_88115_anova)
summary(chlorine_88115_aov_residuals)
plot(chlorine_88115_aov_residuals)



#nickel
plot(nickel_88136 ~ RI_quantile, data=finaldatanodrops)

boxplot(nickel_88136 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

nickel_88136_levene <- leveneTest(finaldatanodrops$nickel_88136 ~ as.factor(finaldatanodrops$RI_quantile))
nickel_88136_levene

nickel_88136_anova <- aov(finaldatanodrops$nickel_88136 ~ as.factor(finaldatanodrops$RI_quantile))
summary(nickel_88136_anova)

nickel_88136_one <- oneway.test(finaldatanodrops$nickel_88136 ~ finaldatanodrops$RI_quantile)
summary(nickel_88136_one)
nickel_88136_one
TukeyHSD(nickel_88136_anova)

nickel_88136_aov_residuals <- residuals(object = nickel_88136_anova)
summary(nickel_88136_aov_residuals)
plot(nickel_88136_aov_residuals)



#titanium
plot(titanium_88161 ~ RI_quantile, data=finaldatanodrops)

boxplot(titanium_88161 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

titanium_88161_levene <- leveneTest(finaldatanodrops$titanium_88161 ~ as.factor(finaldatanodrops$RI_quantile))
titanium_88161_levene

titanium_88161_anova <- aov(finaldatanodrops$titanium_88161 ~ as.factor(finaldatanodrops$RI_quantile))
summary(titanium_88161_anova)

titanium_88161_one<-oneway.test(finaldatanodrops$titanium_88161 ~ finaldatanodrops$RI_quantile)
titanium_88161_one
TukeyHSD(titanium_88161_anova)

titanium_88161_aov_residuals <- residuals(object = titanium_88161_anova)
summary(titanium_88161_aov_residuals)
plot(titanium_88161_aov_residuals)


#vanadium
plot(vanadium_88164 ~ RI_quantile, data=finaldatanodrops)

boxplot(vanadium_88164 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

vanadium_88164_levene <- leveneTest(finaldatanodrops$vanadium_88164 ~ as.factor(finaldatanodrops$RI_quantile))
vanadium_88164_levene

vanadium_88164_anova <- aov(finaldatanodrops$vanadium_88164 ~ as.factor(finaldatanodrops$RI_quantile))
summary(vanadium_88164_anova)

vanadium_88164_one<-oneway.test(finaldatanodrops$vanadium_88164 ~ finaldatanodrops$RI_quantile)
vanadium_88164_one
TukeyHSD(vanadium_88164_anova)

vanadium_88164_aov_residuals <- residuals(object = vanadium_88164_anova)
summary(vanadium_88164_aov_residuals)
plot(vanadium_88164_aov_residuals)


#silicon
plot(silicon_88165 ~ RI_quantile, data=finaldatanodrops)

boxplot(silicon_88165 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

silicon_88165_levene <- leveneTest(finaldatanodrops$silicon_88165 ~ as.factor(finaldatanodrops$RI_quantile))
silicon_88165_levene

silicon_88165_anova <- aov(finaldatanodrops$silicon_88165 ~ as.factor(finaldatanodrops$RI_quantile))
summary(silicon_88165_anova)

silicon_88165_one<-oneway.test(finaldatanodrops$silicon_88165 ~ finaldatanodrops$RI_quantile)
silicon_88165_one
TukeyHSD(silicon_88165_anova)

silicon_88165_aov_residuals <- residuals(object = silicon_88165_anova)
summary(silicon_88165_aov_residuals)
plot(silicon_88165_aov_residuals)



#zinc
plot(zinc_88167 ~ RI_quantile, data=finaldatanodrops)

boxplot(zinc_88167 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

zinc_88167_levene <- leveneTest(finaldatanodrops$zinc_88167 ~ as.factor(finaldatanodrops$RI_quantile))
zinc_88167_levene

zinc_88167_anova <- aov(finaldatanodrops$zinc_88167 ~ as.factor(finaldatanodrops$RI_quantile))
summary(zinc_88167_anova)

zinc_88167_one<-oneway.test(finaldatanodrops$zinc_88167 ~ finaldatanodrops$RI_quantile)
zinc_88167_one
TukeyHSD(zinc_88167_anova)

zinc_88167_aov_residuals <- residuals(object = zinc_88167_anova)
summary(zinc_88167_aov_residuals)
plot(zinc_88167_aov_residuals)


#ammonium
plot(ammonium_88301 ~ RI_quantile, data=finaldatanodrops)

boxplot(ammonium_88301 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

ammonium_88301_levene <- leveneTest(finaldatanodrops$ammonium_88301 ~ as.factor(finaldatanodrops$RI_quantile))
ammonium_88301_levene

ammonium_88301_anova <- aov(finaldatanodrops$ammonium_88301 ~ as.factor(finaldatanodrops$RI_quantile))
summary(ammonium_88301_anova)

ammonium_88301_one<-oneway.test(finaldatanodrops$ammonium_88301 ~ finaldatanodrops$RI_quantile)
ammonium_88301_one
TukeyHSD(ammonium_88301_anova)

ammonium_88301_aov_residuals <- residuals(object = ammonium_88301_anova)
summary(ammonium_88301_aov_residuals)
plot(ammonium_88301_aov_residuals)




#sodium
plot(sodium_ion_88302 ~ RI_quantile, data=finaldatanodrops)

boxplot(sodium_ion_88302 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

sodium_ion_88302_levene <- leveneTest(finaldatanodrops$sodium_ion_88302 ~ as.factor(finaldatanodrops$RI_quantile))
sodium_ion_88302_levene

sodium_ion_88302_anova <- aov(finaldatanodrops$sodium_ion_88302 ~ as.factor(finaldatanodrops$RI_quantile))
summary(sodium_ion_88302_anova)

sodium_ion_88302_one<-oneway.test(finaldatanodrops$sodium_ion_88302 ~ finaldatanodrops$RI_quantile)
sodium_ion_88302_one
TukeyHSD(sodium_ion_88302_anova)

sodium_ion_88302_aov_residuals <- residuals(object = sodium_ion_88302_anova)
summary(sodium_ion_88302_aov_residuals)
plot(sodium_ion_88302_aov_residuals)



#nitrate
plot(nitrate_88306 ~ RI_quantile, data=finaldatanodrops)

boxplot(nitrate_88306 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

nitrate_88306_levene <- leveneTest(finaldatanodrops$nitrate_88306 ~ as.factor(finaldatanodrops$RI_quantile))
nitrate_88306_levene

nitrate_88306_anova <- aov(finaldatanodrops$nitrate_88306 ~ as.factor(finaldatanodrops$RI_quantile))
summary(nitrate_88306_anova)

nitrate_88306_one<-oneway.test(finaldatanodrops$nitrate_88306 ~ finaldatanodrops$RI_quantile)
nitrate_88306_one
TukeyHSD(nitrate_88306_anova)

nitrate_88306_aov_residuals <- residuals(object = nitrate_88306_anova)
summary(nitrate_88306_aov_residuals)
plot(nitrate_88306_aov_residuals)




#sulfate
plot(sulfate_88403 ~ RI_quantile, data=finaldatanodrops)

boxplot(sulfate_88403 ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

sulfate_88403_levene <- leveneTest(finaldatanodrops$sulfate_88403 ~ as.factor(finaldatanodrops$RI_quantile))
sulfate_88403_levene

sulfate_88403_anova <- aov(finaldatanodrops$sulfate_88403 ~ as.factor(finaldatanodrops$RI_quantile))
summary(sulfate_88403_anova)

sulfate_88403_one<-oneway.test(finaldatanodrops$sulfate_88403 ~ finaldatanodrops$RI_quantile)
sulfate_88403_one
TukeyHSD(sulfate_88403_anova)

sulfate_88403_aov_residuals <- residuals(object = sulfate_88403_anova)
summary(sulfate_88403_aov_residuals)
plot(sulfate_88403_aov_residuals)



#EC
plot(EC ~ RI_quantile, data=finaldatanodrops)

boxplot(EC ~ RI_quantile, data=finaldatanodrops,
        xlab = "Treatment", ylab = "Weight",
        frame = FALSE, col = c("#00AFBB", "#E7B800", "#FC4E07"))

EC_levene <- leveneTest(finaldatanodrops$EC ~ as.factor(finaldatanodrops$RI_quantile))
EC_levene

EC_anova <- aov(finaldatanodrops$EC ~ as.factor(finaldatanodrops$RI_quantile))
summary(EC_anova)

EC_one<-oneway.test(finaldatanodrops$EC ~ finaldatanodrops$RI_quantile)
EC_one
TukeyHSD(EC_anova)

EC_aov_residuals <- residuals(object = EC_anova)
summary(EC_aov_residuals)
plot(EC_aov_residuals)








#trying a very simple GLM
simpleglm=glm(as.matrix(finaldatanodrops$log_aluminum_88104,finaldatanodrops$log_ammonium_88301,finaldatanodrops$log_calcium_88111,finaldatanodrops$log_chlorine_no_zero_88115,finaldatanodrops$log_EC,finaldatanodrops$log_nickel_no_zero_88136,finaldatanodrops$log_nitrate_88306,finaldatanodrops$log_PM25_88101,finaldatanodrops$log_silicon_88165,finaldatanodrops$log_sodium_ion_88302,finaldatanodrops$log_sulfate_88403,finaldatanodrops$log_titanium_88161,finaldatanodrops$log_vanadium_88164,finaldatanodrops$log_zinc_88167)~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)

summary(simpleglm)
coef(simpleglm)

simpleglmlogPM25<-glm(finaldatanodrops$log_PM25_88101~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlogPM25)

simpleglmlogaluminum<-glm(finaldatanodrops$log_aluminum_88104~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlogaluminum)

simpleglmlog_ammonium_88301<-glm(finaldatanodrops$log_ammonium_88301~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_ammonium_88301)

simpleglmlog_calcium_88111<-glm(finaldatanodrops$log_calcium_88111~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_calcium_88111)

simpleglmlog_chlorine_no_zero_88115<-glm(finaldatanodrops$log_chlorine_no_zero_88115~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_chlorine_no_zero_88115)

simpleglmlog_EC<-glm(finaldatanodrops$log_EC~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_EC)

simpleglmlog_nickel_no_zero_88136<-glm(finaldatanodrops$log_nickel_no_zero_88136~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_nickel_no_zero_88136)

simpleglmlog_nitrate_88306<-glm(finaldatanodrops$log_nitrate_88306~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_nitrate_88306)

simpleglmlog_silicon_88165<-glm(finaldatanodrops$log_silicon_88165~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_silicon_88165)

simpleglmlogsodium<-glm(finaldatanodrops$log_sodium_ion_88302~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlogaluminum)

simpleglmlog_sulfate_88403<-glm(finaldatanodrops$log_sulfate_88403~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_sulfate_88403)

simpleglmlog_titanium_88161<-glm(finaldatanodrops$log_titanium_88161~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_titanium_88161)

simpleglmlog_vanadium_88164<-glm(finaldatanodrops$log_vanadium_88164~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_vanadium_88164)

simpleglmlog_zinc_88167<-glm(finaldatanodrops$log_zinc_88167~finaldatanodrops$RI_quantile+finaldatanodrops$percent_less_than_high_school+finaldatanodrops$percent_poverty+finaldatanodrops$percent_white+finaldatanodrops$percent_black)
summary(simpleglmlog_zinc_88167)


#quantile that stuff
PM25_88101_by_quantile<-aggregate(finaldatanodrops$PM25_88101 ~ finaldatanodrops$RI_quantile, FUN="mean")
aluminum_88104_by_quantile<-aggregate(finaldatanodrops$aluminum_88104 ~ finaldatanodrops$RI_quantile, FUN="mean")
calcium_88111_by_quantile<-aggregate(finaldatanodrops$calcium_88111 ~ finaldatanodrops$RI_quantile, FUN="mean")
chlorine_88115_by_quantile<-aggregate(finaldatanodrops$chlorine_88115 ~ finaldatanodrops$RI_quantile, FUN="mean")
nickel_88136_by_quantile<-aggregate(finaldatanodrops$nickel_88136 ~ finaldatanodrops$RI_quantile, FUN="mean")
titanium_88161_by_quantile<-aggregate(finaldatanodrops$titanium_88161 ~ finaldatanodrops$RI_quantile, FUN="mean")
vanadium_88164_by_quantile<-aggregate(finaldatanodrops$vanadium_88164 ~ finaldatanodrops$RI_quantile, FUN="mean")
silicon_88165_by_quantile<-aggregate(finaldatanodrops$silicon_88165 ~ finaldatanodrops$RI_quantile, FUN="mean")
zinc_88167_by_quantile<-aggregate(finaldatanodrops$zinc_88167 ~ finaldatanodrops$RI_quantile, FUN="mean")
ammonium_88301_by_quantile<-aggregate(finaldatanodrops$ammonium_88301 ~ finaldatanodrops$RI_quantile, FUN="mean")
sodium_ion_88302_by_quantile<-aggregate(finaldatanodrops$sodium_ion_88302 ~ finaldatanodrops$RI_quantile, FUN="mean")
nitrate_88306_by_quantile<-aggregate(finaldatanodrops$nitrate_88306 ~ finaldatanodrops$RI_quantile, FUN="mean")
sulfate_88403_by_quantile<-aggregate(finaldatanodrops$sulfate_88403 ~ finaldatanodrops$RI_quantile, FUN="mean")
EC_by_quantile<-aggregate(finaldatanodrops$EC ~ finaldatanodrops$RI_quantile, FUN="mean")

#standard deviate that stuff
PM25_88101_by_quantile_sd<-aggregate(finaldatanodrops$PM25_88101 ~ finaldatanodrops$RI_quantile, FUN="sd")
aluminum_88104_by_quantile_sd<-aggregate(finaldatanodrops$aluminum_88104 ~ finaldatanodrops$RI_quantile, FUN="sd")
calcium_88111_by_quantile_sd<-aggregate(finaldatanodrops$calcium_88111 ~ finaldatanodrops$RI_quantile, FUN="sd")
chlorine_88115_by_quantile_sd<-aggregate(finaldatanodrops$chlorine_88115 ~ finaldatanodrops$RI_quantile, FUN="sd")
nickel_88136_by_quantile_sd<-aggregate(finaldatanodrops$nickel_88136 ~ finaldatanodrops$RI_quantile, FUN="sd")
titanium_88161_by_quantile_sd<-aggregate(finaldatanodrops$titanium_88161 ~ finaldatanodrops$RI_quantile, FUN="sd")
vanadium_88164_by_quantile_sd<-aggregate(finaldatanodrops$vanadium_88164 ~ finaldatanodrops$RI_quantile, FUN="sd")
silicon_88165_by_quantile_sd<-aggregate(finaldatanodrops$silicon_88165 ~ finaldatanodrops$RI_quantile, FUN="sd")
zinc_88167_by_quantile_sd<-aggregate(finaldatanodrops$zinc_88167 ~ finaldatanodrops$RI_quantile, FUN="sd")
ammonium_88301_by_quantile_sd<-aggregate(finaldatanodrops$ammonium_88301 ~ finaldatanodrops$RI_quantile, FUN="sd")
sodium_ion_88302_by_quantile_sd<-aggregate(finaldatanodrops$sodium_ion_88302 ~ finaldatanodrops$RI_quantile, FUN="sd")
nitrate_88306_by_quantile_sd<-aggregate(finaldatanodrops$nitrate_88306 ~ finaldatanodrops$RI_quantile, FUN="sd")
sulfate_88403_by_quantile_sd<-aggregate(finaldatanodrops$sulfate_88403 ~ finaldatanodrops$RI_quantile, FUN="sd")
EC_by_quantile_sd<-aggregate(finaldatanodrops$EC ~ finaldatanodrops$RI_quantile, FUN="sd")

write.csv(PM25_88101_by_quantile,file="PM25_88101_by_quantile.csv")
PM25_88101_by_quantile_sd
write.csv(aluminum_88104_by_quantile,file="aluminum_88104_by_quantile.csv")
aluminum_88104_by_quantile_sd
write.csv(calcium_88111_by_quantile,file="calcium_88111_by_quantile.csv")
calcium_88111_by_quantile_sd
write.csv(chlorine_88115_by_quantile,file="chlorine_88115_by_quantile.csv")
chlorine_88115_by_quantile_sd
write.csv(nickel_88136_by_quantile,file="nickel_88136_by_quantile.csv")
nickel_88136_by_quantile_sd
write.csv(titanium_88161_by_quantile,file="titanium_88161_by_quantile.csv")
titanium_88161_by_quantile_sd
write.csv(vanadium_88164_by_quantile,file="vanadium_88164_by_quantile.csv")
vanadium_88164_by_quantile_sd
write.csv(silicon_88165_by_quantile,file="silicon_88165_by_quantile.csv")
silicon_88165_by_quantile_sd
write.csv(zinc_88167_by_quantile,file="zinc_88167_by_quantile.csv")
zinc_88167_by_quantile_sd
write.csv(ammonium_88301_by_quantile,file="ammonium_88301_by_quantile.csv")
ammonium_88301_by_quantile_sd
write.csv(sodium_ion_88302_by_quantile,file="sodium_ion_88302_by_quantile.csv")
sodium_ion_88302_by_quantile_sd
write.csv(nitrate_88306_by_quantile,file="nitrate_88306_by_quantile.csv")
nitrate_88306_by_quantile_sd
write.csv(sulfate_88403_by_quantile,file="sulfate_88403_by_quantile.csv")
sulfate_88403_by_quantile_sd
write.csv(EC_by_quantile,file="EC_by_quantile.csv")
EC_by_quantile_sd

alltogether<-merge(PM25_88101_by_quantile,aluminum_88104_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,calcium_88111_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,chlorine_88115_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,EC_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,nickel_88136_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,titanium_88161_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,silicon_88165_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,vanadium_88164_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,zinc_88167_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,sodium_ion_88302_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,ammonium_88301_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,nitrate_88306_by_quantile,by="finaldatanodrops$RI_quantile")
alltogether<-merge(alltogether,sulfate_88403_by_quantile,by="finaldatanodrops$RI_quantile")

write.csv(alltogether,file="alltogether.csv")

table(finaldatanodrops$tract_ID)



################
#######THREE same for eliminating less than 3 years

#split RI into quantiles
threeyearspluswithRI <- within(threeyearspluswithRI, RI_quantile <- as.integer(cut(isolationindex, quantile(isolationindex, probs=0:5/5)), include.lowest=TRUE))
# View(threeyearspluswithRI)

#joinracedatatofinaldatanodrops
threeyearspluswithRI<-merge(threeyearspluswithRI,censusfullracedata,by="tract_ID")


#make tract_ID back to GEOID
threeyearspluswithRI$GEOID<-threeyearspluswithRI$tract_ID
threeyearspluswithRI$tract_ID

#merge air and seg with acs
air_acs_seg_three_drop<-merge(threeyearspluswithRI,acs_pop_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_three_drop<-merge(air_acs_seg_three_drop,acs_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_three_drop<-merge(air_acs_seg_three_drop,acs_median_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_three_drop<-merge(air_acs_seg_three_drop,acs_education_variables_no_margins,by="GEOID",all.x=TRUE)
air_acs_seg_three_drop<-merge(air_acs_seg_three_drop,acs_median_househ_value_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_three_drop<-merge(air_acs_seg_three_drop,acs_median_household_income_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_three_drop<-merge(air_acs_seg_three_drop,acs_poverty,by="GEOID",all.x=TRUE)
air_acs_seg_three_drop<-merge(air_acs_seg_three_drop,acs_unemp_no_marg,by="GEOID",all.x=TRUE)
# View(air_acs_seg_three_drop)

save(air_acs_seg_three_drop,file="air_acs_seg_three_drop.rdata")

#add census data
air_acs_census_seg_three_drop<-merge(air_acs_seg_three_drop,agefromcensus,by="GEOID")

finaldatathree_drop<-air_acs_census_seg_three_drop
save(finaldatathree_drop,file = "finaldatathree_drop.rdata")


#make composite variables
#% white -- 
finaldatathree_drop$percent_white <- finaldatathree_drop$DP0080003 / finaldatathree_drop$DP0100001
finaldatathree_drop$percent_white

#% of population with less than high school education
finaldatathree_drop$percent_less_than_high_school<- (finaldatathree_drop$B15003e2+finaldatathree_drop$B15003e3+finaldatathree_drop$B15003e4+finaldatathree_drop$B15003e5+finaldatathree_drop$B15003e6+finaldatathree_drop$B15003e7+finaldatathree_drop$B15003e8+finaldatathree_drop$B15003e9+finaldatathree_drop$B15003e10+finaldatathree_drop$B15003e11+finaldatathree_drop$B15003e12+finaldatathree_drop$B15003e13+finaldatathree_drop$B15003e14+finaldatathree_drop$B15003e15+finaldatathree_drop$B15003e16)/ finaldatathree_drop$B15003e1

finaldatathree_drop$percent_less_than_high_school

#% in poverty
finaldatathree_drop$percent_poverty<-finaldatathree_drop$B17001e2 / finaldatathree_drop$B17001e1

#% black
finaldatathree_drop$percent_black <- finaldatathree_drop$DP0110012 / finaldatathree_drop$DP0100001

#% Hispanic/Latinx



################STATS!

#make normal quantile plots
#check for linearity
par(mfrow=c(2,2))
qqnorm(finaldatathree_drop$isolationindex,main="RI Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$isolationindex,lwd=2,col="red")
qqnorm(finaldatathree_drop$PM25_88101,main="PM2.5 Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$PM25_88101,lwd=2,col="red")
qqnorm(finaldatathree_drop$aluminum_88104,main="Aluminum Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$aluminum_88104,lwd=2,col="red")
qqnorm(finaldatathree_drop$calcium_88111,main="Calcium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$calcium_88111,lwd=2,col="red")
qqnorm(finaldatathree_drop$chlorine_88115,main="Chlorine Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$chlorine_88115,lwd=2,col="red")
qqnorm(finaldatathree_drop$nickel_88136,main="Nickel Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$nickel_88136,lwd=2,col="red")
qqnorm(finaldatathree_drop$titanium_88161,main="Titanium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$titanium_88161,lwd=2,col="red")
qqnorm(finaldatathree_drop$vanadium_88164,main="Vanadium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$vanadium_88164,lwd=2,col="red")
qqnorm(finaldatathree_drop$silicon_88165,main="Silicon Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$silicon_88165,lwd=2,col="red")
qqnorm(finaldatathree_drop$zinc_88167,main="Zinc Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$zinc_88167,lwd=2,col="red")
qqnorm(finaldatathree_drop$ammonium_88301,main="Ammonium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$ammonium_88301,lwd=2,col="red")
qqnorm(finaldatathree_drop$nitrate_88306,main="Nitrate Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$nitrate_88306,lwd=2,col="red")
qqnorm(finaldatathree_drop$sulfate_88403,main="Sulfate Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$sulfate_88403,lwd=2,col="red")
qqnorm(finaldatathree_drop$EC,main="Elemental Carbon Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$EC,lwd=2,col="red")

#copy chlorine and nickel values for logging
finaldatathree_drop$chlorine_no_zero_88115 <- finaldatathree_drop$chlorine_88115
finaldatathree_drop$nickel_no_zero_88136 <- finaldatathree_drop$nickel_88136

#fix zeroes to below detection limits
finaldatathree_drop$chlorine_no_zero_88115[finaldatathree_drop$chlorine_no_zero_88115==0] <- 0.0000001
finaldatathree_drop$nickel_no_zero_88136[finaldatathree_drop$nickel_no_zero_88136==0] <- 0.000000001


#take logs of concentrations
finaldatathree_drop$log_PM25_88101 <- log(finaldatathree_drop$PM25_88101)
finaldatathree_drop$log_aluminum_88104 <- log(finaldatathree_drop$aluminum_88104)
finaldatathree_drop$log_calcium_88111 <- log(finaldatathree_drop$calcium_88111)
finaldatathree_drop$log_chlorine_no_zero_88115 <- log(finaldatathree_drop$chlorine_no_zero_88115)
finaldatathree_drop$log_nickel_no_zero_88136 <- log(finaldatathree_drop$nickel_no_zero_88136)
finaldatathree_drop$log_titanium_88161 <- log(finaldatathree_drop$titanium_88161)
finaldatathree_drop$log_vanadium_88164 <- log(finaldatathree_drop$vanadium_88164)
finaldatathree_drop$log_silicon_88165 <- log(finaldatathree_drop$silicon_88165)
finaldatathree_drop$log_zinc_88167 <- log(finaldatathree_drop$zinc_88167)
finaldatathree_drop$log_ammonium_88301 <- log(finaldatathree_drop$ammonium_88301)
finaldatathree_drop$log_nitrate_88306 <- log(finaldatathree_drop$nitrate_88306)
finaldatathree_drop$log_sulfate_88403 <- log(finaldatathree_drop$sulfate_88403)
finaldatathree_drop$log_EC <- log(finaldatathree_drop$EC)
# View(finaldatathree_drop)

#make normal quantile plots for the logs
#check for linearity
dev.off()
par(mfrow=c(2,2))
qqnorm(finaldatathree_drop$log_PM25_88101,main="Log PM2.5 Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_PM25_88101,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_aluminum_88104,main="Log Aluminum Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_aluminum_88104,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_calcium_88111,main="Log Calcium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_calcium_88111,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_chlorine_no_zero_88115,main="Log Chlorine Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_chlorine_no_zero_88115,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_nickel_no_zero_88136,main="Log Nickel Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_nickel_no_zero_88136,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_titanium_88161,main="Log Titanium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_titanium_88161,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_vanadium_88164,main="Log Vanadium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_vanadium_88164,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_silicon_88165,main="Log Silicon Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_silicon_88165,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_zinc_88167,main="Log Zinc Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_zinc_88167,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_ammonium_88301,main="Log Ammonium Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_ammonium_88301,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_nitrate_88306,main="Log Nitrate Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_nitrate_88306,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_sulfate_88403,main="Log Sulfate Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_sulfate_88403,lwd=2,col="red")
qqnorm(finaldatathree_drop$log_EC,main="Log Elemental Carbon Normal Quantile Plot",col="blue")
qqline(finaldatathree_drop$log_EC,lwd=2,col="red")

#get rid of non-FRM
finaldatathree_drop$PM_25_non_FRM_88502 <- NULL

##boxplots!
par(mfrow=c(1,1))

#boxplot untransformed components
boxplot(finaldatathree_drop[2:14])

#boxplot transformed -- looks better
boxplot(finaldatathree_drop[23:35])






#individual anovas not logs
PM25_anova_three <- aov(finaldatathree_drop$PM25_88101 ~ finaldatathree_drop$RI_quantile)
summary(PM25_anova_three)
plot(PM25_88101 ~ RI_quantile, data=finaldatathree_drop)

aluminum_88104_anova_three <- aov(finaldatathree_drop$aluminum_88104 ~ finaldatathree_drop$RI_quantile)
summary(aluminum_88104_anova_three)
plot(aluminum_88104 ~ RI_quantile, data=finaldatathree_drop)

calcium_88111_anova_three <- aov(finaldatathree_drop$calcium_88111 ~ finaldatathree_drop$RI_quantile)
summary(calcium_88111_anova_three)
plot(calcium_88111 ~ RI_quantile, data=finaldatathree_drop)

chlorine_88115_anova_three <- aov(finaldatathree_drop$chlorine_88115 ~ finaldatathree_drop$RI_quantile)
summary(chlorine_88115_anova_three)
plot(chlorine_88115 ~ RI_quantile, data=finaldatathree_drop)

nickel_88136_anova_three <- aov(finaldatathree_drop$nickel_88136 ~ finaldatathree_drop$RI_quantile)
summary(nickel_88136_anova_three)
plot(nickel_88136 ~ RI_quantile, data=finaldatathree_drop)

titanium_88161_anova_three <- aov(finaldatathree_drop$titanium_88161 ~ finaldatathree_drop$RI_quantile)
summary(titanium_88161_anova_three)
plot(titanium_88161 ~ RI_quantile, data=finaldatathree_drop)

vanadium_88164_anova_three <- aov(finaldatathree_drop$vanadium_88164 ~ finaldatathree_drop$RI_quantile)
summary(vanadium_88164_anova_three)
plot(vanadium_88164 ~ RI_quantile, data=finaldatathree_drop)

silicon_88165_anova_three <- aov(finaldatathree_drop$silicon_88165 ~ finaldatathree_drop$RI_quantile)
summary(silicon_88165_anova_three)
plot(silicon_88165 ~ RI_quantile, data=finaldatathree_drop)

zinc_88167_anova_three <- aov(finaldatathree_drop$zinc_88167 ~ finaldatathree_drop$RI_quantile)
summary(zinc_88167_anova_three)
plot(zinc_88167 ~ RI_quantile, data=finaldatathree_drop)

ammonium_88301_anova_three <- aov(finaldatathree_drop$ammonium_88301 ~ finaldatathree_drop$RI_quantile)
summary(ammonium_88301_anova_three)
plot(ammonium_88301 ~ RI_quantile, data=finaldatathree_drop)

nitrate_88306_anova_three <- aov(finaldatathree_drop$nitrate_88306 ~ finaldatathree_drop$RI_quantile)
summary(nitrate_88306_anova_three)
plot(nitrate_88306 ~ RI_quantile, data=finaldatathree_drop)

sulfate_88403_anova_three <- aov(finaldatathree_drop$sulfate_88403 ~ finaldatathree_drop$RI_quantile)
summary(sulfate_88403_anova_three)
plot(sulfate_88403 ~ RI_quantile, data=finaldatathree_drop)

EC_anova_three <- aov(finaldatathree_drop$EC ~ finaldatathree_drop$RI_quantile)
summary(EC_anova_three)
plot(EC ~ RI_quantile, data=finaldatathree_drop)





#trying a very simple GLM
simpleglm_three=glm(as.matrix(finaldatathree_drop$log_aluminum_88104,finaldatathree_drop$log_ammonium_88301,finaldatathree_drop$log_calcium_88111,finaldatathree_drop$log_chlorine_no_zero_88115,finaldatathree_drop$log_EC,finaldatathree_drop$log_nickel_no_zero_88136,finaldatathree_drop$log_nitrate_88306,finaldatathree_drop$log_PM25_88101,finaldatathree_drop$log_silicon_88165,finaldatathree_drop$log_sulfate_88403,finaldatathree_drop$log_titanium_88161,finaldatathree_drop$log_vanadium_88164,finaldatathree_drop$log_zinc_88167)~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)

summary(simpleglm_three)
coef(simpleglm_three)

simpleglm_threelogPM25 <- glm(finaldatathree_drop$log_PM25_88101~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelogPM25)

simpleglm_threelogaluminum <- glm(finaldatathree_drop$log_aluminum_88104~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelogaluminum)

simpleglm_threelog_ammonium_88301 <- glm(finaldatathree_drop$log_ammonium_88301~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_ammonium_88301)

simpleglm_threelog_calcium_88111 <- glm(finaldatathree_drop$log_calcium_88111~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_calcium_88111)

simpleglm_threelog_chlorine_no_zero_88115 <- glm(finaldatathree_drop$log_chlorine_no_zero_88115~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_chlorine_no_zero_88115)

simpleglm_threelog_EC <- glm(finaldatathree_drop$log_EC~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_EC)

simpleglm_threelog_nickel_no_zero_88136 <- glm(finaldatathree_drop$log_nickel_no_zero_88136~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_nickel_no_zero_88136)

simpleglm_threelog_nitrate_88306 <- glm(finaldatathree_drop$log_nitrate_88306~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_nitrate_88306)

simpleglm_threelog_silicon_88165 <- glm(finaldatathree_drop$log_silicon_88165~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_silicon_88165)

simpleglm_threelog_sulfate_88403 <- glm(finaldatathree_drop$log_sulfate_88403~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_sulfate_88403)

simpleglm_threelog_titanium_88161 <- glm(finaldatathree_drop$log_titanium_88161~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_titanium_88161)

simpleglm_threelog_vanadium_88164 <- glm(finaldatathree_drop$log_vanadium_88164~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_vanadium_88164)

simpleglm_threelog_zinc_88167 <- glm(finaldatathree_drop$log_zinc_88167~finaldatathree_drop$RI_quantile+finaldatathree_drop$percent_less_than_high_school+finaldatathree_drop$percent_poverty+finaldatathree_drop$percent_white+finaldatathree_drop$percent_black)
summary(simpleglm_threelog_zinc_88167)

colnames(finaldatanodrops[2:14])

#quantile that stuff
PM25_88101_by_quantile_three <- aggregate(finaldatathree_drop$PM25_88101 ~ finaldatathree_drop$RI_quantile, FUN="mean") # GET STD
aluminum_88104_by_quantile_three <- aggregate(finaldatathree_drop$aluminum_88104 ~ finaldatathree_drop$RI_quantile, FUN="mean")
calcium_88111_by_quantile_three <- aggregate(finaldatathree_drop$calcium_88111 ~ finaldatathree_drop$RI_quantile, FUN="mean")
chlorine_88115_by_quantile_three <- aggregate(finaldatathree_drop$chlorine_88115 ~ finaldatathree_drop$RI_quantile, FUN="mean")
nickel_88136_by_quantile_three <- aggregate(finaldatathree_drop$nickel_88136 ~ finaldatathree_drop$RI_quantile, FUN="mean")
titanium_88161_by_quantile_three <- aggregate(finaldatathree_drop$titanium_88161 ~ finaldatathree_drop$RI_quantile, FUN="mean")
vanadium_88164_by_quantile_three <- aggregate(finaldatathree_drop$vanadium_88164 ~ finaldatathree_drop$RI_quantile, FUN="mean")
silicon_88165_by_quantile_three <- aggregate(finaldatathree_drop$silicon_88165 ~ finaldatathree_drop$RI_quantile, FUN="mean")
zinc_88167_by_quantile_three <- aggregate(finaldatathree_drop$zinc_88167 ~ finaldatathree_drop$RI_quantile, FUN="mean")
ammonium_88301_by_quantile_three <- aggregate(finaldatathree_drop$ammonium_88301 ~ finaldatathree_drop$RI_quantile, FUN="mean")
nitrate_88306_by_quantile_three <- aggregate(finaldatathree_drop$nitrate_88306 ~ finaldatathree_drop$RI_quantile, FUN="mean")
sulfate_88403_by_quantile_three <- aggregate(finaldatathree_drop$sulfate_88403 ~ finaldatathree_drop$RI_quantile, FUN="mean")
EC_by_quantile_three <- aggregate(finaldatathree_drop$EC ~ finaldatathree_drop$RI_quantile, FUN="mean")


#standard deviate that stuff
PM25_88101_by_quantile_three_sd <- aggregate(finaldatathree_drop$PM25_88101 ~ finaldatathree_drop$RI_quantile, FUN="sd")
aluminum_88104_by_quantile_three_sd <- aggregate(finaldatathree_drop$aluminum_88104 ~ finaldatathree_drop$RI_quantile, FUN="sd")
calcium_88111_by_quantile_three_sd <- aggregate(finaldatathree_drop$calcium_88111 ~ finaldatathree_drop$RI_quantile, FUN="sd")
chlorine_88115_by_quantile_three_sd <- aggregate(finaldatathree_drop$chlorine_88115 ~ finaldatathree_drop$RI_quantile, FUN="sd")
nickel_88136_by_quantile_three_sd <- aggregate(finaldatathree_drop$nickel_88136 ~ finaldatathree_drop$RI_quantile, FUN="sd")
titanium_88161_by_quantile_three_sd <- aggregate(finaldatathree_drop$titanium_88161 ~ finaldatathree_drop$RI_quantile, FUN="sd")
vanadium_88164_by_quantile_three_sd <- aggregate(finaldatathree_drop$vanadium_88164 ~ finaldatathree_drop$RI_quantile, FUN="sd")
silicon_88165_by_quantile_three_sd <- aggregate(finaldatathree_drop$silicon_88165 ~ finaldatathree_drop$RI_quantile, FUN="sd")
zinc_88167_by_quantile_three_sd <- aggregate(finaldatathree_drop$zinc_88167 ~ finaldatathree_drop$RI_quantile, FUN="sd")
ammonium_88301_by_quantile_three_sd <- aggregate(finaldatathree_drop$ammonium_88301 ~ finaldatathree_drop$RI_quantile, FUN="sd")
nitrate_88306_by_quantile_three_sd <- aggregate(finaldatathree_drop$nitrate_88306 ~ finaldatathree_drop$RI_quantile, FUN="sd")
sulfate_88403_by_quantile_three_sd <- aggregate(finaldatathree_drop$sulfate_88403 ~ finaldatathree_drop$RI_quantile, FUN="sd")
EC_by_quantile_three_sd <- aggregate(finaldatathree_drop$EC ~ finaldatathree_drop$RI_quantile, FUN="sd")


PM25_88101_by_quantile_three
aluminum_88104_by_quantile_three
calcium_88111_by_quantile_three
chlorine_88115_by_quantile_three
nickel_88136_by_quantile_three
titanium_88161_by_quantile_three
vanadium_88164_by_quantile_three
silicon_88165_by_quantile_three
zinc_88167_by_quantile_three
ammonium_88301_by_quantile_three
nitrate_88306_by_quantile_three
sulfate_88403_by_quantile_three
EC_by_quantile_three

PM25_88101_by_quantile_three_sd
aluminum_88104_by_quantile_three_sd
calcium_88111_by_quantile_three_sd
chlorine_88115_by_quantile_three_sd
nickel_88136_by_quantile_three_sd
titanium_88161_by_quantile_three_sd
vanadium_88164_by_quantile_three_sd
silicon_88165_by_quantile_three_sd
zinc_88167_by_quantile_three_sd
ammonium_88301_by_quantile_three_sd
nitrate_88306_by_quantile_three_sd
sulfate_88403_by_quantile_three_sd
EC_by_quantile_three_sd





#################
#######FIVE YEAR DATA


#same for eliminating less than 5 years
#split RI into quantiles
fiveyearspluswithRI <- within(fiveyearspluswithRI, RI_quantile <- as.integer(cut(isolationindex, quantile(isolationindex, probs=0:5/5)), include.lowest=TRUE))
# View(fiveyearspluswithRI)

#joinracedatatofiveyearspluswithRI
fiveyearspluswithRI <- merge(fiveyearspluswithRI,censusfullracedata,by="tract_ID")


#make tract_ID back to GEOID
fiveyearspluswithRI$GEOID <- fiveyearspluswithRI$tract_ID
fiveyearspluswithRI$tract_ID

#merge air and seg with acs
air_acs_seg_five_drop <- merge(fiveyearspluswithRI,acs_pop_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_five_drop <- merge(air_acs_seg_five_drop,acs_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_five_drop <- merge(air_acs_seg_five_drop,acs_median_earnings_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_five_drop <- merge(air_acs_seg_five_drop,acs_education_variables_no_margins,by="GEOID",all.x=TRUE)
air_acs_seg_five_drop <- merge(air_acs_seg_five_drop,acs_median_househ_value_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_five_drop <- merge(air_acs_seg_five_drop,acs_median_household_income_no_marg,by="GEOID",all.x=TRUE)
air_acs_seg_five_drop <- merge(air_acs_seg_five_drop,acs_poverty,by="GEOID",all.x=TRUE)
air_acs_seg_five_drop <- merge(air_acs_seg_five_drop,acs_unemp_no_marg,by="GEOID",all.x=TRUE)
# View(air_acs_seg_five_drop)

save(air_acs_seg_five_drop,file="air_acs_seg_five_drop.rdata")

#add census data
air_acs_census_seg_five_drop <- merge(air_acs_seg_five_drop,agefromcensus,by="GEOID")

finaldatafive_drop <- air_acs_census_seg_five_drop
save(finaldatafive_drop,file = "finaldatafive_drop.rdata")


#make composite variables
#% white -- 
finaldatafive_drop$percent_white <- finaldatafive_drop$DP0080003 / finaldatafive_drop$DP0100001
finaldatafive_drop$percent_white

#% of population with less than high school education
finaldatafive_drop$percent_less_than_high_school <-  (finaldatafive_drop$B15003e2+finaldatafive_drop$B15003e3+finaldatafive_drop$B15003e4+finaldatafive_drop$B15003e5+finaldatafive_drop$B15003e6+finaldatafive_drop$B15003e7+finaldatafive_drop$B15003e8+finaldatafive_drop$B15003e9+finaldatafive_drop$B15003e10+finaldatafive_drop$B15003e11+finaldatafive_drop$B15003e12+finaldatafive_drop$B15003e13+finaldatafive_drop$B15003e14+finaldatafive_drop$B15003e15+finaldatafive_drop$B15003e16)/ finaldatafive_drop$B15003e1

finaldatafive_drop$percent_less_than_high_school

#% in poverty
finaldatafive_drop$percent_poverty <- finaldatafive_drop$B17001e2 / finaldatafive_drop$B17001e1

#% black
finaldatafive_drop$percent_black <- finaldatafive_drop$DP0110012 / finaldatafive_drop$DP0100001
``` 


```{r statistics}
################STATS!

#make normal quantile plots
#check for linearity
par(mfrow=c(2,2))
qqnorm(finaldatafive_drop$isolationindex,main="RI Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$isolationindex,lwd=2,col="red")
qqnorm(finaldatafive_drop$PM25_88101,main="PM2.5 Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$PM25_88101,lwd=2,col="red")
qqnorm(finaldatafive_drop$aluminum_88104,main="Aluminum Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$aluminum_88104,lwd=2,col="red")
qqnorm(finaldatafive_drop$calcium_88111,main="Calcium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$calcium_88111,lwd=2,col="red")
qqnorm(finaldatafive_drop$chlorine_88115,main="Chlorine Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$chlorine_88115,lwd=2,col="red")
qqnorm(finaldatafive_drop$nickel_88136,main="Nickel Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$nickel_88136,lwd=2,col="red")
qqnorm(finaldatafive_drop$titanium_88161,main="Titanium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$titanium_88161,lwd=2,col="red")
qqnorm(finaldatafive_drop$vanadium_88164,main="Vanadium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$vanadium_88164,lwd=2,col="red")
qqnorm(finaldatafive_drop$silicon_88165,main="Silicon Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$silicon_88165,lwd=2,col="red")
qqnorm(finaldatafive_drop$zinc_88167,main="Zinc Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$zinc_88167,lwd=2,col="red")
qqnorm(finaldatafive_drop$ammonium_88301,main="Ammonium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$ammonium_88301,lwd=2,col="red")
qqnorm(finaldatafive_drop$nitrate_88306,main="Nitrate Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$nitrate_88306,lwd=2,col="red")
qqnorm(finaldatafive_drop$sulfate_88403,main="Sulfate Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$sulfate_88403,lwd=2,col="red")
qqnorm(finaldatafive_drop$EC,main="Elemental Carbon Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$EC,lwd=2,col="red")

#copy chlorine and nickel values for logging
finaldatafive_drop$chlorine_no_zero_88115 <- finaldatafive_drop$chlorine_88115
finaldatafive_drop$nickel_no_zero_88136 <- finaldatafive_drop$nickel_88136

#fix zeroes to below detection limits
finaldatafive_drop$chlorine_no_zero_88115[finaldatafive_drop$chlorine_no_zero_88115==0] <- 0.0000001
finaldatafive_drop$nickel_no_zero_88136[finaldatafive_drop$nickel_no_zero_88136==0] <- 0.000000001


#take logs of concentrations
finaldatafive_drop$log_PM25_88101 <- log(finaldatafive_drop$PM25_88101)
finaldatafive_drop$log_aluminum_88104 <- log(finaldatafive_drop$aluminum_88104)
finaldatafive_drop$log_calcium_88111 <- log(finaldatafive_drop$calcium_88111)
finaldatafive_drop$log_chlorine_no_zero_88115 <- log(finaldatafive_drop$chlorine_no_zero_88115)
finaldatafive_drop$log_nickel_no_zero_88136 <- log(finaldatafive_drop$nickel_no_zero_88136)
finaldatafive_drop$log_titanium_88161 <- log(finaldatafive_drop$titanium_88161)
finaldatafive_drop$log_vanadium_88164 <- log(finaldatafive_drop$vanadium_88164)
finaldatafive_drop$log_silicon_88165 <- log(finaldatafive_drop$silicon_88165)
finaldatafive_drop$log_zinc_88167 <- log(finaldatafive_drop$zinc_88167)
finaldatafive_drop$log_ammonium_88301 <- log(finaldatafive_drop$ammonium_88301)
finaldatafive_drop$log_nitrate_88306 <- log(finaldatafive_drop$nitrate_88306)
finaldatafive_drop$log_sulfate_88403 <- log(finaldatafive_drop$sulfate_88403)
finaldatafive_drop$log_EC <- log(finaldatafive_drop$EC)
# View(finaldatafive_drop)

#make normal quantile plots for the logs
#check for linearity
dev.off()
par(mfrow=c(2,2))
qqnorm(finaldatafive_drop$log_PM25_88101,main="Log PM2.5 Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_PM25_88101,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_aluminum_88104,main="Log Aluminum Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_aluminum_88104,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_calcium_88111,main="Log Calcium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_calcium_88111,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_chlorine_no_zero_88115,main="Log Chlorine Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_chlorine_no_zero_88115,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_nickel_no_zero_88136,main="Log Nickel Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_nickel_no_zero_88136,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_titanium_88161,main="Log Titanium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_titanium_88161,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_vanadium_88164,main="Log Vanadium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_vanadium_88164,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_silicon_88165,main="Log Silicon Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_silicon_88165,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_zinc_88167,main="Log Zinc Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_zinc_88167,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_ammonium_88301,main="Log Ammonium Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_ammonium_88301,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_nitrate_88306,main="Log Nitrate Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_nitrate_88306,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_sulfate_88403,main="Log Sulfate Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_sulfate_88403,lwd=2,col="red")
qqnorm(finaldatafive_drop$log_EC,main="Log Elemental Carbon Normal Quantile Plot",col="blue")
qqline(finaldatafive_drop$log_EC,lwd=2,col="red")

#get rid of non-FRM
finaldatafive_drop$PM_25_non_FRM_88502 <- NULL

##boxplots!
par(mfrow=c(1,1))

#boxplot untransformed components
boxplot(finaldatafive_drop[2:14])

#boxplot transformed -- looks better
boxplot(finaldatafive_drop[23:35])






#individual anovas not logs
PM25_anova_five <- aov(finaldatafive_drop$PM25_88101 ~ finaldatafive_drop$RI_quantile)
summary(PM25_anova_five)
plot(PM25_88101 ~ RI_quantile, data=finaldatafive_drop)

aluminum_88104_anova_five <- aov(finaldatafive_drop$aluminum_88104 ~ finaldatafive_drop$RI_quantile)
summary(aluminum_88104_anova_five)
plot(aluminum_88104 ~ RI_quantile, data=finaldatafive_drop)

calcium_88111_anova_five <- aov(finaldatafive_drop$calcium_88111 ~ finaldatafive_drop$RI_quantile)
summary(calcium_88111_anova_five)
plot(calcium_88111 ~ RI_quantile, data=finaldatafive_drop)

chlorine_88115_anova_five <- aov(finaldatafive_drop$chlorine_88115 ~ finaldatafive_drop$RI_quantile)
summary(chlorine_88115_anova_five)
plot(chlorine_88115 ~ RI_quantile, data=finaldatafive_drop)

nickel_88136_anova_five <- aov(finaldatafive_drop$nickel_88136 ~ finaldatafive_drop$RI_quantile)
summary(nickel_88136_anova_five)
plot(nickel_88136 ~ RI_quantile, data=finaldatafive_drop)

titanium_88161_anova_five <- aov(finaldatafive_drop$titanium_88161 ~ finaldatafive_drop$RI_quantile)
summary(titanium_88161_anova_five)
plot(titanium_88161 ~ RI_quantile, data=finaldatafive_drop)

vanadium_88164_anova_five <- aov(finaldatafive_drop$vanadium_88164 ~ finaldatafive_drop$RI_quantile)
summary(vanadium_88164_anova_five)
plot(vanadium_88164 ~ RI_quantile, data=finaldatafive_drop)

silicon_88165_anova_five <- aov(finaldatafive_drop$silicon_88165 ~ finaldatafive_drop$RI_quantile)
summary(silicon_88165_anova_five)
plot(silicon_88165 ~ RI_quantile, data=finaldatafive_drop)

zinc_88167_anova_five <- aov(finaldatafive_drop$zinc_88167 ~ finaldatafive_drop$RI_quantile)
summary(zinc_88167_anova_five)
plot(zinc_88167 ~ RI_quantile, data=finaldatafive_drop)

ammonium_88301_anova_five <- aov(finaldatafive_drop$ammonium_88301 ~ finaldatafive_drop$RI_quantile)
summary(ammonium_88301_anova_five)
plot(ammonium_88301 ~ RI_quantile, data=finaldatafive_drop)

nitrate_88306_anova_five <- aov(finaldatafive_drop$nitrate_88306 ~ finaldatafive_drop$RI_quantile)
summary(nitrate_88306_anova_five)
plot(nitrate_88306 ~ RI_quantile, data=finaldatafive_drop)

sulfate_88403_anova_five <- aov(finaldatafive_drop$sulfate_88403 ~ finaldatafive_drop$RI_quantile)
summary(sulfate_88403_anova_five)
plot(sulfate_88403 ~ RI_quantile, data=finaldatafive_drop)

EC_anova_five <- aov(finaldatafive_drop$EC ~ finaldatafive_drop$RI_quantile)
summary(EC_anova_five)
plot(EC ~ RI_quantile, data=finaldatafive_drop)





#trying a very simple GLM
simpleglm_five=glm(as.matrix(finaldatafive_drop$log_aluminum_88104,finaldatafive_drop$log_ammonium_88301,finaldatafive_drop$log_calcium_88111,finaldatafive_drop$log_chlorine_no_zero_88115,finaldatafive_drop$log_EC,finaldatafive_drop$log_nickel_no_zero_88136,finaldatafive_drop$log_nitrate_88306,finaldatafive_drop$log_PM25_88101,finaldatafive_drop$log_silicon_88165,finaldatafive_drop$log_sulfate_88403,finaldatafive_drop$log_titanium_88161,finaldatafive_drop$log_vanadium_88164,finaldatafive_drop$log_zinc_88167)~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)

summary(simpleglm_five)
coef(simpleglm_five)

simpleglm_fivelogPM25 <- glm(finaldatafive_drop$log_PM25_88101~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelogPM25)

simpleglm_fivelogaluminum <- glm(finaldatafive_drop$log_aluminum_88104~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelogaluminum)

simpleglm_fivelog_ammonium_88301 <- glm(finaldatafive_drop$log_ammonium_88301~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_ammonium_88301)

simpleglm_fivelog_calcium_88111 <- glm(finaldatafive_drop$log_calcium_88111~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_calcium_88111)

simpleglm_fivelog_chlorine_no_zero_88115 <- glm(finaldatafive_drop$log_chlorine_no_zero_88115~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_chlorine_no_zero_88115)

simpleglm_fivelog_EC <- glm(finaldatafive_drop$log_EC~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_EC)

simpleglm_fivelog_nickel_no_zero_88136 <- glm(finaldatafive_drop$log_nickel_no_zero_88136~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_nickel_no_zero_88136)

simpleglm_fivelog_nitrate_88306 <- glm(finaldatafive_drop$log_nitrate_88306~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_nitrate_88306)

simpleglm_fivelog_silicon_88165 <- glm(finaldatafive_drop$log_silicon_88165~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_silicon_88165)

simpleglm_fivelog_sulfate_88403 <- glm(finaldatafive_drop$log_sulfate_88403~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_sulfate_88403)

simpleglm_fivelog_titanium_88161 <- glm(finaldatafive_drop$log_titanium_88161~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_titanium_88161)

simpleglm_fivelog_vanadium_88164 <- glm(finaldatafive_drop$log_vanadium_88164~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_vanadium_88164)

simpleglm_fivelog_zinc_88167 <- glm(finaldatafive_drop$log_zinc_88167~finaldatafive_drop$RI_quantile+finaldatafive_drop$percent_less_than_high_school+finaldatafive_drop$percent_poverty+finaldatafive_drop$percent_white+finaldatafive_drop$percent_black)
summary(simpleglm_fivelog_zinc_88167)


#quantile that stuff
PM25_88101_by_quantile_five <- aggregate(finaldatafive_drop$PM25_88101 ~ finaldatafive_drop$RI_quantile, FUN="mean") # GET STD
aluminum_88104_by_quantile_five <- aggregate(finaldatafive_drop$aluminum_88104 ~ finaldatafive_drop$RI_quantile, FUN="mean")
calcium_88111_by_quantile_five <- aggregate(finaldatafive_drop$calcium_88111 ~ finaldatafive_drop$RI_quantile, FUN="mean")
chlorine_88115_by_quantile_five <- aggregate(finaldatafive_drop$chlorine_88115 ~ finaldatafive_drop$RI_quantile, FUN="mean")
nickel_88136_by_quantile_five <- aggregate(finaldatafive_drop$nickel_88136 ~ finaldatafive_drop$RI_quantile, FUN="mean")
titanium_88161_by_quantile_five <- aggregate(finaldatafive_drop$titanium_88161 ~ finaldatafive_drop$RI_quantile, FUN="mean")
vanadium_88164_by_quantile_five <- aggregate(finaldatafive_drop$vanadium_88164 ~ finaldatafive_drop$RI_quantile, FUN="mean")
silicon_88165_by_quantile_five <- aggregate(finaldatafive_drop$silicon_88165 ~ finaldatafive_drop$RI_quantile, FUN="mean")
zinc_88167_by_quantile_five <- aggregate(finaldatafive_drop$zinc_88167 ~ finaldatafive_drop$RI_quantile, FUN="mean")
ammonium_88301_by_quantile_five <- aggregate(finaldatafive_drop$ammonium_88301 ~ finaldatafive_drop$RI_quantile, FUN="mean")
nitrate_88306_by_quantile_five <- aggregate(finaldatafive_drop$nitrate_88306 ~ finaldatafive_drop$RI_quantile, FUN="mean")
sulfate_88403_by_quantile_five <- aggregate(finaldatafive_drop$sulfate_88403 ~ finaldatafive_drop$RI_quantile, FUN="mean")
EC_by_quantile_five <- aggregate(finaldatafive_drop$EC ~ finaldatafive_drop$RI_quantile, FUN="mean")



#standard deviate that stuff
PM25_88101_by_quantile_five_sd <- aggregate(finaldatafive_drop$PM25_88101 ~ finaldatafive_drop$RI_quantile, FUN="sd")
aluminum_88104_by_quantile_five_sd <- aggregate(finaldatafive_drop$aluminum_88104 ~ finaldatafive_drop$RI_quantile, FUN="sd")
calcium_88111_by_quantile_five_sd <- aggregate(finaldatafive_drop$calcium_88111 ~ finaldatafive_drop$RI_quantile, FUN="sd")
chlorine_88115_by_quantile_five_sd <- aggregate(finaldatafive_drop$chlorine_88115 ~ finaldatafive_drop$RI_quantile, FUN="sd")
nickel_88136_by_quantile_five_sd <- aggregate(finaldatafive_drop$nickel_88136 ~ finaldatafive_drop$RI_quantile, FUN="sd")
titanium_88161_by_quantile_five_sd <- aggregate(finaldatafive_drop$titanium_88161 ~ finaldatafive_drop$RI_quantile, FUN="sd")
vanadium_88164_by_quantile_five_sd <- aggregate(finaldatafive_drop$vanadium_88164 ~ finaldatafive_drop$RI_quantile, FUN="sd")
silicon_88165_by_quantile_five_sd <- aggregate(finaldatafive_drop$silicon_88165 ~ finaldatafive_drop$RI_quantile, FUN="sd")
zinc_88167_by_quantile_five_sd <- aggregate(finaldatafive_drop$zinc_88167 ~ finaldatafive_drop$RI_quantile, FUN="sd")
ammonium_88301_by_quantile_five_sd <- aggregate(finaldatafive_drop$ammonium_88301 ~ finaldatafive_drop$RI_quantile, FUN="sd")
nitrate_88306_by_quantile_five_sd <- aggregate(finaldatafive_drop$nitrate_88306 ~ finaldatafive_drop$RI_quantile, FUN="sd")
sulfate_88403_by_quantile_five_sd <- aggregate(finaldatafive_drop$sulfate_88403 ~ finaldatafive_drop$RI_quantile, FUN="sd")
EC_by_quantile_five_sd <- aggregate(finaldatafive_drop$EC ~ finaldatafive_drop$RI_quantile, FUN="sd")


PM25_88101_by_quantile_five
aluminum_88104_by_quantile_five
calcium_88111_by_quantile_five
chlorine_88115_by_quantile_five
nickel_88136_by_quantile_five
titanium_88161_by_quantile_five
vanadium_88164_by_quantile_five
silicon_88165_by_quantile_five
zinc_88167_by_quantile_five
ammonium_88301_by_quantile_five
nitrate_88306_by_quantile_five
sulfate_88403_by_quantile_five
EC_by_quantile_five

PM25_88101_by_quantile_five_sd
aluminum_88104_by_quantile_five_sd
calcium_88111_by_quantile_five_sd
chlorine_88115_by_quantile_five_sd
nickel_88136_by_quantile_five_sd
titanium_88161_by_quantile_five_sd
vanadium_88164_by_quantile_five_sd
silicon_88165_by_quantile_five_sd
zinc_88167_by_quantile_five_sd
ammonium_88301_by_quantile_five_sd
nitrate_88306_by_quantile_five_sd
sulfate_88403_by_quantile_five_sd
EC_by_quantile_five_sd
``` 
 
  
```{r code graveyard} 

###############################
#unused crap

#then run regression
  
  
  

#age 0-19. 20-64, 65+
#  finaldatafive_drop








#selectACSdata <- ACS_simplified_raw_data[c("OBJECTID","STATEFP","COUNTYFP","TRACTCE","BLKGRPCE","GEOID","NAMELSAD","MTFCC","FUNCSTAT","ALAND","AWATER","INTPTLAT","INTPTLON","Shape_Length","Shape_Area","GEOID_Data","B00001e1","B03002e1","B03002e2","B03002e3","B03002e4","B03002e5","B03002e6","B03002e7","B03002e8","B03002e9","B03002e10","B03002e11","B03002e12","B03002e13","B03002e14","B03002e15","B03002e16","B03002e17","B03002e18","B03002e19","B03002e20","B03002e21","B01001e1","B01001e2","B01001e3","B01001e4","B01001e5","B01001e6","B01001e7","B01001e8","B01001e9","B01001e10","B01001e11","B01001e12","B01001e13","B01001e14","B01001e15","B01001e16","B01001e17","B01001e18","B01001e19","B01001e20","B01001e21","B01001e22","B01001e23","B01001e24","B01001e25","B01001e26","B01001e27","B01001e28","B01001e29","B01001e30","B01001e31","B01001e32","B01001e33","B01001e34","B01001e35","B01001e36","B01001e37","B01001e38","B01001e39","B01001e40","B01001e41","B01001e42","B01001e43","B01001e44","B01001e45","B01001e46","B01001e47","B01001e48","B01001e49","B01002e1","B01002e2","B01002e3","B00001e1","B03002e1","B03002e2","B03002e3","B03002e4","B03002e5","B03002e6","B03002e7","B03002e8","B03002e9","B03002e10","B03002e11","B03002e12","B03002e13","B03002e14","B03002e15","B03002e16","B03002e17","B03002e18","B03002e19","B03002e20","B03002e21","B15003e1","B15003e2","B15003e3","B15003e4","B15003e5","B15003e6","B15003e7","B15003e8","B15003e9","B15003e10","B15003e11","B15003e12","B15003e13","B15003e14","B15003e15","B15003e16","B15003e17","B15003e18","B15003e19","B15003e20","B15003e21","B15003e22","B15003e23","B15003e24","B15003e25","B25077e1","B00001e1","B03002e1","B03002e2","B03002e3","B03002e4","B03002e5","B03002e6","B03002e7","B03002e8","B03002e9","B03002e10","B03002e11","B03002e12","B03002e13","B03002e14","B03002e15","B03002e16","B03002e17","B03002e18","B03002e19","B03002e20","B03002e21","B25075e1","B25075e2","B25075e3","B25075e4","B25075e5","B25075e6","B25075e7","B25075e8","B25075e9","B25075e10","B25075e11","B25075e12","B25075e13","B25075e14","B25075e15","B25075e16","B25075e17","B25075e18","B25075e19","B25075e20","B25075e21","B25075e22","B25075e23","B25075e24","B25075e25","B25075e26","B25075e27","B00001e1","B03002e1","B03002e2","B03002e3","B03002e4","B03002e5","B03002e6","B03002e7","B03002e8","B03002e9","B03002e10","B03002e11","B03002e12","B03002e13","B03002e14","B03002e15","B03002e16","B03002e17","B03002e18","B03002e19","B03002e20","B03002e21","B20001e1","B20001e2","B20001e3","B20001e4","B20001e5","B20001e6","B20001e7","B20001e8","B20001e9","B20001e10","B20001e11","B20001e12","B20001e13","B20001e14","B20001e15","B20001e16","B20001e17","B20001e18","B20001e19","B20001e20","B20001e21","B20001e22","B20001e23","B20001e24","B20001e25","B20001e26","B20001e27","B20001e28","B20001e29","B20001e30","B20001e31","B20001e32","B20001e33","B20001e34","B20001e35","B20001e36","B20001e37","B20001e38","B20001e39","B20001e40","B20001e41","B20001e42","B20001e43","B20002e1","B20002e2","B20002e3","B19013e1","B19301e1","C17002e1","C17002e2","C17002e3","C17002e4","C17002e5","C17002e6","C17002e7","C17002e8","B23025e1","B23025e1","B23025e2","B23025e3","B23025e4","B23025e5","B23025e6","B23025e7")]
# 
# # View(selectACSdata)
# 
# # View(ACS_simplified_raw_data[c("B00001e1")])
# whatvars <- colnames(ACS_simplified_raw_data)
# whatvars <- as.data.frame(whatvars)
# # View(whatvars)
# 
# 
# #READ IN METADATA
# ACS_metadata <- read.csv(file="ACS_METADATA.txt")
# # View(ACS_metadata)
# 
# #Metadata I want
# 
# #pop
# population_variables <- c(
#   "B00001e1",
#   "B00001m1")
#   
# 
# population_labels <- c(
#   "pop_total",
#   "pop__total_margin")
# 
# 
# #age
# age_variables <- c()
# age_labels <- c()
# 
# 
# #earnings
# earnings_variables <- c()
# earnings_labels <- c()
# 
# # 
# #educational attainment
# acs_education_variables <- ACS_simplified_raw_data[c("B15003e1","B15003m1","B15003e2","B15003m2","B15003e3","B15003m3","B15003e4","B15003m4","B15003e5","B15003m5","B15003e6","B15003m6","B15003e7","B15003m7","B15003e8","B15003m8","B15003e9","B15003m9","B15003e10","B15003m10","B15003e11","B15003m11","B15003e12","B15003m12","B15003e13","B15003m13","B15003e14","B15003m14","B15003e15","B15003m15","B15003e16","B15003m16","B15003e17","B15003m17","B15003e18","B15003m18","B15003e19","B15003m19","B15003e20","B15003m20","B15003e21","B15003m21","B15003e22","B15003m22","B15003e23","B15003m23","B15003e24","B15003m24","B15003e25","B15003m25")]
# 
# education_labels <- c("ed_pop","ed_pop_margin","ed_no_school","ed_no_school_margin","ed_nurse","ed_nurse_margin","ed_kinder","ed_kinder_margin","ed_1","ed_1_margin","ed_2","ed_2_margin","ed_3","ed_3_margin","ed_4","ed_4_margin","ed_5","ed_5_margin","ed_6","ed_6_margin","ed_7","ed_7_margin","ed_8","ed_8_margin","ed_9","ed_9_margin","ed_10","ed_10_margin","ed_11","ed_11_margin","ed_12","ed_12_margin","ed_hsdip","ed_hsdip_margin","ed_GED","ed_GED_margin","ed_<1_college","ed_<1_college_margin","ed_1+_college","ed_1+_college_margin","ed_associate","ed_associate_margin","ed_bachelor","ed_bachelor_margin","ed_master","ed_master_margin","ed_prof","ed_prof_marg","ed_doctor","ed_doctor_marg")
# 
# 
# #household value
# household_value_variables <- c()
# household_value_labels <- c()
# 
# 
# #income
# income_household_variables <- c("B19013e1","B19013m1")
# income_household_labels <- c("income_median_household","income_median_household_margin",)
# 
# 
# #population density
# population_density_variables <- c()
# population_density_labels <- c()
# 
# 
# #poverty
# poverty_variables <- c("B17001e1","B17001m1","B17001e2","B17001m2")
# poverty_labels <- c("poverty_pop","pov_pop_margin","pov","pov_margin")
# 
# 
# #race/ethnicity
# race_ethnicity_acs_variables <- c()
# race_ethnicity_acs_labels <- c()
#   
# 
# #unemployment
# unemployment_variables <- c()
# unemployment_labels <- c()
# 
# 
# #urbanicity
# urbanicity_variables <- c()
# urbanicity_labels <- c()


# 
# 
# #write ACS metadata to CSV
# write.csv(ACS_metadata, file = "ACS_metadata.csv")
# 
# 
# Label <- c("pov_pop","pov")
# #	EARNINGS IN THE PAST 12 MONTHS FOR HOUSEHOLDS B19051
# #MEDIAN EARNINGS IN THE PAST 12 MONTHS (IN 2012 INFLATION-ADJUSTED DOLLARS) BY SEX FOR THE POPULATION 16 YEARS AND OVER WITH EARNINGS IN THE PAST 12 MONTHS B20002
# #MEDIAN HOUSEHOLD INCOME IN THE PAST 12 MONTHS (IN 2012 INFLATION-ADJUSTED DOLLARS) B19013
# #GINI INDEX OF INCOME INEQUALITY B19083
# #AGGREGATE INCOME IN THE PAST 12 MONTHS (IN 2012 INFLATION-ADJUSTED DOLLARS) B19313
# #PER CAPITA INCOME IN THE PAST 12 MONTHS (IN 2012 INFLATION-ADJUSTED DOLLARS) B19301
# #	EMPLOYMENT STATUS FOR THE POPULATION 16 YEARS AND OVER B23025
# #SEX BY AGE B01001
# 
# 
# 
# 
# 
# #Pure 2010 Census Data
# #import DP table
# census_2010_DP1_raw <- read.csv("2010_Census_Data_Exported_from_ArcGIS.txt")
# # View(census_2010_DP1_raw[1:22])
# # View(ACS_data)
# colnames(census_2010_DP1_raw)
# 
# #join 2010 census data to ACS data
# #make common variable
# ACS_data$GEOID10 <- ACS_data$GEOID
# 
# #join
# census_2010_and_ACS <- full_join(census_2010_DP1_raw,ACS_data,by="GEOID10")
# # View(census_2010_and_ACS[c(1:5,190:205)])
# ACS_data_missing <- census_2010_and_ACS[is.na(census_2010_and_ACS$GEOID_Data),]
# # View(ACS_data_missing[c(1:5,190:215)])
# 
# 
# 
# 
# 
# aluminum_observations <- subset(compact_air_and_tracts, parameter_code == "88104")
# # View(aluminum_observations)
# 
# # View(aluminum_observations)
# 
# #aluminum 88104
# #calcium 
# #chlorine
# #nickel
# #silicon
# #titanium
# #vanadium
# #zinc
# 
# 
# #uniquePM25
# #sulfate
# #nitrate
# #ammonium
# #uniqueOCM
# #uniqueEC
# #sodiumion
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# 
# #list of all PM2.5 monitors
# #varnames_PM25_all <- variable.names(PM25all)
# #varnames_PM25_all
# #PM25_monitor_preliminary_data <- PM25all[,c("State.Code","County.Code","Site.Num","Latitude","Longitude","Datum","Local.Site.Name","Address","State.Name","County.Name","City.Name","CBSA.Name","ID","parameter_code")]
# #PM25_monitor_preliminary_data <- as.data.frame(PM25_monitor_preliminary_data)
# #PM_25_monitors <- unique(PM25_monitor_preliminary_data)
# 
# #drop unused factor levels for all columns for PM2.5 monitors
# #PM_25_monitors <- droplevels(PM_25_monitors)
# 
# #rename parameter code as Monitor.Type for PM2.5 monitors
# #names(PM_25_monitors)[names(PM_25_monitors) == 'parameter_code'] <- 'Monitor.Type'
# 
# # #add PM2.5 and spec monitors into one big df
# #all_monitors <- rbind(PM_25_monitors,speciation_monitors_no_exact_dups)
# 
# # eliminating duplicates
# 
# 
# 
# # list of rows to drop
# 
# 
# 
# #pulling monitor latlongs
# 
# #read monitor and site lists
# #aqs_monitors <- read.csv("aqs_monitors.csv",header=TRUE)
# #aqs_sites <- read.csv("aqs_sites.csv",header=TRUE)
# ## View(aqs_monitors)
# ## View(aqs_sites)




############### TO DO

#### racial isolation index all tracts and nodes IN PROGRESS ####



```
